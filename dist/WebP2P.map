{"version":3,"file":"bundle.js","sources":["../lib/MessagePacker.js","../lib/PeerConnection_channels.shim.js","../lib/WebP2P.js","../lib/connectors/PubNub.js","../lib/connectors/core/Connector.js","../lib/connectors/core/DataChannel.js","../lib/connectors/core/HandshakeConnector.js","../lib/errors.js","../lib/index.js","../lib/managers/HandshakeManager.js","../lib/managers/Manager.js","../lib/managers/PeersManager.js","../node_modules/grunt-browserify/node_modules/browserify/node_modules/events/events.js","../node_modules/wrtc/lib/browser.js","../shim/pubnub.min.js"],"names":["MessagePacker","sessionID","storeResponse","message","dest","id","stored","response","timeout","setTimeout","clearTimeout","responses","BASE_TIMEOUT","self","this","requestID","requests","pack","result","Array","type","PRESENCE","OFFER","ANSWER","error","Error","from","Math","min","ttl","MAX_TTL_DEFAULT","sdp","unpack","reply","request_ids","request","callback","presence","offer","dispatchCallback","cancel","Object","keys","length","ERROR","module","exports","applyChannelsShim","pc","initChannel","channel","channels","push","addEventListener","splice","indexOf","undefined","getDataChannels","dispatchEvent","event","call","createDataChannel","label","dataChannelDict","WebP2P","options","onerror","emit","createPeerConnection","callbackType","RTCPeerConnection","iceServers","url","stun_server","optional","DtlsSrtpKeyAgreement","candidate","localDescription","console","signalingState","peersManager","add","offers","defineProperty","value","initPeerConnection_Offer","labels","routingLabel","concat","commonLabels","i","mediaConstraints","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","createOffer","setLocalDescription","log","initPeerConnection_Answer","setRemoteDescription","RTCSessionDescription","createAnswer","answer","forward","connector","warn","peer","_connectors","send","handshakeManager","initManagerEvents","manager","connectionProcessed","get","peerConnection","close","on","status","UUIDv4","b","a","random","toString","replace","handshake_servers","messagepacker","HandshakeManager","PeersManager","__defineGetter__","peers","connectTo","Function","SyntaxError","increaseConnections","window","EventEmitter","require","prototype","__proto__","constructor","Connector_PubNub","config_init","config_mess","max_connections","HandshakeConnector","pubnub","PUBNUB","init","subscribe","restore","backfill","connect","_open","_message","disconnect","_close","_error","unsubscribe","publish","Connector","TypeError","Connector_DataChannel","datachannel","JSON","parse","data","stringify","shouldConnect","connections","Number","POSITIVE_INFINITY","ERROR_NETWORK_UNKNOWN","msg","ERROR_NETWORK_OFFLINE","ERROR_REQUEST_FAILURE","ERROR_REQUEST_EMPTY","ERROR_NO_PEERS","createConnector","config","connectorConstructor","handshakeConnectorConstructors","_initConnector","_messageUnpacked","handshake","configs","index","Manager","registerConnectorConstructor","configs_infinity","addConfigs_byObject","addConfigs_byArray","configuration","addConfigs_byUri","json_uri","dispatchError","http_request","XMLHttpRequest","open","onload","errors","navigator","onLine","addConfigs","incomingConnector","initDataChannel","initDataChannel_listener","target","removeEventListener","readyState","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","er","handler","len","args","listeners","arguments","apply","slice","addListener","listener","m","newListener","warned","trace","once","g","removeListener","fired","list","position","removeAllListeners","key","ret","listenerCount","emitter","RTCIceCandidate","mozRTCIceCandidate","webkitRTCIceCandidate","mozRTCPeerConnection","webkitRTCPeerConnection","mozRTCSessionDescription","webkitRTCSessionDescription","x","ga","aa","Date","J","ka","c","join","ca","d","Q","t","encodeURIComponent","da","la","e","na","oa","fa","ja","hasOwnProperty","pa","qa","j","sort","ra","C","ba","I","u","valueOf","lastIndex","test","H","charCodeAt","h","p","f","q","r","k","isFinite","String","s","\\b","\\t","\\n","\\f","\\r","\"","\\\\","eval","G","P","ha","floor","split","sa","CryptoJS","HmacSHA256","enc","Base64","ta","document","getElementById","ua","va","getElementsByTagName","U","cancelBubble","preventDefault","stopPropagation","attachEvent","xa","V","setAttribute","getAttribute","ya","style","Ba","createElement","Da","Ca","W","Fa","M","ea","N","O","D","parentNode","removeChild","L","responseText","abort","XDomainRequest","onabort","onloadend","onreadystatechange","pnsdk","Ea","Ga","src","appendChild","Ha","Ia","userAgent","opera","postError","Ja","Ka","localStorage","getItem","cookie","match","RegExp","set","setItem","Y","unbind","bind","fire","Z","La","ia","z","time","R","Na","E","Oa","y","A","shift","jsonp","subscribe_key","uuid","xdr","db","_is_online","jsonp_cb","PNSDK","hmac_SHA256","windowing","keepalive","noleave","publish_key","auth_key","secret_key","ssl","origin","K","wa","za","Aa","ma","S","no_wait_for_pending","l","F","T","B","LEAVE","X","auth","v","history","count","limit","reverse","w","start","end","stringtoken","replay","source","destination","stop","Pa","err","prepend","action","name","reconnect","idle","noheresync","timetoken","here_now","uuids","timestamp","occupancy","grant","read","write","getTime","signature","audit","revoke","set_uuid","get_uuid","ready","map","each","each-channel","grep","offline","supplant","now","unique","updater","css","$","create","head","search","attr","events","notest","location","href","jQuery","top","innerHTML","rdx","unescape","Ma","ws","protocol","CONNECTING","OPEN","CLOSING","CLOSED","CLOSE_NORMAL","CLOSE_GOING_AWAY","CLOSE_PROTOCOL_ERROR","CLOSE_UNSUPPORTED","CLOSE_TOO_LARGE","CLOSE_NO_STATUS","CLOSE_ABNORMAL","onclose","onmessage","onopen","onsend","binaryType","extensions","bufferedAmount","trasnmitting","buffer","code","reason","wasClean"],"mappings":"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","sourcesContent":["/**\n * Based on code from RPC-Builder\n */\n\n\nconst ERROR    = 0;\nconst PRESENCE = 1;\nconst OFFER    = 2;\nconst ANSWER   = 3;\n\nconst MAX_TTL_DEFAULT = 5;\n\nconst BASE_TIMEOUT = 5000;\n\n\nfunction MessagePacker(sessionID)\n{\n  var self = this;\n\n  var requestID = 0;\n\n  var requests  = {};\n  var responses = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, dest, id)\n  {\n    message.stored = true;\n\n    var response =\n    {\n      message: message,\n      id: id,\n      timeout: setTimeout(function()\n      {\n        clearTimeout(response.timeout);\n        delete responses[dest];\n      },\n      BASE_TIMEOUT)\n    };\n    responses[dest] = response;\n  };\n\n\n  //\n  // Pack & Unpack\n  //\n\n  this.pack = function(message, id)\n  {\n    var result = new Array(6);\n\n    // Type\n    var type = message.type;\n    switch(type)\n    {\n      case \"presence\":\n        result[0] = PRESENCE;\n      break;\n\n      case \"offer\":\n        result[0] = OFFER;\n      break;\n\n      case \"answer\":\n        result[0] = ANSWER;\n      break;\n\n      default:\n      {\n        var error = Error(\"Unknown message type '\"+type+\"'\");\n            error.message = message;\n\n        throw error;\n      };\n    };\n\n    // From\n    result[1] = message.from || sessionID;\n\n    // Offer & Answer\n\n    if(result.type != PRESENCE)\n    {\n      result[2] = message.dest;\n      result[3] = id || requestID++;\n      result[4] = Math.min(message.ttl || MAX_TTL_DEFAULT, MAX_TTL_DEFAULT);\n      result[5] = message.sdp;\n    };\n\n    return result;\n  };\n\n  this.unpack = function(message)\n  {\n    var result = {};\n\n    var from = message[1];\n    var id   = message[3];\n\n    // Type\n    var type = message[0];\n    switch(type)\n    {\n      case PRESENCE:\n        result.type = \"presence\";\n      break;\n\n      case OFFER:\n        result.type = \"offer\";\n      break;\n\n      case ANSWER:\n        result.type = \"answer\";\n      break;\n\n      default:\n      {\n        var error = Error(\"Unknown message type '\"+type+\"'\");\n            error.message = message;\n\n        throw error;\n      };\n    };\n\n    // From\n    result.from = from;\n\n    // Offer & Answer\n\n    if(type != PRESENCE)\n    {\n      result.dest = message[2];\n      result.ttl  = message[4];\n      result.sdp  = message[5];\n\n      result.pack = function()\n      {\n        return self.pack(this, id);\n      };\n    };\n\n    // Dispatch responses callbacks\n    if(result.type == 'offer')\n    {\n      // Check if it's a re-try\n      var response = responses[from];\n      if(response)\n      {\n        // Old message, ignore it\n        if(response.id > id)\n          return;\n\n        // Updated message (or duplicated one), delete old response\n        clearTimeout(response.timeout);\n        delete responses[from];\n\n        // Duplicated message, re-send it\n        if(response.id == id)\n        {\n          var message = response.message;\n\n          // Store the response to prevent to process duplicate request later\n          storeResponse(message, from, id);\n\n          // Return the stored response so it can be directly send back\n          return message;\n        };\n      }\n      else\n        result.reply = function(dest, sdp)\n        {\n          var message = self.pack(\n          {\n            type: \"answer\",\n            dest: dest,\n            sdp:  sdp\n          }, id);\n\n          // Store the response to prevent to process duplicate request later\n          storeResponse(message, dest, id);\n\n          // Return the packed message\n          return message;\n        };\n    };\n\n    if(result.type == 'answer')\n    {\n      var request_ids = requests[from];\n      if(request_ids)\n      {\n        var request = request_ids[id];\n        if(request)\n        {\n          request.callback(error, result);\n\n          // Return undefined to notify message has been procesed\n          return;\n        };\n      };\n    };\n\n    // Return unpacked message\n    return result;\n  };\n\n\n  //\n  // Application dependent messages\n  //\n\n  this.presence = function()\n  {\n    var message = this.pack(\n    {\n      type: \"presence\"\n    });\n\n    // Return the packed message\n    return message;\n  };\n\n  this.offer = function(dest, sdp, callback)\n  {\n    var message = this.pack(\n    {\n      type: \"offer\",\n      dest: dest,\n      sdp:  sdp\n    });\n\n    message.cancel = function(){};\n\n    // Store callback if defined to be executed when received the response\n    if(callback)\n    {\n      var request_ids = requests[dest] = requests[dest] || {};\n\n      var id = message[3];\n\n      var request = request_ids[id] =\n      {\n        message: message,\n        callback: dispatchCallback,\n        timeout:  setTimeout(function()\n        {\n          var error = new Error('Timed Out');\n              error.request = message;\n\n          dispatchCallback(error)\n        },\n        BASE_TIMEOUT)\n      };\n\n      message.cancel = function()\n      {\n        clearTimeout(request.timeout);\n\n        delete request_ids[id];\n        if(!Object.keys(request_ids).length)\n          delete requests[dest];\n      };\n\n      function dispatchCallback(error, result)\n      {\n        message.cancel();\n\n        callback(error, result);\n      };\n    };\n\n    // Return the packed message\n    return message;\n  };\n};\n\n\nmodule.exports = MessagePacker;","/**\n * Add support to get a list of channels on a PeerConnection object\n */\nfunction applyChannelsShim(pc)\n{\n  if(pc.getDataChannels != undefined) return;\n\n  var channels = [];\n\n  pc.getDataChannels = function()\n  {\n    return channels;\n  };\n\n  function initChannel(channel)\n  {\n    channels.push(channel);\n\n    channel.addEventListener('close', function(event)\n    {\n      channels.splice(channels.indexOf(channel), 1);\n    });\n  };\n\n  // Add DataChannels created by remote PeerConnection object\n  var dispatchEvent = pc.dispatchEvent;\n  pc.dispatchEvent = function(event)\n  {\n    if(event.type == 'datachannel')\n    {\n      var channel = event.channel;\n\n      initChannel(channel);\n    };\n\n    // Dispatch events\n    dispatchEvent.call(this, event);\n  };\n\n  // Add DataChannels created by local PeerConnection object\n  var createDataChannel = pc.createDataChannel;\n  pc.createDataChannel = function(label, dataChannelDict)\n  {\n    var channel = createDataChannel.call(this, label, dataChannelDict);\n\n    initChannel(channel);\n\n    return channel;\n  };\n};\n\n\nmodule.exports = applyChannelsShim;\n","var EventEmitter = require(\"events\").EventEmitter;\n\nvar RTCPeerConnection = require('wrtc').RTCPeerConnection;\n//var uuid = require('uuid');\n\nvar HandshakeManager = require('./managers/HandshakeManager');\nvar PeersManager     = require('./managers/PeersManager');\n\nvar MessagePacker = require('./MessagePacker');\n\nvar applyChannelsShim = require(\"./PeerConnection_channels.shim\");\n\n\n/**\n * @classdesc Init and connect to the WebP2P.io network\n *\n * @constructor\n */\nfunction WebP2P(options)\n{\n  var self = this;\n\n\n  /**\n   * UUID generator\n   */\n  var UUIDv4 = function b(a)\n  {\n    return a ? (a ^ Math.random() * 16 >> a / 4).toString(16) : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, b);\n  };\n\n\n  var options = options || {};\n\n  // Internal options\n  var commonLabels      = options.commonLabels || [];\n  var handshake_servers = options.handshake_servers;\n  var stun_server       = options.stun_server || 'stun.l.google.com:19302';\n\n  // Read-only options\n  Object.defineProperty(this, \"routingLabel\",\n  {\n    value: options.routingLabel || \"webp2p\"\n  });\n  Object.defineProperty(this, \"sessionID\",\n  {\n    value: options.sessionID || UUIDv4()\n//    value: options.sessionID || uuid.v4()\n  });\n\n\n  var messagepacker = new MessagePacker(this.sessionID);\n\n  var handshakeManager = new HandshakeManager(messagepacker, handshake_servers);\n  var peersManager     = new PeersManager(messagepacker, self.routingLabel);\n\n  this.__defineGetter__('status', function()\n  {\n    if(peersManager.status == 'connected')\n      return 'connected';\n\n    return handshakeManager.status;\n  });\n\n  this.__defineGetter__(\"peers\", function()\n  {\n    return peersManager.peers;\n  });\n\n\n  function onerror(error)\n  {\n    self.emit('error', new Error(error));\n  };\n\n\n  var offers = {};\n\n  /**\n   * Create a new RTCPeerConnection\n   * @param {UUID} sessionID Identifier of the other peer so later can be accessed.\n   *\n   * @return {RTCPeerConnection}\n   */\n  function createPeerConnection(sessionID, callbackType, callback)\n  {\n    var pc = new RTCPeerConnection\n    (\n      {iceServers: [{url: 'stun:'+stun_server}]},\n      {optional: [{DtlsSrtpKeyAgreement: true}]}\n    );\n\n    applyChannelsShim(pc);\n\n    pc.addEventListener('icecandidate', function(event)\n    {\n      // There's a candidate, ignore it\n      if(event.candidate)\n        return;\n\n      // There's no candidate, send the full SDP\n      var type = this.localDescription.type;\n      var sdp  = this.localDescription.sdp;\n\n      if(type == callbackType)\n        callback(sdp)\n      else\n        console.error(type+\" SDP type is not equal to \"+callbackType+\" callback type\");\n    });\n\n    pc.addEventListener('signalingstatechange', function(event)\n    {\n      // Add PeerConnection object to available ones when gets open\n      if(pc.signalingState == 'stable')\n      {\n        peersManager.add(sessionID, pc);\n\n        var request = offers[sessionID];\n        if(request)\n        {\n          delete offers[sessionID];\n\n          var callback = request.callback;\n          if(callback)\n             callback(null, pc);\n        };\n\n        self.emit('peerconnection', pc);\n      };\n    });\n\n    // Set ID of the PeerConnection\n    Object.defineProperty(pc, \"sessionID\", {value : sessionID});\n\n    return pc;\n  };\n\n\n  function initPeerConnection_Offer(pc, labels)\n  {\n    // Set channels for this PeerConnection object\n    labels = [self.routingLabel].concat(commonLabels, labels);\n\n    for(var i=0, label; label=labels[i]; i++)\n      pc.createDataChannel(label);\n\n    // Send offer\n    var mediaConstraints =\n    {\n      mandatory:\n      {\n        OfferToReceiveAudio: false,\n        OfferToReceiveVideo: false\n      }\n    };\n\n    pc.createOffer(function(offer)\n    {\n      // Set the peer local description\n      pc.setLocalDescription(offer,\n      function()\n      {\n        console.log('['+self.sessionID+'] Offer LocalDescription created and set');\n      },\n      onerror);\n    },\n    onerror,\n    mediaConstraints);\n  };\n\n  function initPeerConnection_Answer(pc, sdp)\n  {\n    // Process offer\n    pc.setRemoteDescription(new RTCSessionDescription(\n    {\n      sdp:  sdp,\n      type: 'offer'\n    }),\n    function()\n    {\n      // Send answer\n      pc.createAnswer(function(answer)\n      {\n        // Set the peer local description\n        pc.setLocalDescription(answer,\n        function()\n        {\n          console.log('['+self.sessionID+'] Answer LocalDescription created and set');\n        },\n        onerror);\n      },\n      onerror)\n    },\n    onerror);\n  };\n\n\n  //\n  // Connection methods\n  //\n\n  /**\n   * Callback to send the offer. If not defined send it to all connected peers.\n   *\n   * @callback WebP2P~ConnectToCallback\n   * @param {Error} error\n   * @param {RTCPeerConnection} peer - The (newly created) peer\n   */\n\n  /**\n   * Connects to another peer based on its UID. If we are already connected,\n   * it does nothing.\n   *\n   * @param {UUID} sessionID - Identifier of the other peer to be connected.\n   * @param {string[]} [labels] - Per-connection labels\n   * @param {WebP2P~ConnectToCallback} callback\n   */\n  this.connectTo = function(dest, labels, callback)\n  {\n    if(labels instanceof Function)\n    {\n      if(callback)\n        throw new SyntaxError(\"Nothing can be defined after the callback\");\n\n      callback = labels;\n      labels = undefined;\n    };\n\n    // Don't connect to uurself\n    if(dest == self.sessionID)\n    {\n      callback(new Error(\"Connecting to ourself\"));\n      return;\n    }\n\n    var pc = peersManager.get(dest);\n    if(pc)\n      callback(null, pc)\n\n    else\n    {\n      pc = createPeerConnection(dest, \"offer\", function(offer)\n      {\n        var message = messagepacker.offer(dest, offer, function(error)\n        {\n          if(error)\n            callback(error);\n        });\n\n        offers[dest] =\n        {\n          callback: callback,\n          message: message,\n          peerConnection: pc\n        };\n\n        handshakeManager.send(message);\n        peersManager.send(message);\n      });\n\n      initPeerConnection_Offer(pc, labels);\n    }\n  };\n\n\n  //\n  // Managers\n  //\n\n  function forward(message, connector)\n  {\n    // Don't forward the message if TTL has been achieved\n    if(--message.ttl <= 0)\n      return console.warn(\"TTL achieved:\",message);\n\n    var dest = message.dest;\n\n    message = message.pack();\n\n    // Search the peer between the ones currently connected\n    for(var i=0, peer; peer=peersManager._connectors[i]; i++)\n      if(peer.sessionID == dest)\n        return peer.send(message);\n\n    // Peer was not found, forward message to all the connectors\n    peersManager.send(message, connector);\n    handshakeManager.send(message, connector);\n  };\n\n\n  handshakeManager.on('connected', function()\n  {\n    self.emit('handshakeManager.connected', handshakeManager);\n  });\n  handshakeManager.on('disconnected', function()\n  {\n    self.emit('handshakeManager.disconnected', handshakeManager);\n  });\n\n  peersManager.on('connected', function()\n  {\n    self.emit('peersManager.connected', peersManager);\n  });\n  peersManager.on('disconnected', function()\n  {\n    self.emit('peersManager.disconnected', peersManager);\n  });\n\n  function initManagerEvents(manager)\n  {\n    //\n    // Basic events\n    //\n\n    manager.on('connected', function()\n    {\n      if(handshakeManager.status != peersManager.status)\n        self.emit('connected');\n    });\n    manager.on('disconnected', function()\n    {\n      if(handshakeManager.status == peersManager.status)\n        self.emit('disconnected');\n    });\n    manager.on('error', function(error)\n    {\n      self.emit('error', error);\n    });\n\n    //\n    // Offer & answer events\n    //\n\n    /**\n     * Check if it's a request from a peer we are already connected or trying to\n     * connect to, so we can prevent to do crossed connections\n     *\n     * @param sessionID - ID of the other peer\n     *\n     * @returns {Boolean} - If we are already connected or trying to connect\n     */\n    function connectionProcessed(sessionID)\n    {\n      // Check if we are already connected to the requester peer\n      var peer = peersManager.get(sessionID);\n      if(peer)\n      {\n        // We are already connected to that peer, ignore the request\n        console.log(\"[\"+self.sessionID+\"] Already connected to \"+sessionID);\n        return true;\n      };\n\n      // Check if we are already trying to connect to that peer\n      var offer = offers[sessionID];\n      if(offer)\n      {\n        // We are already trying to connected to that peer, ignore the request\n        console.log(\"[\"+self.sessionID+\"] Already offered connection to \"+sessionID);\n\n        // We have higher precedence, ignore incoming connection request\n        if(self.sessionID < sessionID)\n          return true;  // Should send an error to the other end\n\n        // We have less precedence, cancel our connection request and prepare to\n        // incoming one\n        offer.message.cancel();\n        offer.peerConnection.close();\n\n        delete offers[sessionID];\n      };\n\n      // Connection request is a genuinely new one, process it as usual\n      return false;\n    };\n\n    manager.on('offer', function(message, connector)\n    {\n      var from = message.from;\n      var dest = message.dest;\n\n      // Ignore messages send by us\n      if(from == self.sessionID) return;\n\n      // Message is for us\n      if(dest == self.sessionID)\n      {\n        console.log(\"[\"+self.sessionID+\"] Received connection request from \"+from);\n\n        if(connectionProcessed(from))\n          return;\n\n        var request = message;\n\n        // Search the peer between the list of currently connected ones,\n        // or create it if it's not connected\n        var pc = createPeerConnection(from, \"answer\", function(answer)\n        {\n          var message = request.reply(from, answer);\n\n          // Send back the connection request over the same connector, since\n          // this should be the shortest path to connect both peers\n          connector.send(message);\n        });\n\n        initPeerConnection_Answer(pc, message.sdp);\n      }\n\n      // Forward message\n      else\n        forward(message, connector);\n    });\n\n    manager.on('answer', function(message, connector)\n    {\n      var from = message.from;\n      var dest = message.dest;\n\n      // Ignore messages send by us\n      if(from == self.sessionID) return;\n\n      // Message is for us\n      if(dest == self.sessionID)\n      {\n        console.log(\"[\"+self.sessionID+\"] Received connection response from \"+from);\n\n        var peer = offers[from];\n        if(peer)\n        {\n          peer.peerConnection.setRemoteDescription(new RTCSessionDescription(\n          {\n            sdp: message.sdp,\n            type: 'answer'\n          }),\n          function()\n          {\n            console.log(\"Successfuly generated RemoteDescription for \"+from);\n          },\n          onerror);\n        }\n        else\n          console.warn(\"[\"+self.sessionID+\"] Connection with peer '\" + from + \"' was not previously requested\");\n      }\n\n      // Forward message\n      else\n        forward(message, connector);\n    });\n  };\n\n  // Init managers events\n\n  initManagerEvents(handshakeManager);\n  initManagerEvents(peersManager);\n\n  handshakeManager.on('presence', function(from, connector)\n  {\n    // Ignore messages send by us\n    if(from == self.sessionID) return;\n\n    var peer = peersManager.get(from);\n    if(!peer)\n    {\n      var pc = createPeerConnection(from, \"offer\", function(offer)\n      {\n        var message = messagepacker.offer(from, offer);\n\n        offers[from] =\n        {\n          message: message,\n          peerConnection: pc\n        };\n\n        // Send back the connection request over the same connector, since this\n        // should be the shortest path to connect both peers\n        connector.send(message);\n      });\n\n      pc.addEventListener('signalingstatechange', function(event)\n      {\n        // If PeerConnection object gets open, increase number of connections\n        // fetch over this connector so it can decide if it could close\n        if(pc.signalingState == 'stable')\n          connector.increaseConnections();\n      });\n\n      initPeerConnection_Offer(pc);\n    }\n  });\n\n\n  //\n  // Clossing functions\n  //\n\n  this.close = function()\n  {\n    handshakeManager.close();\n    peersManager.close();\n  };\n\n  // Close all connections when user goes out of the page\n  if(window)\n    window.addEventListener('beforeunload', function(event)\n    {\n      self.close();\n    });\n};\nWebP2P.prototype.__proto__   = EventEmitter.prototype;\nWebP2P.prototype.constructor = WebP2P;\n\n\nmodule.exports = WebP2P;\n","var HandshakeConnector = require(\"./core/HandshakeConnector\");\n\nvar PUBNUB = require(\"pubnub\");\n\n\n/**\n * Handshake connector for PubNub\n * @param {Object} configuration Configuration object.\n */\nfunction Connector_PubNub(config_init, config_mess, max_connections)\n{\n  HandshakeConnector.call(this, max_connections);\n\n  var self = this;\n\n  var channel = config_mess.channel;\n\n\n  // Connect a handshake connector to the PubNub server\n  var pubnub = PUBNUB.init(config_init);\n\n  // Configure handshake connector\n  pubnub.subscribe(\n  {\n    channel: channel,\n    restore: false,\n    backfill: false,\n\n    connect:    self._open,\n    message:    self._message,\n    disconnect: self._close,\n\n    error: function(response)\n    {\n      self._error(new Error(response ? response.error : 'Undefined error'))\n    }\n  });\n\n\n  // Define methods\n\n  /**\n   * Close the connection with this handshake server\n   */\n  this.close = function()\n  {\n    pubnub.unsubscribe(\n    {\n      channel: channel\n    });\n\n    // This shouldn't be necesary, but seems 'disconnect' event is not being\n    // dispatched by the PubNub channel, so we close the connector explicitly\n    self._close();\n  }\n\n  /**\n   * Send the message\n   */\n  this.send = function(message)\n  {\n    pubnub.publish(\n    {\n      channel: channel,\n      message: message\n    });\n  };\n}\nConnector_PubNub.prototype.__proto__   = HandshakeConnector.prototype;\nConnector_PubNub.prototype.constructor = Connector_PubNub;\n\n// Class constants\nConnector_PubNub.prototype.max_connections = 50;\nObject.defineProperty(Connector_PubNub.prototype, 'max_chars', {value: 1800});\n\n\nmodule.exports = Connector_PubNub;\n","var EventEmitter = require(\"events\").EventEmitter;\n\n\nfunction Connector()\n{\n  EventEmitter.call(this);\n\n  var self = this;\n\n\n  /**\n   * Notify that the connection to this handshake server is open\n   */\n  this._open = function()\n  {\n    self.emit('open');\n  };\n\n  this._message = function(message)\n  {\n    self.emit(\"message\", message);\n  };\n\n  this._close = function()\n  {\n    self.emit('close');\n  };\n\n  this._error = function(error)\n  {\n    self.emit('error', error);\n  };\n};\nConnector.prototype.__proto__   = EventEmitter.prototype;\nConnector.prototype.constructor = Connector;\n\nConnector.prototype.close = function()\n{\n  throw new TypeError(\"Connector.close should be defined in a child class\");\n};\nConnector.prototype.send = function(message)\n{\n  throw new TypeError(\"Connector.send should be defined in a child class\");\n};\n\n\nmodule.exports = Connector;","var Connector = require(\"./Connector\");\n\n\nfunction Connector_DataChannel(datachannel)\n{\n  Connector.call(this);\n\n  var self = this;\n\n\n  datachannel.addEventListener('open',  self._open);\n  datachannel.addEventListener('message', function(event)\n  {\n    self._message(JSON.parse(event.data));\n  });\n  datachannel.addEventListener('close', self._close);\n  datachannel.addEventListener('error', self._error);\n\n\n  // Define methods\n\n  /**\n   * Close the connection with the peer\n   */\n  this.close = function()\n  {\n    datachannel.close();\n  };\n\n  /**\n   * Send the message\n   */\n  this.send = function(message)\n  {\n    datachannel.send(JSON.stringify(message));\n  };\n};\nConnector_DataChannel.prototype.__proto__   = Connector.prototype;\nConnector_DataChannel.prototype.constructor = Connector_DataChannel;\n\n\nmodule.exports = Connector_DataChannel;","var Connector = require(\"./Connector\");\n\n\nfunction HandshakeConnector(max_connections)\n{\n  Connector.call(this);\n\n  var self = this;\n\n\n  if(max_connections != undefined)\n    this.max_connections = Math.min(max_connections, this.max_connections);\n\n  /**\n   * Check if we should connect this new peer or ignore it to increase entropy\n   * in the network mesh\n   *\n   * @returns {Boolean}\n   */\n  this.shouldConnect = function()\n  {\n    return true;\n  };\n\n\n  // Count the maximum number of pending connections allowed to be\n  // done with this handshake server (undefined == unlimited)\n  var connections = 0;\n\n  this.increaseConnections = function()\n  {\n    // Increase the number of connections reached throught\n    // this handshake server\n    connections++;\n\n    // Close connection with handshake server if we got its quota of peers\n    if(connections >= self.max_connections)\n       self.close();\n  };\n};\nHandshakeConnector.prototype.__proto__   = Connector.prototype;\nHandshakeConnector.prototype.constructor = HandshakeConnector;\n\n// Class constants\nHandshakeConnector.prototype.max_connections = Number.POSITIVE_INFINITY;\n\n\nmodule.exports = HandshakeConnector;","const ERROR_NETWORK_UNKNOWN = {id: 0, msg: 'Unable to fetch handshake servers configuration'};\nconst ERROR_NETWORK_OFFLINE = {id: 1, msg: \"There's no available network\"};\nconst ERROR_REQUEST_FAILURE = {id: 2, msg: 'Unable to fetch handshake servers configuration'};\nconst ERROR_REQUEST_EMPTY   = {id: 3, msg: 'Handshake servers configuration is empty'};\n\nconst ERROR_NO_PEERS        = {id: 4, msg: 'Not connected to any peer'};\n\n\nexports.ERROR_NETWORK_UNKNOWN = ERROR_NETWORK_UNKNOWN;\nexports.ERROR_NETWORK_OFFLINE = ERROR_NETWORK_OFFLINE;\nexports.ERROR_REQUEST_FAILURE = ERROR_REQUEST_FAILURE;\nexports.ERROR_REQUEST_EMPTY   = ERROR_REQUEST_EMPTY;\nexports.ERROR_NO_PEERS        = ERROR_NO_PEERS;","/**\n * New node file\n */\nvar HandshakeConnector = require('./connectors/core/HandshakeConnector');\nvar WebP2P             = require('./WebP2P');\n\n\nmodule.exports = WebP2P;\nmodule.exports.HandshakeConnector = HandshakeConnector;","var Manager = require('./Manager');\n\nvar errors = require('../errors');\n\n\nvar Connector_PubNub = require('../connectors/PubNub');\n\n\n/**\n * Manage the handshake connectors using several servers\n *\n * @constructor\n * @param {String} json_uri URI of the handshake servers configuration.\n */\nfunction HandshakeManager(messagepacker, handshake_servers)\n{\n  Manager.call(this, messagepacker);\n\n  var self = this;\n\n\n  var handshakeConnectorConstructors = {};\n\n  this.registerConnectorConstructor = function(type, constructor)\n  {\n    handshakeConnectorConstructors[type] = constructor\n  };\n\n\n  // Default handshake connectors\n  this.registerConnectorConstructor('PubNub', Connector_PubNub);\n\n\n  function createConnector(config)\n  {\n    var type            = config.type;\n    var config_init     = config.config_init;\n    var config_mess     = config.config_mess;\n    var max_connections = config.max_connections;\n\n    // Check if connector constructor is from a valid handshake server\n    var connectorConstructor = handshakeConnectorConstructors[type];\n    if(!connectorConstructor)\n      throw Error(\"Invalid handshake server type '\" + type + \"'\");\n\n    var connector = new connectorConstructor(config_init, config_mess, max_connections);\n\n    self._initConnector(connector);\n\n    connector.on('open', function()\n    {\n      // Notify our presence to the other peers\n      connector.send(messagepacker.presence());\n    });\n\n    var _messageUnpacked = connector._messageUnpacked;\n    connector._messageUnpacked = function(message)\n    {\n      if(message.type == 'presence')\n      {\n        if(connector.shouldConnect())\n          self.emit(\"presence\", message.from, connector);\n      }\n      else\n        _messageUnpacked.call(connector, message);\n    };\n\n    return connector;\n  };\n\n\n  var configs = [];\n  var index = 0;\n\n  var configs_infinity = [];\n\n  /**\n   * Get a random handshake connector or test for the next one\n   * @param {Object} configuration Handshake servers configuration.\n   */\n  function handshake()\n  {\n    if(!configs.length)\n      throw Error('No handshake servers defined')\n\n    for(; index < configs.length; index++)\n    {\n      var connector = createConnector(configs[index]);\n          connector.on('close', function()\n      {\n        // Handshake connector has been closed, try to get an alternative one\n        index++;\n        handshake();\n      });\n\n      // Connector successfully created\n      return;\n    };\n\n    // All configured handshake servers has been consumed\n    // Get ready to start again from beginning of handshake servers list\n    index = 0;\n  };\n\n\n  this.addConfigs_byObject = function(config)\n  {\n    // Check if connector constructor is from a valid handshake server\n    var connectorConstructor = handshakeConnectorConstructors[config.type];\n    if(!connectorConstructor)\n    {\n      console.error(\"Invalid handshake server config: \", config);\n      return;\n    };\n\n    if(connectorConstructor.prototype.max_connections == Number.POSITIVE_INFINITY\n    && !config.max_connections)\n    {\n      configs_infinity.push(config)\n\n      // Start handshaking\n      createConnector(config);\n    }\n    else\n    {\n      configs.push(config);\n\n      // Start handshaking\n      if(self.status == 'disconnected')\n      {\n        if(index == undefined)\n           index = 0;\n\n        handshake();\n      }\n    }\n  };\n\n  this.addConfigs_byArray = function(configuration)\n  {\n    for(var i=0, config; config=configuration[i]; i++)\n      self.addConfigs_byObject(config);\n  };\n\n  this.addConfigs_byUri = function(json_uri)\n  {\n    function dispatchError(error)\n    {\n      self.emit('error', error);\n    };\n\n    // Request the handshake servers configuration file\n    var http_request = new XMLHttpRequest();\n\n    http_request.open('GET', json_uri);\n    http_request.onload = function(event)\n    {\n      if(this.status == 200)\n      {\n        var configuration = JSON.parse(http_request.response);\n\n        // We got some config entries\n        if(configuration.length)\n          this.addConfigs_byArray(configuration)\n\n        // Config was empty\n        else\n          dispatchError(errors.ERROR_REQUEST_EMPTY)\n      }\n\n      // Request returned an error\n      else\n        dispatchError(errors.ERROR_REQUEST_FAILURE)\n    };\n\n    // Connection error\n    http_request.onerror = function(event)\n    {\n      dispatchError(navigator.onLine ? errors.ERROR_NETWORK_UNKNOWN\n                                     : errors.ERROR_NETWORK_OFFLINE)\n    };\n\n    http_request.send();\n  };\n\n  this.addConfigs = function(configuration)\n  {\n    if(typeof configuration == 'string')\n      this.addConfigs_byUri(configuration)\n\n    else if(configuration instanceof Array)\n      this.addConfigs_byArray(configuration)\n\n    else\n      this.addConfigs_byObject(configuration)\n  };\n\n\n  // Add handshake servers configuration\n  if(handshake_servers)\n    this.addConfigs(handshake_servers)\n};\nHandshakeManager.prototype.__proto__   = Manager.prototype;\nHandshakeManager.prototype.constructor = HandshakeManager;\n\n\nmodule.exports = HandshakeManager;","var EventEmitter = require(\"events\").EventEmitter;\n\n\nfunction Manager(messagepacker)\n{\n  EventEmitter.call(this);\n\n  var self = this;\n\n\n  this._connectors = [];\n\n  this.__defineGetter__(\"status\", function()\n  {\n    return this._connectors.length ? 'connected' : 'disconnected';\n  });\n\n\n  this._initConnector = function(connector)\n  {\n    connector.on('open', function()\n    {\n      self._connectors.push(connector);\n\n      if(self._connectors.length == 1)\n         self.emit('connected');\n    });\n    connector.on('close', function()\n    {\n      self._connectors.splice(self._connectors.indexOf(connector), 1);\n\n      if(self._connectors.length == 0)\n         self.emit('disconnected');\n    });\n    connector.on('error', function(error)\n    {\n      connector.close();\n\n      self.emit('error', error);\n    });\n\n    connector._messageUnpacked = function(message)\n    {\n      switch(message.type)\n      {\n        case 'offer':\n        case 'answer':\n          self.emit(message.type, message, connector);\n        break;\n\n        default:\n          console.error(\"Unknown message type '\"+type+\"'\");\n          console.error(message);\n      };\n    };\n\n    connector.on('message', function(message)\n    {\n      message = messagepacker.unpack(message);\n      if(message)\n      {\n        // Response was previously stored, send it directly\n        if(message.stored)\n          connector.send(message)\n\n        // Normal message, process it\n        else\n          connector._messageUnpacked(message);\n      };\n    });\n  };\n\n\n  /**\n   * {Object} message - Message to be send\n   * {Connector} [incomingConnector] - {Connector} to don't send the message\n   */\n  this.send = function(message, incomingConnector)\n  {\n    for(var i=0, connector; connector=this._connectors[i]; i++)\n    {\n      // Don't send the message to the same connector where we received it\n      if(connector === incomingConnector)\n        continue;\n\n      connector.send(message);\n    };\n  };\n\n\n  /**\n   * Close all the connections\n   */\n  this.close = function()\n  {\n    for(var i=0, connector; connector=this._connectors[i]; i++)\n      connector.close();\n  };\n};\nManager.prototype.__proto__   = EventEmitter.prototype;\nManager.prototype.constructor = Manager;\n\n\nmodule.exports = Manager;","var Manager = require('./Manager');\n\nvar Connector_DataChannel = require('../connectors/core/DataChannel');\n\n\n/**\n * @classdesc Manager of the communications with the other peers\n *\n * @constructor\n */\nfunction PeersManager(messagepacker, routingLabel)\n{\n  Manager.call(this, messagepacker);\n\n  var self = this;\n\n\n  function createConnector(channel)\n  {\n    var connector = new Connector_DataChannel(channel);\n\n    self._initConnector(connector);\n\n    return connector;\n  };\n\n\n  var peers = {};\n\n  this.__defineGetter__(\"peers\", function()\n  {\n    return peers;\n  });\n\n\n  function initDataChannel(channel, sessionID)\n  {\n    if(channel.label == routingLabel)\n    {\n      var connector = createConnector(channel);\n          connector.sessionID = sessionID;\n\n      return connector;\n    };\n  };\n\n  this.add = function(sessionID, peerConnection)\n  {\n    peerConnection.addEventListener('signalingstatechange', function(event)\n    {\n      // Remove the peer from the list of peers when gets closed\n      if(peerConnection.signalingState == 'closed')\n        delete peers[sessionID];\n    });\n\n    // Routing DataChannel, just init routing functionality on it\n    var channels = peerConnection.getDataChannels();\n\n    if(channels.length)\n    {\n      for(var i=0, channel; channel=channels[i]; i++)\n        if(initDataChannel(channel, sessionID))\n          break;\n    }\n    else\n    {\n      function initDataChannel_listener(event)\n      {\n        var channel = event.channel;\n\n        var connector = initDataChannel(channel, sessionID);\n        if(connector)\n        {\n          event.target.removeEventListener('datachannel', initDataChannel_listener);\n\n          // Force to exec the 'open' event on the connector if the datachannel\n          // was already open when the 'datachannel' event was dispatched\n          if(channel.readyState == 'open')\n            connector.emit('open');\n        }\n      };\n\n      peerConnection.addEventListener('datachannel', initDataChannel_listener);\n    };\n\n    // Add PeerConnection to the list of enabled ones\n    peers[sessionID] = peerConnection;\n  };\n\n  this.get = function(sessionID)\n  {\n    return peers[sessionID];\n  };\n};\nPeersManager.prototype.__proto__   = Manager.prototype;\nPeersManager.prototype.constructor = PeersManager;\n\n\nmodule.exports = PeersManager;","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        throw TypeError('Uncaught, unspecified \"error\" event.');\n      }\n      return false;\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      console.trace();\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var RTCIceCandidate       = window.mozRTCIceCandidate       || window.webkitRTCIceCandidate       || window.RTCIceCandidate;\nvar RTCPeerConnection     = window.mozRTCPeerConnection     || window.webkitRTCPeerConnection     || window.RTCPeerConnection;\nvar RTCSessionDescription = window.mozRTCSessionDescription || window.webkitRTCSessionDescription || window.RTCSessionDescription;\n\n\nexports.RTCIceCandidate       = RTCIceCandidate;\nexports.RTCPeerConnection     = RTCPeerConnection;\nexports.RTCSessionDescription = RTCSessionDescription;","// Version: 3.5.48\n(function(){\nvar j=!0,t=null,u=!1;function x(){return function(){}}\nwindow.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(a){return t}}function c(a){d.lastIndex=0;return d.test(a)?'\"'+a.replace(d,function(a){var b=H[a];return\"string\"===typeof b?b:\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)})+'\"':'\"'+a+'\"'}function b(d,h){var p,f,q,r,i,k=e,g=h[d];g&&\"object\"===typeof g&&(g=a.call(g));\"function\"===typeof m&&(g=m.call(h,d,g));switch(typeof g){case \"string\":return c(g);case \"number\":return isFinite(g)?String(g):\"null\";case \"boolean\":case \"null\":return String(g);\ncase \"object\":if(!g)return\"null\";e+=s;i=[];if(\"[object Array]\"===Object.prototype.toString.apply(g)){r=g.length;for(p=0;p<r;p+=1)i[p]=b(p,g)||\"null\";q=0===i.length?\"[]\":e?\"[\\n\"+e+i.join(\",\\n\"+e)+\"\\n\"+k+\"]\":\"[\"+i.join(\",\")+\"]\";e=k;return q}if(m&&\"object\"===typeof m){r=m.length;for(p=0;p<r;p+=1)f=m[p],\"string\"===typeof f&&(q=b(f,g))&&i.push(c(f)+(e?\": \":\":\")+q)}else for(f in g)Object.hasOwnProperty.call(g,f)&&(q=b(f,g))&&i.push(c(f)+(e?\": \":\":\")+q);q=0===i.length?\"{}\":e?\"{\\n\"+e+i.join(\",\\n\"+e)+\"\\n\"+\nk+\"}\":\"{\"+i.join(\",\")+\"}\";e=k;return q}}window.JSON||(window.JSON={});var d=/[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,e,s,H={\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"},m;\"function\"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var f;s=e=\"\";if(\"number\"===typeof d)for(f=0;f<d;f+=1)s+=\" \";else\"string\"===typeof d&&(s=d);if((m=c)&&\"function\"!==typeof c&&(\"object\"!==typeof c||\"number\"!==\ntypeof c.length))throw Error(\"JSON.stringify\");return b(\"\",{\"\":a})});\"function\"!==typeof JSON.parse&&(JSON.parse=function(a){return eval(\"(\"+a+\")\")})}();var aa=1,C=u,ba=[],G=\"-pnpres\",I=1E3,ca=\"/\",da=\"&\",fa=/{([\\w\\-]+)}/g;function ga(){return\"x\"+ ++aa+\"\"+ +new Date}function J(){return+new Date}var P,ha=Math.floor(20*Math.random());P=function(a,c){return 0<a.indexOf(\"pubsub.\")&&a.replace(\"pubsub\",\"ps\"+(c?ja().split(\"-\")[0]:20>++ha?ha:ha=1))||a};\nfunction ka(a,c){var b=a.join(ca),d=[];if(!c)return b;Q(c,function(a,b){\"undefined\"!=typeof b&&(b!=t&&0<encodeURIComponent(b).length)&&d.push(a+\"=\"+encodeURIComponent(b))});return b+=\"?\"+d.join(da)}function la(a,c){function b(){e+c>J()?(clearTimeout(d),d=setTimeout(b,c)):(e=J(),a())}var d,e=0;return b}function na(a,c){var b=[];Q(a||[],function(a){c(a)&&b.push(a)});return b}function oa(a,c){return a.replace(fa,function(a,d){return c[d]||a})}\nfunction ja(a){var c=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return(\"x\"==a?c:c&3|8).toString(16)});a&&a(c);return c}function Q(a,c){if(a&&c)if(\"undefined\"!=typeof a[0])for(var b=0,d=a.length;b<d;)c.call(a[b],a[b],b++);else for(b in a)a.hasOwnProperty&&a.hasOwnProperty(b)&&c.call(a[b],b,a[b])}function pa(a,c){var b=[];Q(a||[],function(a,e){b.push(c(a,e))});return b}function qa(a){var c=[];Q(a,function(a,d){d.j&&c.push(a)});return c.sort()}\nfunction ra(){setTimeout(function(){C||(C=1,Q(ba,function(a){a()}))},I)}\nif(!window.PUBNUB){var sa=function(a,c){return CryptoJS.HmacSHA256(a,c).toString(CryptoJS.enc.Base64)},ta=function(a){return document.getElementById(a)},ua=function(a){console.error(a)},va=function(a,c){var b=[];Q(a.split(/\\s+/),function(a){Q((c||document).getElementsByTagName(a),function(a){b.push(a)})});return b},U=function(a,c,b){Q(a.split(\",\"),function(a){function e(a){a||(a=window.event);b(a)||(a.cancelBubble=j,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}c.addEventListener?\nc.addEventListener(a,e,u):c.attachEvent?c.attachEvent(\"on\"+a,e):c[\"on\"+a]=e})},xa=function(){return va(\"head\")[0]},V=function(a,c,b){if(b)a.setAttribute(c,b);else return a&&a.getAttribute&&a.getAttribute(c)},ya=function(a,c){for(var b in c)if(c.hasOwnProperty(b))try{a.style[b]=c[b]+(0<\"|width|height|top|left|\".indexOf(b)&&\"number\"==typeof c[b]?\"px\":\"\")}catch(d){}},Ba=function(a){return document.createElement(a)},Da=function(){return Ca||W()?0:ga()},Fa=function(a){function c(a,b){M||(M=1,g.onerror=\nt,clearTimeout(ea),a||!b||N(b),setTimeout(function(){a&&O();var b=ta(D),c=b&&b.parentNode;c&&c.removeChild(b)},I))}if(Ca||W()){a:{var b,d,e=function(){if(!H){H=1;clearTimeout(L);try{d=JSON.parse(b.responseText)}catch(a){return r(1)}s=1;f(d)}},s=0,H=0,m=a.timeout||1E4,L=setTimeout(function(){r(1)},m),h=a.b||x(),p=a.data||{},f=a.c||x(),q=\"undefined\"===typeof a.g,r=function(a,c){s||(s=1,clearTimeout(L),b&&(b.onerror=b.onload=t,b.abort&&b.abort(),b=t),a&&h(c))};try{b=W()||window.XDomainRequest&&new XDomainRequest||\nnew XMLHttpRequest;b.onerror=b.onabort=function(){r(1,b.responseText||{error:\"Network Connection Error\"})};b.onload=b.onloadend=e;b.onreadystatechange=function(){if(b&&4==b.readyState)switch(b.status){case 401:case 402:case 403:try{d=JSON.parse(b.responseText),r(1,d)}catch(a){return r(1,b.responseText)}}};q&&(b.timeout=m);p.pnsdk=Ea;var i=ka(a.url,p);b.open(\"GET\",i,q);b.send()}catch(k){r(0);Ca=0;a=Fa(a);break a}a=r}return a}var g=Ba(\"script\"),e=a.a,D=ga(),M=0,ea=setTimeout(function(){c(1)},a.timeout||\n1E4),O=a.b||x(),m=a.data||{},N=a.c||x();window[e]=function(a){c(0,a)};a.g||(g[Ga]=Ga);g.onerror=function(){c(1)};m.pnsdk=Ea;g.src=ka(a.url,m);V(g,\"id\",D);xa().appendChild(g);return c},Ha=function(){return!(\"onLine\"in navigator)?1:navigator.onLine},W=function(){if(!Ia||!Ia.get)return 0;var a={id:W.id++,send:x(),abort:function(){a.id={}},open:function(c,b){W[a.id]=a;Ia.get(a.id,b)}};return a},Ga=\"async\",Ea=\"PubNub-JS-Web/3.5.48\",Ca=-1==navigator.userAgent.indexOf(\"MSIE 6\");window.console||(window.console=\nwindow.console||{});console.log||(console.log=console.error=(window.opera||{}).postError||x());var Ja,Ka=window.localStorage;Ja={get:function(a){try{return Ka?Ka.getItem(a):-1==document.cookie.indexOf(a)?t:((document.cookie||\"\").match(RegExp(a+\"=([^;]+)\"))||[])[1]||t}catch(c){}},set:function(a,c){try{if(Ka)return Ka.setItem(a,c)&&0;document.cookie=a+\"=\"+c+\"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/\"}catch(b){}}};var Y={list:{},unbind:function(a){Y.list[a]=[]},bind:function(a,c){(Y.list[a]=Y.list[a]||\n[]).push(c)},fire:function(a,c){Q(Y.list[a]||[],function(a){a(c)})}},Z=ta(\"pubnub\")||0,La=function(a){function c(){}function b(a,b){function c(b){b&&(ia=J()-(b/1E4+(J()-d)/2),a&&a(ia))}var d=J();b&&c(b)||z.time(c)}function d(a,b){R&&R(a,b);R=t}function e(){z.time(function(a){b(x(),a);a||d(1,{error:\"Heartbeat failed to connect to Pubnub Servers.Please check your network settings.\"});setTimeout(e,q)})}function s(){Na()||d(1,{error:\"Offline. Please check your network settings. \"});setTimeout(s,I)}function H(a){var b=\n0;Q(qa(E),function(c){if(c=E[c])b++,(a||x())(c)});return b}function m(a){if(Oa){if(!y.length)return}else{a&&(y.h=0);if(y.h||!y.length)return;y.h=1}A(y.shift())}a.jsonp&&(Ca=0);var L=a.subscribe_key||\"\";a.uuid||Ja.get(L+\"uuid\");a.xdr=Fa;a.db=Ja;a.error=ua;a._is_online=Ha;a.jsonp_cb=Da;a.PNSDK=Ea;a.hmac_SHA256=sa;var h,p=+a.windowing||10,f=(+a.timeout||310)*I,q=(+a.keepalive||60)*I,r=a.noleave||0,i=a.publish_key||\"demo\",k=a.subscribe_key||\"demo\",g=a.auth_key||\"\",D=a.secret_key||\"\",M=a.PNSDK||\"\",ea=\na.hmac_SHA256,O=a.ssl?\"s\":\"\",N=\"http\"+O+\"://\"+(a.origin||\"pubsub.pubnub.com\"),K=P(N),wa=P(N),y=[],ia=0,za=0,Aa=0,R=0,ma=0,S=0,E={},Oa=a.no_wait_for_pending,A=a.xdr,l=a.error||x(),Na=a._is_online||function(){return 1},F=a.jsonp_cb||function(){return 0},T=a.db||{get:x(),set:x()},B=a.uuid||T&&T.get(k+\"uuid\")||\"\",z={LEAVE:function(a,b,c,d){var X={uuid:B,auth:g},e=P(N),c=c||x(),v=d||x(),d=F();if(0<a.indexOf(G))return j;if(r||!O||\"0\"==d)return u;\"0\"!=d&&(X.callback=d);A({g:b||O,timeout:2E3,a:d,data:X,c:function(a){\"object\"==\ntypeof a&&a.error?v(a):c(a)},b:v,url:[e,\"v2\",\"presence\",\"sub_key\",k,\"channel\",encodeURIComponent(a),\"leave\"]});return j},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||\"false\",X=a.error||x(),e=a.auth_key||g,v=a.channel,w=a.start,h=a.end,n={},i=F();if(!v)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");n.stringtoken=\"true\";n.count=c;n.reverse=d;n.auth=e;i&&(n.callback=i);w&&(n.start=w);h&&(n.end=h);A({a:i,data:n,\nc:function(a){\"object\"==typeof a&&a.error?X(a):b(a)},b:X,url:[K,\"v2\",\"history\",\"sub-key\",k,\"channel\",encodeURIComponent(v)]})},replay:function(a){var b=b||a.callback||x(),c=a.auth_key||g,d=a.source,e=a.destination,h=a.stop,v=a.start,w=a.end,Pa=a.reverse,a=a.limit,n=F(),f={};if(!d)return l(\"Missing Source Channel\");if(!e)return l(\"Missing Destination Channel\");if(!i)return l(\"Missing Publish Key\");if(!k)return l(\"Missing Subscribe Key\");\"0\"!=n&&(f.callback=n);h&&(f.stop=\"all\");Pa&&(f.reverse=\"true\");\nv&&(f.start=v);w&&(f.end=w);a&&(f.count=a);f.auth=c;A({a:n,c:function(a){\"object\"==typeof a&&a.error?err(a):b(a)},b:function(){b([0,\"Disconnected\"])},url:[K,\"v1\",\"replay\",i,k,d,e],data:f})},auth:function(a){g=a;c()},time:function(a){var b=F();A({a:b,data:{uuid:B,auth:g},timeout:5*I,url:[K,\"time\",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||x(),c=a.message,d=a.channel,e=a.auth_key||g,h=a.error||x(),v=F(),w=\"push\";a.prepend&&(w=\"unshift\");if(!c)return l(\"Missing Message\");\nif(!d)return l(\"Missing Channel\");if(!i)return l(\"Missing Publish Key\");if(!k)return l(\"Missing Subscribe Key\");c=JSON.stringify(c);y[w]({a:v,timeout:5*I,url:[K,\"publish\",i,k,0,encodeURIComponent(d),v,encodeURIComponent(c)],data:{uuid:B,auth:e},b:function(a){h(a);m(1)},c:function(a){\"object\"==typeof a&&a.error?h(a):b(a);m(1)}});m()},unsubscribe:function(a,b){var d=a.channel,b=b||a.callback||x(),e=a.error||x();S=0;ma=1;d=pa((d.join?d.join(\",\"):\"\"+d).split(\",\"),function(a){if(E[a])return a+\",\"+a+G}).join(\",\");\nQ(d.split(\",\"),function(a){var c=j;a&&(C&&(c=z.LEAVE(a,0,b,e)),c||b({action:\"leave\"}),E[a]=0)});c()},subscribe:function(a,b){function e(a){a?setTimeout(c,I):(K=P(N,1),wa=P(N,1),setTimeout(function(){z.time(e)},I));H(function(b){if(a&&b.d)return b.d=0,b.m(b.name);!a&&!b.d&&(b.d=1,b.l(b.name))})}function h(){var a=F(),b=qa(E).join(\",\");b&&(d(),R=A({timeout:O,a:a,b:function(a){n(a);R=t;z.time(e)},data:{uuid:B,auth:m},url:[wa,\"subscribe\",k,encodeURIComponent(b),a,S],c:function(a){R=t;if(!a||\"object\"==\ntypeof a&&\"error\"in a&&a.error)return n(a),setTimeout(c,I);r(a[1]);S=!S&&ma&&T.get(k)||a[1];H(function(a){a.f||(a.f=1,a.k(a.name))});y&&(S=1E4,y=0);T.set(k,a[1]);var b,d=(2<a.length?a[2]:pa(E,function(b){return pa(Array(a[0].length).join(\",\").split(\",\"),function(){return b})}).join(\",\")).split(\",\");b=function(){var a=d.shift()||Aa;return[(E[a]||{}).a||za,a.split(G)[0]]};var e=J()-ia-+a[1]/1E4;Q(a[0],function(c){var d=b();d[0](c,a,d[1],e)});setTimeout(h,L)}}))}var i=a.channel,b=(b=b||a.callback)||\na.message,m=a.auth_key||g,v=a.connect||x(),w=a.reconnect||x(),q=a.disconnect||x(),n=a.error||x(),r=a.idle||x(),s=a.presence||0,D=a.noheresync||0,y=a.backfill||0,M=a.timetoken||0,O=a.timeout||f,L=a.windowing||p;ma=a.restore;S=M;if(!i)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");Q((i.join?i.join(\",\"):\"\"+i).split(\",\"),function(a){var c=E[a]||{};E[Aa=a]={name:a,f:c.f,d:c.d,j:1,a:za=b,k:v,l:q,m:w};s&&(z.subscribe({channel:a+G,callback:s}),!c.j&&\n!D&&z.here_now({channel:a,callback:function(b){Q(\"uuids\"in b?b.uuids:[],function(c){s({action:\"join\",uuid:c,timestamp:J(),occupancy:b.occupancy||1},b,a)})}}))});c=function(){d();setTimeout(h,L)};if(!C)return ba.push(c);c()},here_now:function(a,b){var b=a.callback||b,c=a.error||x(),d=a.auth_key||g,e=a.channel,h=F(),d={uuid:B,auth:d};if(!e)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");\"0\"!=h&&(d.callback=h);A({a:h,data:d,c:function(a){\"object\"==\ntypeof a&&a.error?c(a):b(a)},b:c,url:[K,\"v2\",\"presence\",\"sub_key\",k,\"channel\",encodeURIComponent(e)]})},grant:function(a,b){var b=a.callback||b,c=a.error||x(),d=a.channel,e=F(),h=a.ttl||-1,g=a.read?\"1\":\"0\",w=a.write?\"1\":\"0\",f=a.auth_key;if(!d)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");if(!i)return l(\"Missing Publish Key\");if(!D)return l(\"Missing Secret Key\");\"0\"!=e&&(n.callback=e);var n=Math.floor((new Date).getTime()/1E3),m=ea(k+\"\\n\"+i+\n\"\\ngrant\\n\"+(f&&0<encodeURIComponent(f).length?\"auth=\"+encodeURIComponent(f)+\"&\":\"\")+\"channel=\"+encodeURIComponent(d)+\"&pnsdk=\"+encodeURIComponent(M)+\"&r=\"+g+\"&timestamp=\"+encodeURIComponent(n)+(-1<h?\"&ttl=\"+h:\"\")+\"&w=\"+w,D),m=m.replace(/\\+/g,\"-\"),m=m.replace(/\\//g,\"_\"),n={w:w,r:g,signature:m,channel:encodeURIComponent(d),timestamp:n};-1<h&&(n.ttl=h);f&&(n.auth=encodeURIComponent(f));A({a:e,data:n,c:function(a){b(a)},b:c,url:[K,\"v1\",\"auth\",\"grant\",\"sub-key\",k]})},audit:function(a,b){var b=a.callback||\nb,c=a.error||x(),d=a.channel,e=a.auth_key,h=F();if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");if(!i)return l(\"Missing Publish Key\");if(!D)return l(\"Missing Secret Key\");\"0\"!=h&&(g.callback=h);var g=Math.floor((new Date).getTime()/1E3),f=k+\"\\n\"+i+\"\\naudit\\n\";e&&(f+=\"auth=\"+encodeURIComponent(e)+\"&\");d&&(f+=\"channel=\"+encodeURIComponent(d)+\"&\");var f=f+(\"pnsdk=\"+encodeURIComponent(M)+\"&timestamp=\"+g),f=ea(f,D),f=f.replace(/\\+/g,\"-\"),f=f.replace(/\\//g,\"_\"),g={signature:f,\ntimestamp:g};d&&(g.channel=encodeURIComponent(d));e&&(g.auth=encodeURIComponent(e));A({a:h,data:g,c:function(a){b(a)},b:c,url:[K,\"v1\",\"auth\",\"audit\",\"sub-key\",k]})},revoke:function(a,b){a.read=u;a.write=u;z.grant(a,b)},set_uuid:function(a){B=a;c()},get_uuid:function(){return B},xdr:A,ready:ra,db:T,uuid:ja,map:pa,each:Q,\"each-channel\":H,grep:na,offline:function(){d(1)},supplant:oa,now:J,unique:ga,updater:la};B||(B=z.uuid());T.set(k+\"uuid\",B);setTimeout(s,I);setTimeout(e,q);b();h=z;h.css=ya;h.$=ta;\nh.create=Ba;h.bind=U;h.head=xa;h.search=va;h.attr=V;h.events=Y;h.init=La;U(\"beforeunload\",window,function(){h[\"each-channel\"](function(a){h.LEAVE(a.name,0)});return j});if(a.notest)return h;U(\"offline\",window,h.offline);U(\"offline\",document,h.offline);return h};\"complete\"===document.readyState?setTimeout(ra,0):U(\"load\",window,function(){setTimeout(ra,0)});var $=Z||{};PUBNUB=La({notest:1,publish_key:V($,\"pub-key\"),subscribe_key:V($,\"sub-key\"),ssl:!document.location.href.indexOf(\"https\")||\"on\"==V($,\n\"ssl\"),origin:V($,\"origin\"),uuid:V($,\"uuid\")});window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);\"undefined\"!==typeof module&&(module.exports=PUBNUB)&&ra();var Ia=ta(\"pubnubs\")||0;if(Z){ya(Z,{position:\"absolute\",top:-I});if(\"opera\"in window||V(Z,\"flash\"))Z.innerHTML=\"<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>\";PUBNUB.rdx=function(a,c){if(!c)return W[a].onerror();\nW[a].responseText=unescape(c);W[a].onload()};W.id=I}}\nvar Ma=PUBNUB.ws=function(a,c){if(!(this instanceof Ma))return new Ma(a,c);var b=this,a=b.url=a||\"\";b.protocol=c||\"Sec-WebSocket-Protocol\";var d=a.split(\"/\"),d={ssl:\"wss:\"===d[0],origin:d[2],publish_key:d[3],subscribe_key:d[4],channel:d[5]};b.CONNECTING=0;b.OPEN=1;b.CLOSING=2;b.CLOSED=3;b.CLOSE_NORMAL=1E3;b.CLOSE_GOING_AWAY=1001;b.CLOSE_PROTOCOL_ERROR=1002;b.CLOSE_UNSUPPORTED=1003;b.CLOSE_TOO_LARGE=1004;b.CLOSE_NO_STATUS=1005;b.CLOSE_ABNORMAL=1006;b.onclose=b.onerror=b.onmessage=b.onopen=b.onsend=\nx();b.binaryType=\"\";b.extensions=\"\";b.bufferedAmount=0;b.trasnmitting=u;b.buffer=[];b.readyState=b.CONNECTING;if(!a)return b.readyState=b.CLOSED,b.onclose({code:b.CLOSE_ABNORMAL,reason:\"Missing URL\",wasClean:j}),b;b.e=PUBNUB.init(d);b.e.i=d;b.i=d;b.e.subscribe({restore:u,channel:d.channel,disconnect:b.onerror,reconnect:b.onopen,error:function(){b.onclose({code:b.CLOSE_ABNORMAL,reason:\"Missing URL\",wasClean:u})},callback:function(a){b.onmessage({data:a})},connect:function(){b.readyState=b.OPEN;b.onopen()}})};\nMa.prototype.send=function(a){var c=this;c.e.publish({channel:c.e.i.channel,message:a,callback:function(a){c.onsend({data:a})}})};\n})();\n"]}