{"version":3,"file":"bundle.js","sources":["../lib/MessagePacker.js","../lib/PeerConnection_channels.shim.js","../lib/WebP2P.js","../lib/connectors/PubNub.js","../lib/connectors/core/Connector.js","../lib/connectors/core/DataChannel.js","../lib/connectors/core/HandshakeConnector.js","../lib/errors.js","../lib/index.js","../lib/managers/HandshakeManager.js","../lib/managers/Manager.js","../lib/managers/PeersManager.js","../node_modules/grunt-browserify/node_modules/browserify/node_modules/events/events.js","../node_modules/wrtc/lib/browser.js","../shim/pubnub.min.js"],"names":["MessagePacker","sessionID","storeResponse","message","dest","id","stored","response","timeout","setTimeout","clearTimeout","responses","BASE_TIMEOUT","self","this","requestID","requests","pack","result","Array","type","PRESENCE","OFFER","ANSWER","error","Error","from","Math","min","ttl","MAX_TTL_DEFAULT","sdp","unpack","reply","request_ids","request","callback","presence","offer","dispatchCallback","cancel","Object","keys","length","ERROR","module","exports","applyChannelsShim","pc","initChannel","channel","channels","push","addEventListener","splice","indexOf","undefined","getDataChannels","dispatchEvent","event","call","createDataChannel","label","dataChannelDict","WebP2P","options","onerror","emit","createPeerConnection","callbackType","RTCPeerConnection","iceServers","url","stun_server","optional","DtlsSrtpKeyAgreement","candidate","localDescription","console","signalingState","offers","peersManager","add","defineProperty","value","initPeerConnection_Offer","labels","routingLabel","concat","commonLabels","i","mediaConstraints","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","createOffer","setLocalDescription","log","initPeerConnection_Answer","setRemoteDescription","RTCSessionDescription","createAnswer","answer","forward","connector","warning","peer","_connectors","send","handshakeManager","initManagerEvents","manager","connectionProcessed","get","peerConnection","close","on","status","warn","UUIDv4","b","a","random","toString","replace","handshake_servers","messagepacker","HandshakeManager","PeersManager","__defineGetter__","peers","connectTo","Function","SyntaxError","increaseConnections","window","EventEmitter","require","prototype","__proto__","constructor","Connector_PubNub","config_init","config_mess","max_connections","HandshakeConnector","pubnub","PUBNUB","init","subscribe","restore","backfill","connect","_open","_message","disconnect","_close","_error","unsubscribe","publish","Connector","TypeError","Connector_DataChannel","datachannel","JSON","parse","data","stringify","shouldConnect","connections","Number","POSITIVE_INFINITY","ERROR_NETWORK_UNKNOWN","msg","ERROR_NETWORK_OFFLINE","ERROR_REQUEST_FAILURE","ERROR_REQUEST_EMPTY","ERROR_NO_PEERS","createConnector","config","connectorConstructor","handshakeConnectorConstructors","_initConnector","_messageUnpacked","handshake","configs","index","Manager","registerConnectorConstructor","configs_infinity","addConfigs_byObject","addConfigs_byArray","configuration","addConfigs_byUri","json_uri","dispatchError","http_request","XMLHttpRequest","open","onload","errors","navigator","onLine","addConfigs","incomingConnector","initRoutingChannel","initRoutingChannel_listener","removeEventListener","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","er","handler","len","args","listeners","arguments","apply","slice","addListener","listener","m","newListener","warned","trace","once","g","removeListener","fired","list","position","removeAllListeners","key","ret","listenerCount","emitter","RTCIceCandidate","mozRTCIceCandidate","webkitRTCIceCandidate","mozRTCPeerConnection","webkitRTCPeerConnection","mozRTCSessionDescription","webkitRTCSessionDescription","x","ga","aa","Date","J","ka","c","join","ca","d","Q","t","encodeURIComponent","da","la","e","na","oa","fa","ja","hasOwnProperty","pa","qa","j","sort","ra","C","ba","I","u","valueOf","lastIndex","test","H","charCodeAt","h","p","f","q","r","k","isFinite","String","s","\\b","\\t","\\n","\\f","\\r","\"","\\\\","eval","G","P","ha","floor","split","sa","CryptoJS","HmacSHA256","enc","Base64","ta","document","getElementById","ua","va","getElementsByTagName","U","cancelBubble","preventDefault","stopPropagation","attachEvent","xa","V","setAttribute","getAttribute","ya","style","Ba","createElement","Da","Ca","W","Fa","M","ea","N","O","D","parentNode","removeChild","L","responseText","abort","XDomainRequest","onabort","onloadend","onreadystatechange","readyState","pnsdk","Ea","Ga","src","appendChild","Ha","Ia","userAgent","opera","postError","Ja","Ka","localStorage","getItem","cookie","match","RegExp","set","setItem","Y","unbind","bind","fire","Z","La","ia","z","time","R","Na","E","Oa","y","A","shift","jsonp","subscribe_key","uuid","xdr","db","_is_online","jsonp_cb","PNSDK","hmac_SHA256","windowing","keepalive","noleave","publish_key","auth_key","secret_key","ssl","origin","K","wa","za","Aa","ma","S","no_wait_for_pending","l","F","T","B","LEAVE","X","auth","v","history","count","limit","reverse","w","start","end","stringtoken","replay","source","destination","stop","Pa","err","prepend","action","name","reconnect","idle","noheresync","timetoken","here_now","uuids","timestamp","occupancy","grant","read","write","getTime","signature","audit","revoke","set_uuid","get_uuid","ready","map","each","each-channel","grep","offline","supplant","now","unique","updater","css","$","create","head","search","attr","events","notest","location","href","jQuery","top","innerHTML","rdx","unescape","Ma","ws","protocol","CONNECTING","OPEN","CLOSING","CLOSED","CLOSE_NORMAL","CLOSE_GOING_AWAY","CLOSE_PROTOCOL_ERROR","CLOSE_UNSUPPORTED","CLOSE_TOO_LARGE","CLOSE_NO_STATUS","CLOSE_ABNORMAL","onclose","onmessage","onopen","onsend","binaryType","extensions","bufferedAmount","trasnmitting","buffer","code","reason","wasClean"],"mappings":"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","sourcesContent":["/**\n * Based on code from RPC-Builder\n */\n\n\nconst ERROR    = 0;\nconst PRESENCE = 1;\nconst OFFER    = 2;\nconst ANSWER   = 3;\n\nconst MAX_TTL_DEFAULT = 5;\n\nconst BASE_TIMEOUT = 5000;\n\n\nfunction MessagePacker(sessionID)\n{\n  var self = this;\n\n  var requestID = 0;\n\n  var requests  = {};\n  var responses = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, dest, id)\n  {\n    message.stored = true;\n\n    var response =\n    {\n      message: message,\n      id: id,\n      timeout: setTimeout(function()\n      {\n        clearTimeout(response.timeout);\n        delete responses[dest];\n      },\n      BASE_TIMEOUT)\n    };\n    responses[dest] = response;\n  };\n\n\n  //\n  // Pack & Unpack\n  //\n\n  this.pack = function(message, id)\n  {\n    var result = new Array(6);\n\n    // Type\n    var type = message.type;\n    switch(type)\n    {\n      case \"presence\":\n        result[0] = PRESENCE;\n      break;\n\n      case \"offer\":\n        result[0] = OFFER;\n      break;\n\n      case \"answer\":\n        result[0] = ANSWER;\n      break;\n\n      default:\n      {\n        var error = Error(\"Unknown message type '\"+type+\"'\");\n            error.message = message;\n\n        throw error;\n      };\n    };\n\n    // From\n    result[1] = message.from || sessionID;\n\n    // Offer & Answer\n\n    if(result.type != PRESENCE)\n    {\n      result[2] = message.dest;\n      result[3] = id || requestID++;\n      result[4] = Math.min(message.ttl || MAX_TTL_DEFAULT, MAX_TTL_DEFAULT);\n      result[5] = message.sdp;\n    };\n\n    return result;\n  };\n\n  this.unpack = function(message)\n  {\n    var result = {};\n\n    var from = message[1];\n    var id   = message[3];\n\n    // Type\n    var type = message[0];\n    switch(type)\n    {\n      case PRESENCE:\n        result.type = \"presence\";\n      break;\n\n      case OFFER:\n        result.type = \"offer\";\n      break;\n\n      case ANSWER:\n        result.type = \"answer\";\n      break;\n\n      default:\n      {\n        var error = Error(\"Unknown message type '\"+type+\"'\");\n            error.message = message;\n\n        throw error;\n      };\n    };\n\n    // From\n    result.from = from;\n\n    // Offer & Answer\n\n    if(type != PRESENCE)\n    {\n      result.dest = message[2];\n      result.ttl  = message[4];\n      result.sdp  = message[5];\n\n      result.pack = function()\n      {\n        return self.pack(this, id);\n      };\n    };\n\n    // Dispatch responses callbacks\n    if(result.type == 'offer')\n    {\n      // Check if it's a re-try\n      var response = responses[from];\n      if(response)\n      {\n        // Old message, ignore it\n        if(response.id > id)\n          return;\n\n        // Updated message (or duplicated one), delete old response\n        clearTimeout(response.timeout);\n        delete responses[from];\n\n        // Duplicated message, re-send it\n        if(response.id == id)\n        {\n          var message = response.message;\n\n          // Store the response to prevent to process duplicate request later\n          storeResponse(message, from, id);\n\n          // Return the stored response so it can be directly send back\n          return message;\n        };\n      }\n      else\n        result.reply = function(dest, sdp)\n        {\n          var message = self.pack(\n          {\n            type: \"answer\",\n            dest: dest,\n            sdp:  sdp\n          }, id);\n\n          // Store the response to prevent to process duplicate request later\n          storeResponse(message, dest, id);\n\n          // Return the packed message\n          return message;\n        };\n    };\n\n    if(result.type == 'answer')\n    {\n      var request_ids = requests[from];\n      if(request_ids)\n      {\n        var request = request_ids[id];\n        if(request)\n        {\n          request.callback(error, result);\n\n          // Return undefined to notify message has been procesed\n          return;\n        };\n      };\n    };\n\n    // Return unpacked message\n    return result;\n  };\n\n\n  //\n  // Application dependent messages\n  //\n\n  this.presence = function()\n  {\n    var message = this.pack(\n    {\n      type: \"presence\"\n    });\n\n    // Return the packed message\n    return message;\n  };\n\n  this.offer = function(dest, sdp, callback)\n  {\n    var message = this.pack(\n    {\n      type: \"offer\",\n      dest: dest,\n      sdp:  sdp\n    });\n\n    message.cancel = function(){};\n\n    // Store callback if defined to be executed when received the response\n    if(callback)\n    {\n      var request_ids = requests[dest] = requests[dest] || {};\n\n      var id = message[3];\n\n      var request = request_ids[id] =\n      {\n        message: message,\n        callback: dispatchCallback,\n        timeout:  setTimeout(function()\n        {\n          var error = new Error('Timed Out');\n              error.request = message;\n\n          dispatchCallback(error)\n        },\n        BASE_TIMEOUT)\n      };\n\n      message.cancel = function()\n      {\n        clearTimeout(request.timeout);\n\n        delete request_ids[id];\n        if(!Object.keys(request_ids).length)\n          delete requests[dest];\n      };\n\n      function dispatchCallback(error, result)\n      {\n        message.cancel();\n\n        callback(error, result);\n      };\n    };\n\n    // Return the packed message\n    return message;\n  };\n};\n\n\nmodule.exports = MessagePacker;","/**\n * Add support to get a list of channels on a PeerConnection object\n */\nfunction applyChannelsShim(pc)\n{\n  if(pc.getDataChannels != undefined) return;\n\n  var channels = [];\n\n  pc.getDataChannels = function()\n  {\n    return channels;\n  };\n\n  function initChannel(channel)\n  {\n    channels.push(channel);\n\n    channel.addEventListener('close', function(event)\n    {\n      channels.splice(channels.indexOf(channel), 1);\n    });\n  };\n\n  // Add DataChannels created by remote PeerConnection object\n  var dispatchEvent = pc.dispatchEvent;\n  pc.dispatchEvent = function(event)\n  {\n    if(event.type == 'datachannel')\n    {\n      var channel = event.channel;\n\n      initChannel(channel);\n    };\n\n    // Dispatch events\n    dispatchEvent.call(this, event);\n  };\n\n  // Add DataChannels created by local PeerConnection object\n  var createDataChannel = pc.createDataChannel;\n  pc.createDataChannel = function(label, dataChannelDict)\n  {\n    var channel = createDataChannel.call(this, label, dataChannelDict);\n\n    initChannel(channel);\n\n    return channel;\n  };\n};\n\n\nmodule.exports = applyChannelsShim;\n","var EventEmitter = require(\"events\").EventEmitter;\n\nvar RTCPeerConnection = require('wrtc').RTCPeerConnection;\n//var uuid = require('uuid');\n\nvar HandshakeManager = require('./managers/HandshakeManager');\nvar PeersManager     = require('./managers/PeersManager');\n\nvar MessagePacker = require('./MessagePacker');\n\nvar applyChannelsShim = require(\"./PeerConnection_channels.shim\");\n\n\n/**\n * @classdesc Init and connect to the WebP2P.io network\n *\n * @constructor\n */\nfunction WebP2P(options)\n{\n  var self = this;\n\n\n  /**\n   * UUID generator\n   */\n  var UUIDv4 = function b(a)\n  {\n    return a ? (a ^ Math.random() * 16 >> a / 4).toString(16) : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, b);\n  };\n\n\n  var options = options || {};\n\n  // Internal options\n  var commonLabels      = options.commonLabels || [];\n  var handshake_servers = options.handshake_servers;\n  var stun_server       = options.stun_server || 'stun.l.google.com:19302';\n\n  // Read-only options\n  Object.defineProperty(this, \"routingLabel\",\n  {\n    value: options.routingLabel || \"webp2p\"\n  });\n  Object.defineProperty(this, \"sessionID\",\n  {\n    value: options.sessionID || UUIDv4()\n//    value: options.sessionID || uuid.v4()\n  });\n\n\n  var messagepacker = new MessagePacker(this.sessionID);\n\n  var handshakeManager = new HandshakeManager(messagepacker, handshake_servers);\n  var peersManager     = new PeersManager(messagepacker, self.routingLabel);\n\n  this.__defineGetter__('status', function()\n  {\n    if(peersManager.status == 'connected')\n      return 'connected';\n\n    return handshakeManager.status;\n  });\n\n  this.__defineGetter__(\"peers\", function()\n  {\n    return peersManager.peers;\n  });\n\n\n  function onerror(error)\n  {\n    self.emit('error', new Error(error));\n  };\n\n\n  var offers = {};\n\n  /**\n   * Create a new RTCPeerConnection\n   * @param {UUID} id Identifier of the other peer so later can be accessed.\n   *\n   * @return {RTCPeerConnection}\n   */\n  function createPeerConnection(sessionID, callbackType, callback)\n  {\n    var pc = new RTCPeerConnection\n    (\n      {iceServers: [{url: 'stun:'+stun_server}]},\n      {optional: [{DtlsSrtpKeyAgreement: true}]}\n    );\n\n    applyChannelsShim(pc);\n\n    pc.addEventListener('icecandidate', function(event)\n    {\n      // There's a candidate, ignore it\n      if(event.candidate)\n        return;\n\n      // There's no candidate, send the full SDP\n      var type = this.localDescription.type;\n      var sdp  = this.localDescription.sdp;\n\n      if(type == callbackType)\n        callback(sdp)\n      else\n        console.error(type+\" SDP type is not equal to \"+callbackType+\" callback type\");\n    });\n\n    pc.addEventListener('signalingstatechange', function(event)\n    {\n      // Add PeerConnection object to available ones when gets open\n      if(pc.signalingState == 'stable')\n      {\n        delete offers[sessionID];\n        peersManager.add(sessionID, pc);\n      };\n    });\n\n    // Set ID of the PeerConnection\n    Object.defineProperty(pc, \"sessionID\", {value : sessionID});\n\n    return pc;\n  };\n\n\n  function initPeerConnection_Offer(pc, labels)\n  {\n    // Set channels for this PeerConnection object\n    labels = [self.routingLabel].concat(commonLabels, labels);\n\n    for(var i=0, label; label=labels[i]; i++)\n      pc.createDataChannel(label);\n\n    // Send offer\n    var mediaConstraints =\n    {\n      mandatory:\n      {\n        OfferToReceiveAudio: false,\n        OfferToReceiveVideo: false\n      }\n    };\n\n    pc.createOffer(function(offer)\n    {\n      // Set the peer local description\n      pc.setLocalDescription(offer,\n      function()\n      {\n        console.log('['+self.sessionID+'] Offer LocalDescription created and set');\n      },\n      onerror);\n    },\n    onerror,\n    mediaConstraints);\n  };\n\n  function initPeerConnection_Answer(pc, sdp)\n  {\n    // Process offer\n    pc.setRemoteDescription(new RTCSessionDescription(\n    {\n      sdp:  sdp,\n      type: 'offer'\n    }),\n    function()\n    {\n      // Send answer\n      pc.createAnswer(function(answer)\n      {\n        // Set the peer local description\n        pc.setLocalDescription(answer,\n        function()\n        {\n          console.log('['+self.sessionID+'] Answer LocalDescription created and set');\n        },\n        onerror);\n      },\n      onerror)\n    },\n    onerror);\n  };\n\n\n  //\n  // Connection methods\n  //\n\n  /**\n   * Callback to send the offer. If not defined send it to all connected peers.\n   *\n   * @callback WebP2P~ConnectToCallback\n   * @param {Error} error\n   * @param {RTCPeerConnection} peer - The (newly created) peer\n   */\n\n  /**\n   * Connects to another peer based on its UID. If we are already connected,\n   * it does nothing.\n   *\n   * @param {UUID} sessionID - Identifier of the other peer to be connected.\n   * @param {string[]} [labels] - Per-connection labels\n   * @param {WebP2P~ConnectToCallback} callback\n   */\n  this.connectTo = function(dest, labels, callback)\n  {\n    if(labels instanceof Function)\n    {\n      if(callback)\n        throw new SyntaxError(\"Nothing can be defined after the callback\");\n\n      callback = labels;\n      labels = undefined;\n    };\n\n    // Don't connect to ourself\n    if(dest == self.sessionID)\n      return callback(new Error(\"Connecting to ourself\"));\n\n    var pc = peersManager.get(dest);\n    if(pc)\n      callback(null, pc)\n\n    else\n    {\n      pc = createPeerConnection(dest, \"offer\", function(offer)\n      {\n        var message = messagepacker.offer(dest, offer, callback);\n\n        offers[dest] =\n        {\n          message: message,\n          peerConnection: pc\n        };\n\n        handshakeManager.send(message);\n        peersManager.send(message);\n      });\n\n      initPeerConnection_Offer(pc, labels);\n    }\n  };\n\n\n  //\n  // Managers\n  //\n\n  function forward(message, connector)\n  {\n    // Don't forward the message if TTL has been achieved\n    if(--message.ttl <= 0)\n    {\n      console.warning(\"TTL achieved: \"+message);\n      return;\n    };\n\n    var dest = message.dest;\n\n    message = message.pack();\n\n    // Search the peer between the ones currently connected\n    for(var i=0, peer; peer=peersManager._connectors[i]; i++)\n      if(peer.sessionID == dest)\n        return peer.send(message);\n\n    // Peer was not found, forward message to all the connectors\n    peersManager.send(message, connector);\n    handshakeManager.send(message, connector);\n  };\n\n\n  handshakeManager.on('connected', function()\n  {\n    self.emit('handshakeManager.connected');\n  });\n  handshakeManager.on('disconnected', function()\n  {\n    self.emit('handshakeManager.disconnected');\n  });\n\n  peersManager.on('peerconnection', function(peerConnection)\n  {\n    self.emit('peerconnection', peerConnection);\n  });\n\n  function initManagerEvents(manager)\n  {\n    //\n    // Basic events\n    //\n\n    manager.on('connected', function()\n    {\n      if(handshakeManager.status != peersManager.status)\n        self.emit('connected');\n    });\n    manager.on('disconnected', function()\n    {\n      if(handshakeManager.status == peersManager.status)\n        self.emit('disconnected');\n    });\n    manager.on('error', function(error)\n    {\n      self.emit('error', error);\n    });\n\n    //\n    // Offer & answer events\n    //\n\n    /**\n     * Check if it's a request from a peer we are already connected or trying to\n     * connect to, so we can prevent to do crossed connections\n     *\n     * @param sessionID - ID of the other peer\n     *\n     * @returns {Boolean} - If we are already connected or trying to connect\n     */\n    function connectionProcessed(sessionID)\n    {\n      // Check if we are already connected to the requester peer\n      var peer = peersManager.get(sessionID);\n      if(peer)\n      {\n        // We are already connected to that peer, ignore the request\n        console.log(\"[\"+self.sessionID+\"] Already connected to \"+sessionID);\n        return true;\n      };\n\n      // Check if we are already trying to connect to that peer\n      var offer = offers[sessionID];\n      if(offer)\n      {\n        // We are already trying to connected to that peer, ignore the request\n        console.log(\"[\"+self.sessionID+\"] Already offered connection to \"+sessionID);\n\n        // We have higher precedence, ignore incoming connection request\n        if(self.sessionID < sessionID)\n          return true;  // Should send an error to the other end\n\n        // We have less precedence, cancel our connection request and prepare to\n        // incoming one\n        offer.message.cancel();\n        offer.peerConnection.close();\n\n        delete offers[sessionID];\n      };\n\n      // Connection request is a genuinely new one, process it as usual\n      return false;\n    };\n\n    manager.on('offer', function(message, connector)\n    {\n      var from = message.from;\n      var dest = message.dest;\n\n      // Ignore messages send by us\n      if(from == self.sessionID) return;\n\n      // Message is for us\n      if(dest == self.sessionID)\n      {\n        console.log(\"[\"+self.sessionID+\"] Received connection request from \"+from);\n\n        if(connectionProcessed(from))\n          return;\n\n        var request = message;\n\n        // Search the peer between the list of currently connected ones,\n        // or create it if it's not connected\n        var pc = createPeerConnection(from, \"answer\", function(answer)\n        {\n          var message = request.reply(from, answer);\n\n          // Send back the connection request over the same connector, since\n          // this should be the shortest path to connect both peers\n          connector.send(message);\n        });\n\n        initPeerConnection_Answer(pc, message.sdp);\n      }\n\n      // Forward message\n      else\n        forward(message, connector);\n    });\n\n    manager.on('answer', function(message, connector)\n    {\n      var from = message.from;\n      var dest = message.dest;\n\n      // Ignore messages send by us\n      if(from == self.sessionID) return;\n\n      // Message is for us\n      if(dest == self.sessionID)\n      {\n        console.log(\"[\"+self.sessionID+\"] Received connection response from \"+from);\n\n        var peer = offers[from];\n        if(peer)\n        {\n          peer.peerConnection.setRemoteDescription(new RTCSessionDescription(\n          {\n            sdp: message.sdp,\n            type: 'answer'\n          }),\n          function()\n          {\n            console.log(\"Successfuly generated RemoteDescription for \"+from);\n          },\n          onerror);\n        }\n        else\n          console.warn(\"[\"+self.sessionID+\"] Connection with peer '\" + from + \"' was not previously requested\");\n      }\n\n      // Forward message\n      else\n        forward(message, connector);\n    });\n  };\n\n  // Init managers events\n\n  initManagerEvents(handshakeManager);\n  initManagerEvents(peersManager);\n\n  handshakeManager.on('presence', function(from, connector)\n  {\n    // Ignore messages send by us\n    if(from == self.sessionID) return;\n\n    var peer = peersManager.get(from);\n    if(!peer)\n    {\n      var pc = createPeerConnection(from, \"offer\", function(offer)\n      {\n        var message = messagepacker.offer(from, offer);\n\n        offers[from] =\n        {\n          message: message,\n          peerConnection: pc\n        };\n\n        // Send back the connection request over the same connector, since this\n        // should be the shortest path to connect both peers\n        connector.send(message);\n      });\n\n      pc.addEventListener('signalingstatechange', function(event)\n      {\n        // Add PeerConnection object to available ones when gets open\n        if(pc.signalingState == 'stable')\n          connector.increaseConnections();\n      });\n\n      initPeerConnection_Offer(pc);\n    }\n  });\n\n\n  //\n  // Clossing functions\n  //\n\n  this.close = function()\n  {\n    handshakeManager.close();\n    peersManager.close();\n  };\n\n  // Close all connections when user goes out of the page\n  if(window)\n    window.addEventListener('beforeunload', function(event)\n    {\n      self.close();\n    });\n};\nWebP2P.prototype.__proto__   = EventEmitter.prototype;\nWebP2P.prototype.constructor = WebP2P;\n\n\nmodule.exports = WebP2P;\n","var HandshakeConnector = require(\"./core/HandshakeConnector\");\n\nvar PUBNUB = require(\"pubnub\");\n\n\n/**\n * Handshake connector for PubNub\n * @param {Object} configuration Configuration object.\n */\nfunction Connector_PubNub(config_init, config_mess, max_connections)\n{\n  HandshakeConnector.call(this, max_connections);\n\n  var self = this;\n\n  var channel = config_mess.channel;\n\n\n  // Connect a handshake connector to the PubNub server\n  var pubnub = PUBNUB.init(config_init);\n\n  // Configure handshake connector\n  pubnub.subscribe(\n  {\n    channel: channel,\n    restore: false,\n    backfill: false,\n\n    connect:    self._open,\n    message:    self._message,\n    disconnect: self._close,\n    error:      self._error\n  });\n\n\n  // Define methods\n\n  /**\n   * Close the connection with this handshake server\n   */\n  this.close = function()\n  {\n    pubnub.unsubscribe(\n    {\n      channel: channel\n    });\n\n    // This shouldn't be necesary, but seems 'disconnect' event is not being\n    // dispatched by the PubNub channel, so we close the connector explicitly\n    self._close();\n  }\n\n  /**\n   * Send the message\n   */\n  this.send = function(message)\n  {\n    pubnub.publish(\n    {\n      channel: channel,\n      message: message\n    });\n  };\n}\nConnector_PubNub.prototype.__proto__   = HandshakeConnector.prototype;\nConnector_PubNub.prototype.constructor = Connector_PubNub;\n\n// Class constants\nConnector_PubNub.prototype.max_connections = 50;\nObject.defineProperty(Connector_PubNub.prototype, 'max_chars', {value: 1800});\n\n\nmodule.exports = Connector_PubNub;\n","var EventEmitter = require(\"events\").EventEmitter;\n\n\nfunction Connector()\n{\n  EventEmitter.call(this);\n\n  var self = this;\n\n\n  /**\n   * Notify that the connection to this handshake server is open\n   */\n  this._open = function()\n  {\n    self.emit('open');\n  };\n\n  this._message = function(message)\n  {\n    self.emit(\"message\", message);\n  };\n\n  this._close = function()\n  {\n    self.emit('close');\n  };\n\n  this._error = function(error)\n  {\n    self.emit('error', error);\n  };\n};\nConnector.prototype.__proto__   = EventEmitter.prototype;\nConnector.prototype.constructor = Connector;\n\nConnector.prototype.close = function()\n{\n  throw new TypeError(\"Connector.close should be defined in a child class\");\n};\nConnector.prototype.send = function(message)\n{\n  throw new TypeError(\"Connector.send should be defined in a child class\");\n};\n\n\nmodule.exports = Connector;","var Connector = require(\"./Connector\");\n\n\nfunction Connector_DataChannel(datachannel)\n{\n  Connector.call(this);\n\n  var self = this;\n\n\n  datachannel.addEventListener('open',  self._open);\n  datachannel.addEventListener('message', function(event)\n  {\n    self._message(JSON.parse(event.data));\n  });\n  datachannel.addEventListener('close', self._close);\n  datachannel.addEventListener('error', self._error);\n\n\n  // Define methods\n\n  /**\n   * Close the connection with the peer\n   */\n  this.close = function()\n  {\n    datachannel.close();\n  };\n\n  /**\n   * Send the message\n   */\n  this.send = function(message)\n  {\n    datachannel.send(JSON.stringify(message));\n  };\n};\nConnector_DataChannel.prototype.__proto__   = Connector.prototype;\nConnector_DataChannel.prototype.constructor = Connector_DataChannel;\n\n\nmodule.exports = Connector_DataChannel;","var Connector = require(\"./Connector\");\n\n\nfunction HandshakeConnector(max_connections)\n{\n  Connector.call(this);\n\n  var self = this;\n\n\n  if(max_connections != undefined)\n    this.max_connections = Math.min(max_connections, this.max_connections);\n\n  /**\n   * Check if we should connect this new peer or ignore it to increase entropy\n   * in the network mesh\n   *\n   * @returns {Boolean}\n   */\n  this.shouldConnect = function()\n  {\n    return true;\n  };\n\n\n  // Count the maximum number of pending connections allowed to be\n  // done with this handshake server (undefined == unlimited)\n  var connections = 0;\n\n  this.increaseConnections = function()\n  {\n    // Increase the number of connections reached throught\n    // this handshake server\n    connections++;\n\n    // Close connection with handshake server if we got its quota of peers\n    if(connections >= self.max_connections)\n       self.close();\n  };\n};\nHandshakeConnector.prototype.__proto__   = Connector.prototype;\nHandshakeConnector.prototype.constructor = HandshakeConnector;\n\n// Class constants\nHandshakeConnector.prototype.max_connections = Number.POSITIVE_INFINITY;\n\n\nmodule.exports = HandshakeConnector;\n","const ERROR_NETWORK_UNKNOWN = {id: 0, msg: 'Unable to fetch handshake servers configuration'};\nconst ERROR_NETWORK_OFFLINE = {id: 1, msg: \"There's no available network\"};\nconst ERROR_REQUEST_FAILURE = {id: 2, msg: 'Unable to fetch handshake servers configuration'};\nconst ERROR_REQUEST_EMPTY   = {id: 3, msg: 'Handshake servers configuration is empty'};\n\nconst ERROR_NO_PEERS        = {id: 4, msg: 'Not connected to any peer'};\n\n\nexports.ERROR_NETWORK_UNKNOWN = ERROR_NETWORK_UNKNOWN;\nexports.ERROR_NETWORK_OFFLINE = ERROR_NETWORK_OFFLINE;\nexports.ERROR_REQUEST_FAILURE = ERROR_REQUEST_FAILURE;\nexports.ERROR_REQUEST_EMPTY   = ERROR_REQUEST_EMPTY;\nexports.ERROR_NO_PEERS        = ERROR_NO_PEERS;","/**\n * New node file\n */\nvar HandshakeConnector = require('./connectors/core/HandshakeConnector');\nvar WebP2P             = require('./WebP2P');\n\n\nmodule.exports = WebP2P;\nmodule.exports.HandshakeConnector = HandshakeConnector;","var Manager = require('./Manager');\n\nvar errors = require('../errors');\n\n\nvar Connector_PubNub = require('../connectors/PubNub');\n\n\n/**\n * Manage the handshake connectors using several servers\n *\n * @constructor\n * @param {String} json_uri URI of the handshake servers configuration.\n */\nfunction HandshakeManager(messagepacker, handshake_servers)\n{\n  Manager.call(this, messagepacker);\n\n  var self = this;\n\n\n  var handshakeConnectorConstructors = {};\n\n  this.registerConnectorConstructor = function(type, constructor)\n  {\n    handshakeConnectorConstructors[type] = constructor\n  };\n\n\n  // Default handshake connectors\n  this.registerConnectorConstructor('PubNub', Connector_PubNub);\n\n\n  function createConnector(config)\n  {\n    var type            = config.type;\n    var config_init     = config.config_init;\n    var config_mess     = config.config_mess;\n    var max_connections = config.max_connections;\n\n    // Check if connector constructor is from a valid handshake server\n    var connectorConstructor = handshakeConnectorConstructors[type];\n    if(!connectorConstructor)\n      throw Error(\"Invalid handshake server type '\" + type + \"'\");\n\n    var connector = new connectorConstructor(config_init, config_mess, max_connections);\n\n    self._initConnector(connector);\n\n    connector.on('open', function()\n    {\n      // Notify our presence to the other peers\n      connector.send(messagepacker.presence());\n    });\n\n    var _messageUnpacked = connector._messageUnpacked;\n    connector._messageUnpacked = function(message)\n    {\n      if(message.type == 'presence')\n      {\n        if(connector.shouldConnect())\n          self.emit(\"presence\", message.from, connector);\n      }\n      else\n        _messageUnpacked.call(connector, message);\n    };\n\n    return connector;\n  };\n\n\n  var configs = [];\n  var index = 0;\n\n  var configs_infinity = [];\n\n  /**\n   * Get a random handshake connector or test for the next one\n   * @param {Object} configuration Handshake servers configuration.\n   */\n  function handshake()\n  {\n    if(!configs.length)\n      throw Error('No handshake servers defined')\n\n    for(; index < configs.length; index++)\n    {\n      var connector = createConnector(configs[index]);\n          connector.on('close', function()\n      {\n        // Handshake connector has been closed, try to get an alternative one\n        index++;\n        handshake();\n      });\n\n      // Connector successfully created\n      return;\n    };\n\n    // All configured handshake servers has been consumed\n    // Get ready to start again from beginning of handshake servers list\n    index = 0;\n  };\n\n\n  this.addConfigs_byObject = function(config)\n  {\n    // Check if connector constructor is from a valid handshake server\n    var connectorConstructor = handshakeConnectorConstructors[config.type];\n    if(!connectorConstructor)\n    {\n      console.error(\"Invalid handshake server config: \", config);\n      return;\n    };\n\n    if(connectorConstructor.prototype.max_connections == Number.POSITIVE_INFINITY\n    && !config.max_connections)\n    {\n      configs_infinity.push(config)\n\n      // Start handshaking\n      createConnector(config);\n    }\n    else\n    {\n      configs.push(config);\n\n      // Start handshaking\n      if(self.status == 'disconnected')\n      {\n        if(index == undefined)\n           index = 0;\n\n        handshake();\n      }\n    }\n  };\n\n  this.addConfigs_byArray = function(configuration)\n  {\n    for(var i=0, config; config=configuration[i]; i++)\n      self.addConfigs_byObject(config);\n  };\n\n  this.addConfigs_byUri = function(json_uri)\n  {\n    function dispatchError(error)\n    {\n      self.emit('error', error);\n    };\n\n    // Request the handshake servers configuration file\n    var http_request = new XMLHttpRequest();\n\n    http_request.open('GET', json_uri);\n    http_request.onload = function(event)\n    {\n      if(this.status == 200)\n      {\n        var configuration = JSON.parse(http_request.response);\n\n        // We got some config entries\n        if(configuration.length)\n          this.addConfigs_byArray(configuration)\n\n        // Config was empty\n        else\n          dispatchError(errors.ERROR_REQUEST_EMPTY)\n      }\n\n      // Request returned an error\n      else\n        dispatchError(errors.ERROR_REQUEST_FAILURE)\n    };\n\n    // Connection error\n    http_request.onerror = function(event)\n    {\n      dispatchError(navigator.onLine ? errors.ERROR_NETWORK_UNKNOWN\n                                     : errors.ERROR_NETWORK_OFFLINE)\n    };\n\n    http_request.send();\n  };\n\n  this.addConfigs = function(configuration)\n  {\n    if(typeof configuration == 'string')\n      this.addConfigs_byUri(configuration)\n\n    else if(configuration instanceof Array)\n      this.addConfigs_byArray(configuration)\n\n    else\n      this.addConfigs_byObject(configuration)\n  };\n\n\n  // Add handshake servers configuration\n  if(handshake_servers)\n    this.addConfigs(handshake_servers)\n};\nHandshakeManager.prototype.__proto__   = Manager.prototype;\nHandshakeManager.prototype.constructor = HandshakeManager;\n\n\nmodule.exports = HandshakeManager;\n","var EventEmitter = require(\"events\").EventEmitter;\n\n\nfunction Manager(messagepacker)\n{\n  EventEmitter.call(this);\n\n  var self = this;\n\n\n  this._connectors = [];\n\n  this.__defineGetter__(\"status\", function()\n  {\n    return this._connectors.length ? 'connected' : 'disconnected';\n  });\n\n\n  this._initConnector = function(connector)\n  {\n    connector.on('open', function()\n    {\n      self._connectors.push(connector);\n\n      if(self._connectors.length == 1)\n         self.emit('connected');\n    });\n    connector.on('close', function()\n    {\n      self._connectors.splice(self._connectors.indexOf(connector), 1);\n\n      if(self._connectors.length == 0)\n         self.emit('disconnected');\n    });\n    connector.on('error', function(error)\n    {\n      connector.close();\n\n      self.emit('error', error);\n    });\n\n    connector._messageUnpacked = function(message)\n    {\n      switch(message.type)\n      {\n        case 'offer':\n        case 'answer':\n          self.emit(message.type, message, connector);\n        break;\n\n        default:\n          console.error(\"Unknown message type '\"+type+\"'\");\n          console.error(message);\n      };\n    };\n\n    connector.on('message', function(message)\n    {\n      message = messagepacker.unpack(message);\n      if(message)\n      {\n        // Response was previously stored, send it directly\n        if(message.stored)\n          connector.send(message)\n\n        // Normal message, process it\n        else\n          connector._messageUnpacked(message);\n      };\n    });\n  };\n\n\n  /**\n   * {Object} message - Message to be send\n   * {Connector} [incomingConnector] - {Connector} to don't send the message\n   */\n  this.send = function(message, incomingConnector)\n  {\n    for(var i=0, connector; connector=this._connectors[i]; i++)\n    {\n      // Don't send the message to the same connector where we received it\n      if(connector === incomingConnector)\n        continue;\n\n      peer.send(message);\n    };\n  };\n\n\n  /**\n   * Close all the connections\n   */\n  this.close = function()\n  {\n    for(var i=0, connector; connector=this._connectors[i]; i++)\n      connector.close();\n  };\n};\nManager.prototype.__proto__   = EventEmitter.prototype;\nManager.prototype.constructor = Manager;\n\n\nmodule.exports = Manager;\n","var Manager = require('./Manager');\n\nvar Connector_DataChannel = require('../connectors/core/DataChannel');\n\n\n/**\n * @classdesc Manager of the communications with the other peers\n *\n * @constructor\n */\nfunction PeersManager(messagepacker, routingLabel)\n{\n  Manager.call(this, messagepacker);\n\n  var self = this;\n\n\n  function createConnector(channel)\n  {\n    var connector = new Connector_DataChannel(channel);\n\n    self._initConnector(connector);\n\n    return connector;\n  };\n\n\n  var peers = {};\n\n  this.__defineGetter__(\"peers\", function()\n  {\n    return peers;\n  });\n\n\n  this.add = function(sessionID, peerConnection)\n  {\n    peerConnection.addEventListener('signalingstatechange', function(event)\n    {\n      // Remove the peer from the list of peers when gets closed\n      if(peerConnection.signalingState == 'closed')\n        delete peers[sessionID];\n    });\n\n    function initRoutingChannel(channel)\n    {\n      if(channel.label == routingLabel)\n      {\n        var connector = createConnector(channel);\n            connector.sessionID = sessionID;\n\n        // Add PeerConnection to the list of enabled ones\n        peers[sessionID] = peerConnection;\n\n        self.emit('peerconnection', peerConnection);\n\n        // Notify that the routing channel has been initialized\n        return true;\n      };\n    };\n\n    function initRoutingChannel_listener(event)\n    {\n      if(initRoutingChannel(event.channel))\n        peerConnection.removeEventListener('datachannel', initRoutingChannel_listener);\n    };\n\n    // Routing DataChannel, just init routing functionality on it\n    var channels = peerConnection.getDataChannels();\n    if(channels)\n      for(var i=0, channel; channel=channels[i]; i++)\n        if(initRoutingChannel(channel))\n          return;\n\n    // Channels were not still created, wait until they are done\n    else\n      peerConnection.addEventListener('datachannel', initRoutingChannel_listener);\n  };\n\n  this.get = function(sessionID)\n  {\n    return peers[sessionID];\n  };\n};\nPeersManager.prototype.__proto__   = Manager.prototype;\nPeersManager.prototype.constructor = PeersManager;\n\n\nmodule.exports = PeersManager;\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        throw TypeError('Uncaught, unspecified \"error\" event.');\n      }\n      return false;\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      console.trace();\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var RTCIceCandidate       = window.mozRTCIceCandidate       || window.webkitRTCIceCandidate       || window.RTCIceCandidate;\nvar RTCPeerConnection     = window.mozRTCPeerConnection     || window.webkitRTCPeerConnection     || window.RTCPeerConnection;\nvar RTCSessionDescription = window.mozRTCSessionDescription || window.webkitRTCSessionDescription || window.RTCSessionDescription;\n\n\nexports.RTCIceCandidate       = RTCIceCandidate;\nexports.RTCPeerConnection     = RTCPeerConnection;\nexports.RTCSessionDescription = RTCSessionDescription;","// Version: 3.5.48\n(function(){\nvar j=!0,t=null,u=!1;function x(){return function(){}}\nwindow.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(a){return t}}function c(a){d.lastIndex=0;return d.test(a)?'\"'+a.replace(d,function(a){var b=H[a];return\"string\"===typeof b?b:\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)})+'\"':'\"'+a+'\"'}function b(d,h){var p,f,q,r,i,k=e,g=h[d];g&&\"object\"===typeof g&&(g=a.call(g));\"function\"===typeof m&&(g=m.call(h,d,g));switch(typeof g){case \"string\":return c(g);case \"number\":return isFinite(g)?String(g):\"null\";case \"boolean\":case \"null\":return String(g);\ncase \"object\":if(!g)return\"null\";e+=s;i=[];if(\"[object Array]\"===Object.prototype.toString.apply(g)){r=g.length;for(p=0;p<r;p+=1)i[p]=b(p,g)||\"null\";q=0===i.length?\"[]\":e?\"[\\n\"+e+i.join(\",\\n\"+e)+\"\\n\"+k+\"]\":\"[\"+i.join(\",\")+\"]\";e=k;return q}if(m&&\"object\"===typeof m){r=m.length;for(p=0;p<r;p+=1)f=m[p],\"string\"===typeof f&&(q=b(f,g))&&i.push(c(f)+(e?\": \":\":\")+q)}else for(f in g)Object.hasOwnProperty.call(g,f)&&(q=b(f,g))&&i.push(c(f)+(e?\": \":\":\")+q);q=0===i.length?\"{}\":e?\"{\\n\"+e+i.join(\",\\n\"+e)+\"\\n\"+\nk+\"}\":\"{\"+i.join(\",\")+\"}\";e=k;return q}}window.JSON||(window.JSON={});var d=/[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,e,s,H={\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"},m;\"function\"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var f;s=e=\"\";if(\"number\"===typeof d)for(f=0;f<d;f+=1)s+=\" \";else\"string\"===typeof d&&(s=d);if((m=c)&&\"function\"!==typeof c&&(\"object\"!==typeof c||\"number\"!==\ntypeof c.length))throw Error(\"JSON.stringify\");return b(\"\",{\"\":a})});\"function\"!==typeof JSON.parse&&(JSON.parse=function(a){return eval(\"(\"+a+\")\")})}();var aa=1,C=u,ba=[],G=\"-pnpres\",I=1E3,ca=\"/\",da=\"&\",fa=/{([\\w\\-]+)}/g;function ga(){return\"x\"+ ++aa+\"\"+ +new Date}function J(){return+new Date}var P,ha=Math.floor(20*Math.random());P=function(a,c){return 0<a.indexOf(\"pubsub.\")&&a.replace(\"pubsub\",\"ps\"+(c?ja().split(\"-\")[0]:20>++ha?ha:ha=1))||a};\nfunction ka(a,c){var b=a.join(ca),d=[];if(!c)return b;Q(c,function(a,b){\"undefined\"!=typeof b&&(b!=t&&0<encodeURIComponent(b).length)&&d.push(a+\"=\"+encodeURIComponent(b))});return b+=\"?\"+d.join(da)}function la(a,c){function b(){e+c>J()?(clearTimeout(d),d=setTimeout(b,c)):(e=J(),a())}var d,e=0;return b}function na(a,c){var b=[];Q(a||[],function(a){c(a)&&b.push(a)});return b}function oa(a,c){return a.replace(fa,function(a,d){return c[d]||a})}\nfunction ja(a){var c=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return(\"x\"==a?c:c&3|8).toString(16)});a&&a(c);return c}function Q(a,c){if(a&&c)if(\"undefined\"!=typeof a[0])for(var b=0,d=a.length;b<d;)c.call(a[b],a[b],b++);else for(b in a)a.hasOwnProperty&&a.hasOwnProperty(b)&&c.call(a[b],b,a[b])}function pa(a,c){var b=[];Q(a||[],function(a,e){b.push(c(a,e))});return b}function qa(a){var c=[];Q(a,function(a,d){d.j&&c.push(a)});return c.sort()}\nfunction ra(){setTimeout(function(){C||(C=1,Q(ba,function(a){a()}))},I)}\nif(!window.PUBNUB){var sa=function(a,c){return CryptoJS.HmacSHA256(a,c).toString(CryptoJS.enc.Base64)},ta=function(a){return document.getElementById(a)},ua=function(a){console.error(a)},va=function(a,c){var b=[];Q(a.split(/\\s+/),function(a){Q((c||document).getElementsByTagName(a),function(a){b.push(a)})});return b},U=function(a,c,b){Q(a.split(\",\"),function(a){function e(a){a||(a=window.event);b(a)||(a.cancelBubble=j,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}c.addEventListener?\nc.addEventListener(a,e,u):c.attachEvent?c.attachEvent(\"on\"+a,e):c[\"on\"+a]=e})},xa=function(){return va(\"head\")[0]},V=function(a,c,b){if(b)a.setAttribute(c,b);else return a&&a.getAttribute&&a.getAttribute(c)},ya=function(a,c){for(var b in c)if(c.hasOwnProperty(b))try{a.style[b]=c[b]+(0<\"|width|height|top|left|\".indexOf(b)&&\"number\"==typeof c[b]?\"px\":\"\")}catch(d){}},Ba=function(a){return document.createElement(a)},Da=function(){return Ca||W()?0:ga()},Fa=function(a){function c(a,b){M||(M=1,g.onerror=\nt,clearTimeout(ea),a||!b||N(b),setTimeout(function(){a&&O();var b=ta(D),c=b&&b.parentNode;c&&c.removeChild(b)},I))}if(Ca||W()){a:{var b,d,e=function(){if(!H){H=1;clearTimeout(L);try{d=JSON.parse(b.responseText)}catch(a){return r(1)}s=1;f(d)}},s=0,H=0,m=a.timeout||1E4,L=setTimeout(function(){r(1)},m),h=a.b||x(),p=a.data||{},f=a.c||x(),q=\"undefined\"===typeof a.g,r=function(a,c){s||(s=1,clearTimeout(L),b&&(b.onerror=b.onload=t,b.abort&&b.abort(),b=t),a&&h(c))};try{b=W()||window.XDomainRequest&&new XDomainRequest||\nnew XMLHttpRequest;b.onerror=b.onabort=function(){r(1,b.responseText||{error:\"Network Connection Error\"})};b.onload=b.onloadend=e;b.onreadystatechange=function(){if(b&&4==b.readyState)switch(b.status){case 401:case 402:case 403:try{d=JSON.parse(b.responseText),r(1,d)}catch(a){return r(1,b.responseText)}}};q&&(b.timeout=m);p.pnsdk=Ea;var i=ka(a.url,p);b.open(\"GET\",i,q);b.send()}catch(k){r(0);Ca=0;a=Fa(a);break a}a=r}return a}var g=Ba(\"script\"),e=a.a,D=ga(),M=0,ea=setTimeout(function(){c(1)},a.timeout||\n1E4),O=a.b||x(),m=a.data||{},N=a.c||x();window[e]=function(a){c(0,a)};a.g||(g[Ga]=Ga);g.onerror=function(){c(1)};m.pnsdk=Ea;g.src=ka(a.url,m);V(g,\"id\",D);xa().appendChild(g);return c},Ha=function(){return!(\"onLine\"in navigator)?1:navigator.onLine},W=function(){if(!Ia||!Ia.get)return 0;var a={id:W.id++,send:x(),abort:function(){a.id={}},open:function(c,b){W[a.id]=a;Ia.get(a.id,b)}};return a},Ga=\"async\",Ea=\"PubNub-JS-Web/3.5.48\",Ca=-1==navigator.userAgent.indexOf(\"MSIE 6\");window.console||(window.console=\nwindow.console||{});console.log||(console.log=console.error=(window.opera||{}).postError||x());var Ja,Ka=window.localStorage;Ja={get:function(a){try{return Ka?Ka.getItem(a):-1==document.cookie.indexOf(a)?t:((document.cookie||\"\").match(RegExp(a+\"=([^;]+)\"))||[])[1]||t}catch(c){}},set:function(a,c){try{if(Ka)return Ka.setItem(a,c)&&0;document.cookie=a+\"=\"+c+\"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/\"}catch(b){}}};var Y={list:{},unbind:function(a){Y.list[a]=[]},bind:function(a,c){(Y.list[a]=Y.list[a]||\n[]).push(c)},fire:function(a,c){Q(Y.list[a]||[],function(a){a(c)})}},Z=ta(\"pubnub\")||0,La=function(a){function c(){}function b(a,b){function c(b){b&&(ia=J()-(b/1E4+(J()-d)/2),a&&a(ia))}var d=J();b&&c(b)||z.time(c)}function d(a,b){R&&R(a,b);R=t}function e(){z.time(function(a){b(x(),a);a||d(1,{error:\"Heartbeat failed to connect to Pubnub Servers.Please check your network settings.\"});setTimeout(e,q)})}function s(){Na()||d(1,{error:\"Offline. Please check your network settings. \"});setTimeout(s,I)}function H(a){var b=\n0;Q(qa(E),function(c){if(c=E[c])b++,(a||x())(c)});return b}function m(a){if(Oa){if(!y.length)return}else{a&&(y.h=0);if(y.h||!y.length)return;y.h=1}A(y.shift())}a.jsonp&&(Ca=0);var L=a.subscribe_key||\"\";a.uuid||Ja.get(L+\"uuid\");a.xdr=Fa;a.db=Ja;a.error=ua;a._is_online=Ha;a.jsonp_cb=Da;a.PNSDK=Ea;a.hmac_SHA256=sa;var h,p=+a.windowing||10,f=(+a.timeout||310)*I,q=(+a.keepalive||60)*I,r=a.noleave||0,i=a.publish_key||\"demo\",k=a.subscribe_key||\"demo\",g=a.auth_key||\"\",D=a.secret_key||\"\",M=a.PNSDK||\"\",ea=\na.hmac_SHA256,O=a.ssl?\"s\":\"\",N=\"http\"+O+\"://\"+(a.origin||\"pubsub.pubnub.com\"),K=P(N),wa=P(N),y=[],ia=0,za=0,Aa=0,R=0,ma=0,S=0,E={},Oa=a.no_wait_for_pending,A=a.xdr,l=a.error||x(),Na=a._is_online||function(){return 1},F=a.jsonp_cb||function(){return 0},T=a.db||{get:x(),set:x()},B=a.uuid||T&&T.get(k+\"uuid\")||\"\",z={LEAVE:function(a,b,c,d){var X={uuid:B,auth:g},e=P(N),c=c||x(),v=d||x(),d=F();if(0<a.indexOf(G))return j;if(r||!O||\"0\"==d)return u;\"0\"!=d&&(X.callback=d);A({g:b||O,timeout:2E3,a:d,data:X,c:function(a){\"object\"==\ntypeof a&&a.error?v(a):c(a)},b:v,url:[e,\"v2\",\"presence\",\"sub_key\",k,\"channel\",encodeURIComponent(a),\"leave\"]});return j},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||\"false\",X=a.error||x(),e=a.auth_key||g,v=a.channel,w=a.start,h=a.end,n={},i=F();if(!v)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");n.stringtoken=\"true\";n.count=c;n.reverse=d;n.auth=e;i&&(n.callback=i);w&&(n.start=w);h&&(n.end=h);A({a:i,data:n,\nc:function(a){\"object\"==typeof a&&a.error?X(a):b(a)},b:X,url:[K,\"v2\",\"history\",\"sub-key\",k,\"channel\",encodeURIComponent(v)]})},replay:function(a){var b=b||a.callback||x(),c=a.auth_key||g,d=a.source,e=a.destination,h=a.stop,v=a.start,w=a.end,Pa=a.reverse,a=a.limit,n=F(),f={};if(!d)return l(\"Missing Source Channel\");if(!e)return l(\"Missing Destination Channel\");if(!i)return l(\"Missing Publish Key\");if(!k)return l(\"Missing Subscribe Key\");\"0\"!=n&&(f.callback=n);h&&(f.stop=\"all\");Pa&&(f.reverse=\"true\");\nv&&(f.start=v);w&&(f.end=w);a&&(f.count=a);f.auth=c;A({a:n,c:function(a){\"object\"==typeof a&&a.error?err(a):b(a)},b:function(){b([0,\"Disconnected\"])},url:[K,\"v1\",\"replay\",i,k,d,e],data:f})},auth:function(a){g=a;c()},time:function(a){var b=F();A({a:b,data:{uuid:B,auth:g},timeout:5*I,url:[K,\"time\",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||x(),c=a.message,d=a.channel,e=a.auth_key||g,h=a.error||x(),v=F(),w=\"push\";a.prepend&&(w=\"unshift\");if(!c)return l(\"Missing Message\");\nif(!d)return l(\"Missing Channel\");if(!i)return l(\"Missing Publish Key\");if(!k)return l(\"Missing Subscribe Key\");c=JSON.stringify(c);y[w]({a:v,timeout:5*I,url:[K,\"publish\",i,k,0,encodeURIComponent(d),v,encodeURIComponent(c)],data:{uuid:B,auth:e},b:function(a){h(a);m(1)},c:function(a){\"object\"==typeof a&&a.error?h(a):b(a);m(1)}});m()},unsubscribe:function(a,b){var d=a.channel,b=b||a.callback||x(),e=a.error||x();S=0;ma=1;d=pa((d.join?d.join(\",\"):\"\"+d).split(\",\"),function(a){if(E[a])return a+\",\"+a+G}).join(\",\");\nQ(d.split(\",\"),function(a){var c=j;a&&(C&&(c=z.LEAVE(a,0,b,e)),c||b({action:\"leave\"}),E[a]=0)});c()},subscribe:function(a,b){function e(a){a?setTimeout(c,I):(K=P(N,1),wa=P(N,1),setTimeout(function(){z.time(e)},I));H(function(b){if(a&&b.d)return b.d=0,b.m(b.name);!a&&!b.d&&(b.d=1,b.l(b.name))})}function h(){var a=F(),b=qa(E).join(\",\");b&&(d(),R=A({timeout:O,a:a,b:function(a){n(a);R=t;z.time(e)},data:{uuid:B,auth:m},url:[wa,\"subscribe\",k,encodeURIComponent(b),a,S],c:function(a){R=t;if(!a||\"object\"==\ntypeof a&&\"error\"in a&&a.error)return n(a),setTimeout(c,I);r(a[1]);S=!S&&ma&&T.get(k)||a[1];H(function(a){a.f||(a.f=1,a.k(a.name))});y&&(S=1E4,y=0);T.set(k,a[1]);var b,d=(2<a.length?a[2]:pa(E,function(b){return pa(Array(a[0].length).join(\",\").split(\",\"),function(){return b})}).join(\",\")).split(\",\");b=function(){var a=d.shift()||Aa;return[(E[a]||{}).a||za,a.split(G)[0]]};var e=J()-ia-+a[1]/1E4;Q(a[0],function(c){var d=b();d[0](c,a,d[1],e)});setTimeout(h,L)}}))}var i=a.channel,b=(b=b||a.callback)||\na.message,m=a.auth_key||g,v=a.connect||x(),w=a.reconnect||x(),q=a.disconnect||x(),n=a.error||x(),r=a.idle||x(),s=a.presence||0,D=a.noheresync||0,y=a.backfill||0,M=a.timetoken||0,O=a.timeout||f,L=a.windowing||p;ma=a.restore;S=M;if(!i)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");Q((i.join?i.join(\",\"):\"\"+i).split(\",\"),function(a){var c=E[a]||{};E[Aa=a]={name:a,f:c.f,d:c.d,j:1,a:za=b,k:v,l:q,m:w};s&&(z.subscribe({channel:a+G,callback:s}),!c.j&&\n!D&&z.here_now({channel:a,callback:function(b){Q(\"uuids\"in b?b.uuids:[],function(c){s({action:\"join\",uuid:c,timestamp:J(),occupancy:b.occupancy||1},b,a)})}}))});c=function(){d();setTimeout(h,L)};if(!C)return ba.push(c);c()},here_now:function(a,b){var b=a.callback||b,c=a.error||x(),d=a.auth_key||g,e=a.channel,h=F(),d={uuid:B,auth:d};if(!e)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");\"0\"!=h&&(d.callback=h);A({a:h,data:d,c:function(a){\"object\"==\ntypeof a&&a.error?c(a):b(a)},b:c,url:[K,\"v2\",\"presence\",\"sub_key\",k,\"channel\",encodeURIComponent(e)]})},grant:function(a,b){var b=a.callback||b,c=a.error||x(),d=a.channel,e=F(),h=a.ttl||-1,g=a.read?\"1\":\"0\",w=a.write?\"1\":\"0\",f=a.auth_key;if(!d)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");if(!i)return l(\"Missing Publish Key\");if(!D)return l(\"Missing Secret Key\");\"0\"!=e&&(n.callback=e);var n=Math.floor((new Date).getTime()/1E3),m=ea(k+\"\\n\"+i+\n\"\\ngrant\\n\"+(f&&0<encodeURIComponent(f).length?\"auth=\"+encodeURIComponent(f)+\"&\":\"\")+\"channel=\"+encodeURIComponent(d)+\"&pnsdk=\"+encodeURIComponent(M)+\"&r=\"+g+\"&timestamp=\"+encodeURIComponent(n)+(-1<h?\"&ttl=\"+h:\"\")+\"&w=\"+w,D),m=m.replace(/\\+/g,\"-\"),m=m.replace(/\\//g,\"_\"),n={w:w,r:g,signature:m,channel:encodeURIComponent(d),timestamp:n};-1<h&&(n.ttl=h);f&&(n.auth=encodeURIComponent(f));A({a:e,data:n,c:function(a){b(a)},b:c,url:[K,\"v1\",\"auth\",\"grant\",\"sub-key\",k]})},audit:function(a,b){var b=a.callback||\nb,c=a.error||x(),d=a.channel,e=a.auth_key,h=F();if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");if(!i)return l(\"Missing Publish Key\");if(!D)return l(\"Missing Secret Key\");\"0\"!=h&&(g.callback=h);var g=Math.floor((new Date).getTime()/1E3),f=k+\"\\n\"+i+\"\\naudit\\n\";e&&(f+=\"auth=\"+encodeURIComponent(e)+\"&\");d&&(f+=\"channel=\"+encodeURIComponent(d)+\"&\");var f=f+(\"pnsdk=\"+encodeURIComponent(M)+\"&timestamp=\"+g),f=ea(f,D),f=f.replace(/\\+/g,\"-\"),f=f.replace(/\\//g,\"_\"),g={signature:f,\ntimestamp:g};d&&(g.channel=encodeURIComponent(d));e&&(g.auth=encodeURIComponent(e));A({a:h,data:g,c:function(a){b(a)},b:c,url:[K,\"v1\",\"auth\",\"audit\",\"sub-key\",k]})},revoke:function(a,b){a.read=u;a.write=u;z.grant(a,b)},set_uuid:function(a){B=a;c()},get_uuid:function(){return B},xdr:A,ready:ra,db:T,uuid:ja,map:pa,each:Q,\"each-channel\":H,grep:na,offline:function(){d(1)},supplant:oa,now:J,unique:ga,updater:la};B||(B=z.uuid());T.set(k+\"uuid\",B);setTimeout(s,I);setTimeout(e,q);b();h=z;h.css=ya;h.$=ta;\nh.create=Ba;h.bind=U;h.head=xa;h.search=va;h.attr=V;h.events=Y;h.init=La;U(\"beforeunload\",window,function(){h[\"each-channel\"](function(a){h.LEAVE(a.name,0)});return j});if(a.notest)return h;U(\"offline\",window,h.offline);U(\"offline\",document,h.offline);return h};\"complete\"===document.readyState?setTimeout(ra,0):U(\"load\",window,function(){setTimeout(ra,0)});var $=Z||{};PUBNUB=La({notest:1,publish_key:V($,\"pub-key\"),subscribe_key:V($,\"sub-key\"),ssl:!document.location.href.indexOf(\"https\")||\"on\"==V($,\n\"ssl\"),origin:V($,\"origin\"),uuid:V($,\"uuid\")});window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);\"undefined\"!==typeof module&&(module.exports=PUBNUB)&&ra();var Ia=ta(\"pubnubs\")||0;if(Z){ya(Z,{position:\"absolute\",top:-I});if(\"opera\"in window||V(Z,\"flash\"))Z.innerHTML=\"<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>\";PUBNUB.rdx=function(a,c){if(!c)return W[a].onerror();\nW[a].responseText=unescape(c);W[a].onload()};W.id=I}}\nvar Ma=PUBNUB.ws=function(a,c){if(!(this instanceof Ma))return new Ma(a,c);var b=this,a=b.url=a||\"\";b.protocol=c||\"Sec-WebSocket-Protocol\";var d=a.split(\"/\"),d={ssl:\"wss:\"===d[0],origin:d[2],publish_key:d[3],subscribe_key:d[4],channel:d[5]};b.CONNECTING=0;b.OPEN=1;b.CLOSING=2;b.CLOSED=3;b.CLOSE_NORMAL=1E3;b.CLOSE_GOING_AWAY=1001;b.CLOSE_PROTOCOL_ERROR=1002;b.CLOSE_UNSUPPORTED=1003;b.CLOSE_TOO_LARGE=1004;b.CLOSE_NO_STATUS=1005;b.CLOSE_ABNORMAL=1006;b.onclose=b.onerror=b.onmessage=b.onopen=b.onsend=\nx();b.binaryType=\"\";b.extensions=\"\";b.bufferedAmount=0;b.trasnmitting=u;b.buffer=[];b.readyState=b.CONNECTING;if(!a)return b.readyState=b.CLOSED,b.onclose({code:b.CLOSE_ABNORMAL,reason:\"Missing URL\",wasClean:j}),b;b.e=PUBNUB.init(d);b.e.i=d;b.i=d;b.e.subscribe({restore:u,channel:d.channel,disconnect:b.onerror,reconnect:b.onopen,error:function(){b.onclose({code:b.CLOSE_ABNORMAL,reason:\"Missing URL\",wasClean:u})},callback:function(a){b.onmessage({data:a})},connect:function(){b.readyState=b.OPEN;b.onopen()}})};\nMa.prototype.send=function(a){var c=this;c.e.publish({channel:c.e.i.channel,message:a,callback:function(a){c.onsend({data:a})}})};\n})();\n"]}