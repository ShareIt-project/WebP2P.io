{"version":3,"file":"bundle.js","sources":["../lib/MessagePacker.js","../lib/PeerConnection_channels.shim.js","../lib/WebP2P.js","../lib/connectors/PubNub.js","../lib/connectors/core/Connector.js","../lib/connectors/core/DataChannel.js","../lib/connectors/core/HandshakeConnector.js","../lib/errors.js","../lib/index.js","../lib/managers/HandshakeManager.js","../lib/managers/Manager.js","../lib/managers/PeersManager.js","../node_modules/grunt-browserify/node_modules/browserify/node_modules/events/events.js","../node_modules/wrtc/lib/browser.js","../shim/pubnub.min.js"],"names":["MessagePacker","sessionID","storeResponse","message","dest","id","stored","response","timeout","setTimeout","clearTimeout","responses","BASE_TIMEOUT","self","this","requestID","requests","pack","result","Array","type","PRESENCE","OFFER","ANSWER","error","Error","from","Math","min","ttl","MAX_TTL_DEFAULT","sdp","unpack","reply","request_ids","request","callback","presence","offer","dispatchCallback","cancel","Object","keys","length","ERROR","module","exports","applyChannelsShim","pc","initChannel","channel","channels","push","addEventListener","splice","indexOf","undefined","getDataChannels","dispatchEvent","event","call","createDataChannel","label","dataChannelDict","WebP2P","options","onerror","emit","createPeerConnection","callbackType","RTCPeerConnection","iceServers","url","stun_server","optional","DtlsSrtpKeyAgreement","candidate","localDescription","console","signalingState","peersManager","add","offers","defineProperty","value","initPeerConnection_Offer","labels","routingLabel","concat","commonLabels","i","mediaConstraints","mandatory","OfferToReceiveAudio","OfferToReceiveVideo","createOffer","setLocalDescription","log","initPeerConnection_Answer","setRemoteDescription","RTCSessionDescription","createAnswer","answer","forward","connector","warning","peer","_connectors","send","handshakeManager","initManagerEvents","manager","connectionProcessed","get","peerConnection","close","on","status","warn","UUIDv4","b","a","random","toString","replace","handshake_servers","messagepacker","HandshakeManager","PeersManager","__defineGetter__","peers","connectTo","increaseConnections","window","EventEmitter","require","prototype","__proto__","constructor","Connector_PubNub","config_init","config_mess","HandshakeConnector","pubnub","PUBNUB","init","subscribe","restore","backfill","connect","_open","_message","disconnect","_close","_error","unsubscribe","publish","max_connections","max_chars","Connector","TypeError","Connector_DataChannel","datachannel","JSON","parse","data","stringify","shouldConnect","connections","Number","POSITIVE_INFINITY","ERROR_NETWORK_UNKNOWN","msg","ERROR_NETWORK_OFFLINE","ERROR_REQUEST_FAILURE","ERROR_REQUEST_EMPTY","ERROR_NO_PEERS","createConnector","config","connectorConstructor","handshakeConnectorConstructors","_initConnector","_messageUnpacked","handshake","configs","index","Manager","registerConnectorConstructor","configs_infinity","addConfigs_byObject","addConfigs_byArray","configuration","addConfigs_byUri","json_uri","dispatchError","http_request","XMLHttpRequest","open","onload","errors","navigator","onLine","addConfigs","incomingConnector","_events","_maxListeners","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","er","handler","len","args","listeners","arguments","apply","slice","addListener","listener","m","newListener","warned","trace","once","g","removeListener","fired","list","position","removeAllListeners","key","ret","listenerCount","emitter","RTCIceCandidate","mozRTCIceCandidate","webkitRTCIceCandidate","mozRTCPeerConnection","webkitRTCPeerConnection","mozRTCSessionDescription","webkitRTCSessionDescription","x","ga","aa","Date","J","ka","c","join","ca","d","Q","t","encodeURIComponent","da","la","e","na","oa","fa","ja","hasOwnProperty","pa","qa","j","sort","ra","C","ba","I","u","valueOf","lastIndex","test","H","charCodeAt","h","p","f","q","r","k","isFinite","String","s","\\b","\\t","\\n","\\f","\\r","\"","\\\\","eval","G","P","ha","floor","split","sa","CryptoJS","HmacSHA256","enc","Base64","ta","document","getElementById","ua","va","getElementsByTagName","U","cancelBubble","preventDefault","stopPropagation","attachEvent","xa","V","setAttribute","getAttribute","ya","style","Ba","createElement","Da","Ca","W","Fa","M","ea","N","O","D","parentNode","removeChild","L","responseText","abort","XDomainRequest","onabort","onloadend","onreadystatechange","readyState","pnsdk","Ea","Ga","src","appendChild","Ha","Ia","userAgent","opera","postError","Ja","Ka","localStorage","getItem","cookie","match","RegExp","set","setItem","Y","unbind","bind","fire","Z","La","ia","z","time","R","Na","E","Oa","y","A","shift","jsonp","subscribe_key","uuid","xdr","db","_is_online","jsonp_cb","PNSDK","hmac_SHA256","windowing","keepalive","noleave","publish_key","auth_key","secret_key","ssl","origin","K","wa","za","Aa","ma","S","no_wait_for_pending","l","F","T","B","LEAVE","X","auth","v","history","count","limit","reverse","w","start","end","stringtoken","replay","source","destination","stop","Pa","err","prepend","action","name","reconnect","idle","noheresync","timetoken","here_now","uuids","timestamp","occupancy","grant","read","write","getTime","signature","audit","revoke","set_uuid","get_uuid","ready","map","each","each-channel","grep","offline","supplant","now","unique","updater","css","$","create","head","search","attr","events","notest","location","href","jQuery","top","innerHTML","rdx","unescape","Ma","ws","protocol","CONNECTING","OPEN","CLOSING","CLOSED","CLOSE_NORMAL","CLOSE_GOING_AWAY","CLOSE_PROTOCOL_ERROR","CLOSE_UNSUPPORTED","CLOSE_TOO_LARGE","CLOSE_NO_STATUS","CLOSE_ABNORMAL","onclose","onmessage","onopen","onsend","binaryType","extensions","bufferedAmount","trasnmitting","buffer","code","reason","wasClean"],"mappings":"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","sourcesContent":["/**\n * Based on code from RPC-Builder\n */\n\n\nconst ERROR    = 0;\nconst PRESENCE = 1;\nconst OFFER    = 2;\nconst ANSWER   = 3;\n\nconst MAX_TTL_DEFAULT = 5;\n\nconst BASE_TIMEOUT = 5000;\n\n\nfunction MessagePacker(sessionID)\n{\n  var self = this;\n\n  var requestID = 0;\n\n  var requests  = {};\n  var responses = {};\n\n\n  /**\n   * Store the response to prevent to process duplicate request later\n   */\n  function storeResponse(message, dest, id)\n  {\n    message.stored = true;\n\n    var response =\n    {\n      message: message,\n      id: id,\n      timeout: setTimeout(function()\n      {\n        clearTimeout(response.timeout);\n        delete responses[dest];\n      },\n      BASE_TIMEOUT)\n    };\n    responses[dest] = response;\n  };\n\n\n  //\n  // Pack & Unpack\n  //\n\n  this.pack = function(message, id)\n  {\n    var result = new Array(6);\n\n    // Type\n    var type = message.type;\n    switch(type)\n    {\n      case \"presence\":\n        result[0] = PRESENCE;\n      break;\n\n      case \"offer\":\n        result[0] = OFFER;\n      break;\n\n      case \"answer\":\n        result[0] = ANSWER;\n      break;\n\n      default:\n      {\n        var error = Error(\"Unknown message type '\"+type+\"'\");\n            error.message = message;\n\n        throw error;\n      };\n    };\n\n    // From\n    result[1] = message.from || sessionID;\n\n    // Offer & Answer\n\n    if(result.type != PRESENCE)\n    {\n      result[2] = message.dest;\n      result[3] = id || requestID++;\n      result[4] = Math.min(message.ttl || MAX_TTL_DEFAULT, MAX_TTL_DEFAULT);\n      result[5] = message.sdp;\n    };\n\n    return result;\n  };\n\n  this.unpack = function(message)\n  {\n    var result = {};\n\n    var from = message[1];\n    var id   = message[3];\n\n    // Type\n    var type = message[0];\n    switch(type)\n    {\n      case PRESENCE:\n        result.type = \"presence\";\n      break;\n\n      case OFFER:\n        result.type = \"offer\";\n      break;\n\n      case ANSWER:\n        result.type = \"answer\";\n      break;\n\n      default:\n      {\n        var error = Error(\"Unknown message type '\"+type+\"'\");\n            error.message = message;\n\n        throw error;\n      };\n    };\n\n    // From\n    result.from = from;\n\n    // Offer & Answer\n\n    if(type != PRESENCE)\n    {\n      result.dest = message[2];\n      result.ttl  = message[4];\n      result.sdp  = message[5];\n\n      result.pack = function()\n      {\n        return self.pack(this, id);\n      };\n    };\n\n    // Dispatch responses callbacks\n    if(result.type == 'offer')\n    {\n      // Check if it's a re-try\n      var response = responses[from];\n      if(response)\n      {\n        // Old message, ignore it\n        if(response.id > id)\n          return;\n\n        // Updated message (or duplicated one), delete old response\n        clearTimeout(response.timeout);\n        delete responses[from];\n\n        // Duplicated message, re-send it\n        if(response.id == id)\n        {\n          var message = response.message;\n\n          // Store the response to prevent to process duplicate request later\n          storeResponse(message, from, id);\n\n          // Return the stored response so it can be directly send back\n          return message;\n        };\n      }\n      else\n        result.reply = function(dest, sdp)\n        {\n          var message = self.pack(\n          {\n            type: \"answer\",\n            dest: dest,\n            sdp:  sdp\n          }, id);\n\n          // Store the response to prevent to process duplicate request later\n          storeResponse(message, dest, id);\n\n          // Return the packed message\n          return message;\n        };\n    };\n\n    if(result.type == 'answer')\n    {\n      var request_ids = requests[from];\n      if(request_ids)\n      {\n        var request = request_ids[id];\n        if(request)\n        {\n          request.callback(error, result);\n\n          // Return undefined to notify message has been procesed\n          return;\n        };\n      };\n    };\n\n    // Return unpacked message\n    return result;\n  };\n\n\n  //\n  // Application dependent messages\n  //\n\n  this.presence = function()\n  {\n    var message = this.pack(\n    {\n      type: \"presence\"\n    });\n\n    // Return the packed message\n    return message;\n  };\n\n  this.offer = function(dest, sdp, callback)\n  {\n    var message = this.pack(\n    {\n      type: \"offer\",\n      dest: dest,\n      sdp:  sdp\n    });\n\n    message.cancel = function(){};\n\n    // Store callback if defined to be executed when received the response\n    if(callback)\n    {\n      var request_ids = requests[dest] = requests[dest] || {};\n\n      var id = message[3];\n\n      var request = request_ids[id] =\n      {\n        message: message,\n        callback: dispatchCallback,\n        timeout:  setTimeout(function()\n        {\n          var error = new Error('Timed Out');\n              error.request = message;\n\n          dispatchCallback(error)\n        },\n        BASE_TIMEOUT)\n      };\n\n      message.cancel = function()\n      {\n        clearTimeout(request.timeout);\n\n        delete request_ids[id];\n        if(!Object.keys(request_ids).length)\n          delete requests[dest];\n      };\n\n      function dispatchCallback(error, result)\n      {\n        message.cancel();\n\n        callback(error, result);\n      };\n    };\n\n    // Return the packed message\n    return message;\n  };\n};\n\n\nmodule.exports = MessagePacker;","/**\n * Add support to get a list of channels on a PeerConnection object\n */\nfunction applyChannelsShim(pc)\n{\n  if(pc.getDataChannels != undefined) return;\n\n  var channels = [];\n\n  pc.getDataChannels = function()\n  {\n    return channels;\n  };\n\n  function initChannel(channel)\n  {\n    channels.push(channel);\n\n    channel.addEventListener('close', function(event)\n    {\n      channels.splice(channels.indexOf(channel), 1);\n    });\n  };\n\n  // Add DataChannels created by remote PeerConnection object\n  var dispatchEvent = pc.dispatchEvent;\n  pc.dispatchEvent = function(event)\n  {\n    if(event.type == 'datachannel')\n    {\n      var channel = event.channel;\n\n      initChannel(channel);\n    };\n\n    // Dispatch events\n    dispatchEvent.call(this, event);\n  };\n\n  // Add DataChannels created by local PeerConnection object\n  var createDataChannel = pc.createDataChannel;\n  pc.createDataChannel = function(label, dataChannelDict)\n  {\n    var channel = createDataChannel.call(this, label, dataChannelDict);\n\n    initChannel(channel);\n\n    return channel;\n  };\n};\n\n\nmodule.exports = applyChannelsShim;\n","var EventEmitter = require(\"events\").EventEmitter;\n\nvar RTCPeerConnection = require('wrtc').RTCPeerConnection;\n//var uuid = require('uuid');\n\nvar HandshakeManager = require('./managers/HandshakeManager');\nvar PeersManager     = require('./managers/PeersManager');\n\nvar MessagePacker = require('./MessagePacker');\n\nvar applyChannelsShim = require(\"./PeerConnection_channels.shim\");\n\n\n/**\n * @classdesc Init and connect to the WebP2P.io network\n *\n * @constructor\n */\nfunction WebP2P(options)\n{\n  var self = this;\n\n\n  /**\n   * UUID generator\n   */\n  var UUIDv4 = function b(a)\n  {\n    return a ? (a ^ Math.random() * 16 >> a / 4).toString(16) : ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, b);\n  };\n\n\n  var options = options || {};\n\n  // Internal options\n  var commonLabels      = options.commonLabels || [];\n  var handshake_servers = options.handshake_servers;\n  var stun_server       = options.stun_server || 'stun.l.google.com:19302';\n\n  // Read-only options\n  Object.defineProperty(this, \"routingLabel\",\n  {\n    value: options.routingLabel || \"webp2p\"\n  });\n  Object.defineProperty(this, \"sessionID\",\n  {\n    value: options.sessionID || UUIDv4()\n//    value: options.sessionID || uuid.v4()\n  });\n\n\n  var messagepacker = new MessagePacker(this.sessionID);\n\n  var handshakeManager = new HandshakeManager(messagepacker, handshake_servers);\n  var peersManager     = new PeersManager(messagepacker, self.routingLabel);\n\n  this.__defineGetter__(\"status\", function()\n  {\n    if(peersManager.status == 'connected')\n      return 'connected'\n\n    return handshakeManager.status\n  });\n\n  this.__defineGetter__(\"peers\", function()\n  {\n    return peersManager.peers;\n  });\n\n\n  function onerror(error)\n  {\n    self.emit('error', new Error(error));\n  };\n\n\n  var offers = {};\n\n  /**\n   * Create a new RTCPeerConnection\n   * @param {UUID} id Identifier of the other peer so later can be accessed.\n   *\n   * @return {RTCPeerConnection}\n   */\n  function createPeerConnection(sessionID, callbackType, callback)\n  {\n    var pc = new RTCPeerConnection\n    (\n      {iceServers: [{url: 'stun:'+stun_server}]},\n      {optional: [{DtlsSrtpKeyAgreement: true}]}\n    );\n\n    applyChannelsShim(pc);\n\n    pc.addEventListener('icecandidate', function(event)\n    {\n      // There's a candidate, ignore it\n      if(event.candidate)\n        return;\n\n      // There's no candidate, send the full SDP\n      var type = this.localDescription.type;\n      var sdp  = this.localDescription.sdp;\n\n      if(type == callbackType)\n        callback(sdp)\n      else\n        console.error(type+\" SDP type is not equal to \"+callbackType+\" callback type\");\n    });\n\n    pc.addEventListener('signalingstatechange', function(event)\n    {\n      // Add PeerConnection object to available ones when gets open\n      if(pc.signalingState == 'stable')\n      {\n        peersManager.add(sessionID, pc);\n        delete offers[sessionID];\n\n        self.emit('peerconnection', pc);\n      };\n    });\n\n    // Set ID of the PeerConnection\n    Object.defineProperty(pc, \"sessionID\", {value : sessionID});\n\n    return pc;\n  };\n\n\n  function initPeerConnection_Offer(pc, labels)\n  {\n    // Set channels for this PeerConnection object\n    labels = [self.routingLabel].concat(commonLabels, labels);\n\n    for(var i=0, label; label=labels[i]; i++)\n      pc.createDataChannel(label);\n\n    // Send offer\n    var mediaConstraints =\n    {\n      mandatory:\n      {\n        OfferToReceiveAudio: false,\n        OfferToReceiveVideo: false\n      }\n    };\n\n    pc.createOffer(function(offer)\n    {\n      // Set the peer local description\n      pc.setLocalDescription(offer,\n      function()\n      {\n        console.log('['+self.sessionID+'] Offer LocalDescription created and set');\n      },\n      onerror);\n    },\n    onerror,\n    mediaConstraints);\n  };\n\n  function initPeerConnection_Answer(pc, sdp)\n  {\n    // Process offer\n    pc.setRemoteDescription(new RTCSessionDescription(\n    {\n      sdp:  sdp,\n      type: 'offer'\n    }),\n    function()\n    {\n      // Send answer\n      pc.createAnswer(function(answer)\n      {\n        // Set the peer local description\n        pc.setLocalDescription(answer,\n        function()\n        {\n          console.log('['+self.sessionID+'] Answer LocalDescription created and set');\n        },\n        onerror);\n      },\n      onerror)\n    },\n    onerror);\n  };\n\n\n  //\n  // Connection methods\n  //\n\n  /**\n   * Callback to send the offer. If not defined send it to all connected peers.\n   *\n   * @callback WebP2P~ConnectToCallback\n   * @param {Error} error\n   * @param {RTCPeerConnection} peer - The (newly created) peer\n   */\n\n  /**\n   * Connects to another peer based on its UID. If we are already connected,\n   * it does nothing.\n   *\n   * @param {UUID} sessionID - Identifier of the other peer to be connected.\n   * @param {string[]} [labels] - Per-connection labels\n   * @param {WebP2P~ConnectToCallback} callback\n   */\n  this.connectTo = function(dest, labels, callback)\n  {\n    // Don't connect to uurself\n    if(dest == self.sessionID)\n    {\n      callback(new Error(\"Connecting to ourself\"));\n      return;\n    }\n\n    var pc = peersManager.get(dest);\n    if(pc)\n      callback(null, pc)\n\n    else\n    {\n      pc = createPeerConnection(dest, \"offer\", function(offer)\n      {\n        var message = messagepacker.offer(dest, offer, callback);\n\n        offers[dest] =\n        {\n          message: message,\n          peerConnection: pc\n        };\n\n        handshakeManager.send(message);\n        peersManager.send(message);\n      });\n\n      initPeerConnection_Offer(pc, labels);\n    }\n  };\n\n\n  //\n  // Managers\n  //\n\n  function forward(message, connector)\n  {\n    // Don't forward the message if TTL has been achieved\n    if(--message.ttl <= 0)\n    {\n      console.warning(\"TTL achieved: \"+message);\n      return;\n    };\n\n    var dest = message.dest;\n\n    message = message.pack();\n\n    // Search the peer between the ones currently connected\n    for(var i=0, peer; peer=peersManager._connectors[i]; i++)\n      if(peer.sessionID == dest)\n      {\n        peer.send(message);\n        return;\n      };\n\n    // Peer was not found, forward message to all the connectors\n    peersManager.send(message, connector);\n    handshakeManager.send(message, connector);\n  };\n\n\n  function initManagerEvents(manager)\n  {\n    //\n    // Basic events\n    //\n\n    manager.on('connected', function(connector)\n    {\n      if(handshakeManager.status != peersManager.status)\n        self.emit('connected');\n    });\n    manager.on('disconnected', function()\n    {\n      if(handshakeManager.status == peersManager.status)\n        self.emit('disconnected');\n    });\n    manager.on('error', function(error)\n    {\n      self.emit('error', error);\n    });\n\n    //\n    // Offer & answer events\n    //\n\n    /**\n     * Check if it's a request from a peer we are already connected or trying to\n     * connect to, so we can prevent to do crossed connections\n     *\n     * @param sessionID - ID of the other peer\n     *\n     * @returns {Boolean} - If we are already connected or trying to connect\n     */\n    function connectionProcessed(sessionID)\n    {\n      // Check if we are already connected to the requester peer\n      var peer = peersManager.get(sessionID);\n      if(peer)\n      {\n        // We are already connected to that peer, ignore the request\n        console.log(\"[\"+self.sessionID+\"] Already connected to \"+sessionID);\n        return true;\n      };\n\n      // Check if we are already trying to connect to that peer\n      var offer = offers[sessionID];\n      if(offer)\n      {\n        // We are already trying to connected to that peer, ignore the request\n        console.log(\"[\"+self.sessionID+\"] Already offered connection to \"+sessionID);\n\n        // We have higher precedence, ignore incoming connection request\n        if(self.sessionID < sessionID)\n          return true;  // Should send an error to the other end\n\n        // We have less precedence, cancel our connection request and prepare to\n        // incoming one\n        offer.message.cancel();\n        offer.peerConnection.close();\n\n        delete offers[sessionID];\n      };\n\n      // Connection request is a genuinely new one, process it as usual\n      return false;\n    };\n\n    manager.on('offer', function(message, connector)\n    {\n      var from = message.from;\n      var dest = message.dest;\n\n      // Ignore messages send by us\n      if(from == self.sessionID) return;\n\n      // Message is for us\n      if(dest == self.sessionID)\n      {\n        console.log(\"[\"+self.sessionID+\"] Received connection request from \"+from);\n\n        if(connectionProcessed(from))\n          return;\n\n        var request = message;\n\n        // Search the peer between the list of currently connected ones,\n        // or create it if it's not connected\n        var pc = createPeerConnection(from, \"answer\", function(answer)\n        {\n          var message = request.reply(from, answer);\n\n          // Send back the connection request over the same connector, since\n          // this should be the shortest path to connect both peers\n          connector.send(message);\n        });\n\n        initPeerConnection_Answer(pc, message.sdp);\n      }\n\n      // Forward message\n      else\n        forward(message, connector);\n    });\n\n    manager.on('answer', function(message, connector)\n    {\n      var from = message.from;\n      var dest = message.dest;\n\n      // Ignore messages send by us\n      if(from == self.sessionID) return;\n\n      // Message is for us\n      if(dest == self.sessionID)\n      {\n        console.log(\"[\"+self.sessionID+\"] Received connection response from \"+from);\n\n        var peer = offers[from];\n        if(peer)\n        {\n          peer.peerConnection.setRemoteDescription(new RTCSessionDescription(\n          {\n            sdp: message.sdp,\n            type: 'answer'\n          }),\n          function()\n          {\n            console.log(\"Successfuly generated RemoteDescription for \"+from);\n          },\n          onerror);\n        }\n        else\n          console.warn(\"[\"+self.sessionID+\"] Connection with peer '\" + from + \"' was not previously requested\");\n      }\n\n      // Forward message\n      else\n        forward(message, connector);\n    });\n  };\n\n  // Init managers events\n\n  initManagerEvents(handshakeManager);\n  initManagerEvents(peersManager);\n\n  handshakeManager.on('presence', function(from, connector)\n  {\n    // Ignore messages send by us\n    if(from == self.sessionID) return;\n\n    var peer = peersManager.get(from);\n    if(!peer)\n    {\n      var pc = createPeerConnection(from, \"offer\", function(offer)\n      {\n        var message = messagepacker.offer(from, offer);\n\n        offers[from] =\n        {\n          message: message,\n          peerConnection: pc\n        };\n\n        // Send back the connection request over the same connector, since this\n        // should be the shortest path to connect both peers\n        connector.send(message);\n      });\n\n      pc.addEventListener('signalingstatechange', function(event)\n      {\n        // Add PeerConnection object to available ones when gets open\n        if(pc.signalingState == 'stable')\n          connector.increaseConnections();\n      });\n\n      initPeerConnection_Offer(pc);\n    }\n  });\n\n\n  //\n  // Clossing functions\n  //\n\n  this.close = function()\n  {\n    handshakeManager.close();\n    peersManager.close();\n  };\n\n  // Close all connections when user goes out of the page\n  if(window)\n    window.addEventListener('beforeunload', function(event)\n    {\n      self.close();\n    });\n};\nWebP2P.prototype.__proto__   = EventEmitter.prototype;\nWebP2P.prototype.constructor = WebP2P;\n\n\nmodule.exports = WebP2P;\n","var HandshakeConnector = require(\"./core/HandshakeConnector\");\n\nvar PUBNUB = require(\"pubnub\");\n\n\n/**\n * Handshake connector for PubNub\n * @param {Object} configuration Configuration object.\n */\nfunction Connector_PubNub(config_init, config_mess)\n{\n  HandshakeConnector.call(this);\n\n  var self = this;\n\n  var channel = config_mess.channel;\n\n\n  // Connect a handshake connector to the PubNub server\n  var pubnub = PUBNUB.init(config_init);\n\n  // Configure handshake connector\n  pubnub.subscribe(\n  {\n    channel: channel,\n    restore: false,\n    backfill: false,\n\n    connect:    self._open,\n    message:    self._message,\n    disconnect: self._close,\n    error:      self._error\n  });\n\n\n  // Define methods\n\n  /**\n   * Close the connection with this handshake server\n   */\n  this.close = function()\n  {\n    pubnub.unsubscribe(\n    {\n      channel: channel\n    });\n\n    // This shouldn't be necesary, but seems 'disconnect' event is not being\n    // dispatched by the PubNub channel, so we close the connector explicitly\n    self._close();\n  }\n\n  /**\n   * Send the message\n   */\n  this.send = function(message)\n  {\n    pubnub.publish(\n    {\n      channel: channel,\n      message: message\n    });\n  };\n}\nConnector_PubNub.prototype.__proto__   = HandshakeConnector.prototype;\nConnector_PubNub.prototype.constructor = Connector_PubNub;\n\n//Class constants\nConnector_PubNub.prototype.max_connections = 50;\nConnector_PubNub.prototype.max_chars       = 1800;\n\n\nmodule.exports = Connector_PubNub;","var EventEmitter = require(\"events\").EventEmitter;\n\n\nfunction Connector()\n{\n  EventEmitter.call(this);\n\n  var self = this;\n\n\n  /**\n   * Notify that the connection to this handshake server is open\n   */\n  this._open = function()\n  {\n    self.emit('open');\n  };\n\n  this._message = function(message)\n  {\n    self.emit(\"message\", message);\n  };\n\n  this._close = function()\n  {\n    self.emit('close');\n  };\n\n  this._error = function(error)\n  {\n    self.emit('error', error);\n  };\n};\nConnector.prototype.__proto__   = EventEmitter.prototype;\nConnector.prototype.constructor = Connector;\n\nConnector.prototype.close = function()\n{\n  throw new TypeError(\"Connector.close should be defined in a child class\");\n};\nConnector.prototype.send = function(message)\n{\n  throw new TypeError(\"Connector.send should be defined in a child class\");\n};\n\n\nmodule.exports = Connector;","var Connector = require(\"./Connector\");\n\n\nfunction Connector_DataChannel(datachannel)\n{\n  Connector.call(this);\n\n  var self = this;\n\n\n  datachannel.addEventListener('open',  self._open);\n  datachannel.addEventListener('message', function(event)\n  {\n    self._message(JSON.parse(event.data));\n  });\n  datachannel.addEventListener('close', self._close);\n  datachannel.addEventListener('error', self._error);\n\n\n  // Define methods\n\n  /**\n   * Close the connection with the peer\n   */\n  this.close = function()\n  {\n    datachannel.close();\n  };\n\n  /**\n   * Send the message\n   */\n  this.send = function(message)\n  {\n    datachannel.send(JSON.stringify(message));\n  };\n};\nConnector_DataChannel.prototype.__proto__   = Connector.prototype;\nConnector_DataChannel.prototype.constructor = Connector_DataChannel;\n\n\nmodule.exports = Connector_DataChannel;","var Connector = require(\"./Connector\");\n\n\nfunction HandshakeConnector()\n{\n  Connector.call(this);\n\n  var self = this;\n\n\n  /**\n   * Check if we should connect this new peer or ignore it to increase entropy\n   * in the network mesh\n   *\n   * @returns {Boolean}\n   */\n  this.shouldConnect = function()\n  {\n    return true;\n  };\n\n\n  // Count the maximum number of pending connections allowed to be\n  // done with this handshake server (undefined == unlimited)\n  var connections = 0;\n\n  this.increaseConnections = function()\n  {\n    // Increase the number of connections reached throught\n    // this handshake server\n    connections++;\n\n    // Close connection with handshake server if we got its quota of peers\n    if(connections >= self.max_connections)\n       self.close();\n  };\n};\nHandshakeConnector.prototype.__proto__   = Connector.prototype;\nHandshakeConnector.prototype.constructor = HandshakeConnector;\n\n// Class constants\nHandshakeConnector.prototype.max_connections = Number.POSITIVE_INFINITY;\n\n\nmodule.exports = HandshakeConnector;","const ERROR_NETWORK_UNKNOWN = {id: 0, msg: 'Unable to fetch handshake servers configuration'};\nconst ERROR_NETWORK_OFFLINE = {id: 1, msg: \"There's no available network\"};\nconst ERROR_REQUEST_FAILURE = {id: 2, msg: 'Unable to fetch handshake servers configuration'};\nconst ERROR_REQUEST_EMPTY   = {id: 3, msg: 'Handshake servers configuration is empty'};\n\nconst ERROR_NO_PEERS        = {id: 4, msg: 'Not connected to any peer'};\n\n\nexports.ERROR_NETWORK_UNKNOWN = ERROR_NETWORK_UNKNOWN;\nexports.ERROR_NETWORK_OFFLINE = ERROR_NETWORK_OFFLINE;\nexports.ERROR_REQUEST_FAILURE = ERROR_REQUEST_FAILURE;\nexports.ERROR_REQUEST_EMPTY   = ERROR_REQUEST_EMPTY;\nexports.ERROR_NO_PEERS        = ERROR_NO_PEERS;","/**\n * New node file\n */\nvar HandshakeConnector = require('./connectors/core/HandshakeConnector');\nvar WebP2P             = require('./WebP2P');\n\n\nmodule.exports = WebP2P;\nmodule.exports.HandshakeConnector = HandshakeConnector;","var Manager = require('./Manager');\n\nvar errors = require('../errors');\n\n\nvar Connector_PubNub = require('../connectors/PubNub');\n\n\n/**\n * Manage the handshake connectors using several servers\n *\n * @constructor\n * @param {String} json_uri URI of the handshake servers configuration.\n */\nfunction HandshakeManager(messagepacker, handshake_servers)\n{\n  Manager.call(this, messagepacker);\n\n  var self = this;\n\n\n  var handshakeConnectorConstructors = {};\n\n  this.registerConnectorConstructor = function(type, constructor)\n  {\n    handshakeConnectorConstructors[type] = constructor\n  };\n\n\n  // Default handshake connectors\n  this.registerConnectorConstructor('PubNub', Connector_PubNub);\n\n\n  function createConnector(config)\n  {\n    var type        = config.type;\n    var config_init = config.config_init;\n    var config_mess = config.config_mess;\n\n    // Check if connector constructor is from a valid handshake server\n    var connectorConstructor = handshakeConnectorConstructors[type];\n    if(!connectorConstructor)\n      throw Error(\"Invalid handshake server type '\" + type + \"'\");\n\n    var connector = new connectorConstructor(config_init, config_mess);\n\n    self._initConnector(connector);\n\n    connector.on('open', function()\n    {\n      // Notify our presence to the other peers\n      connector.send(messagepacker.presence());\n    });\n\n    var _messageUnpacked = connector._messageUnpacked;\n    connector._messageUnpacked = function(message)\n    {\n      if(message.type == 'presence')\n      {\n        if(connector.shouldConnect())\n          self.emit(\"presence\", message.from, connector);\n      }\n      else\n        _messageUnpacked.call(connector, message);\n    };\n\n    return connector;\n  };\n\n\n  var configs = [];\n  var index = 0;\n\n  var configs_infinity = [];\n\n  /**\n   * Get a random handshake connector or test for the next one\n   * @param {Object} configuration Handshake servers configuration.\n   */\n  function handshake()\n  {\n    if(!configs.length)\n      throw Error('No handshake servers defined')\n\n    for(; index < configs.length; index++)\n    {\n      var connector = createConnector(configs[index]);\n          connector.on('close', function()\n      {\n        // Handshake connector has been closed, try to get an alternative one\n        index++;\n        handshake();\n      });\n\n      // Connector successfully created\n      return;\n    };\n\n    // All configured handshake servers has been consumed\n    // Get ready to start again from beginning of handshake servers list\n    index = 0;\n  };\n\n\n  this.addConfigs_byObject = function(config)\n  {\n    // Check if connector constructor is from a valid handshake server\n    var connectorConstructor = handshakeConnectorConstructors[config.type];\n    if(!connectorConstructor)\n    {\n      console.error(\"Invalid handshake server config: \", config);\n      return;\n    };\n\n    if(connectorConstructor.prototype.max_connections == Number.POSITIVE_INFINITY)\n    {\n      configs_infinity.push(config)\n\n      // Start handshaking\n      createConnector(config);\n    }\n    else\n    {\n      configs.push(config);\n\n      // Start handshaking\n      if(self.status == 'disconnected')\n      {\n        if(index == undefined)\n           index = 0;\n\n        handshake();\n      }\n    }\n  };\n\n  this.addConfigs_byArray = function(configuration)\n  {\n    for(var i=0, config; config=configuration[i]; i++)\n      self.addConfigs_byObject(config);\n  };\n\n  this.addConfigs_byUri = function(json_uri)\n  {\n    function dispatchError(error)\n    {\n      self.emit('error', error);\n    };\n\n    // Request the handshake servers configuration file\n    var http_request = new XMLHttpRequest();\n\n    http_request.open('GET', json_uri);\n    http_request.onload = function(event)\n    {\n      if(this.status == 200)\n      {\n        var configuration = JSON.parse(http_request.response);\n\n        // We got some config entries\n        if(configuration.length)\n          this.addConfigs_byArray(configuration)\n\n        // Config was empty\n        else\n          dispatchError(errors.ERROR_REQUEST_EMPTY)\n      }\n\n      // Request returned an error\n      else\n        dispatchError(errors.ERROR_REQUEST_FAILURE)\n    };\n\n    // Connection error\n    http_request.onerror = function(event)\n    {\n      dispatchError(navigator.onLine ? errors.ERROR_NETWORK_UNKNOWN\n                                     : errors.ERROR_NETWORK_OFFLINE)\n    };\n\n    http_request.send();\n  };\n\n  this.addConfigs = function(configuration)\n  {\n    if(typeof configuration == 'string')\n      this.addConfigs_byUri(configuration)\n\n    else if(configuration instanceof Array)\n      this.addConfigs_byArray(configuration)\n\n    else\n      this.addConfigs_byObject(configuration)\n  };\n\n\n  // Add handshake servers configuration\n  if(handshake_servers)\n    this.addConfigs(handshake_servers)\n};\nHandshakeManager.prototype.__proto__   = Manager.prototype;\nHandshakeManager.prototype.constructor = HandshakeManager;\n\n\nmodule.exports = HandshakeManager;","var EventEmitter = require(\"events\").EventEmitter;\n\n\nfunction Manager(messagepacker)\n{\n  EventEmitter.call(this);\n\n  var self = this;\n\n\n  this._connectors = [];\n\n  this.__defineGetter__(\"status\", function()\n  {\n    return this._connectors.length ? 'connected' : 'disconnected';\n  });\n\n\n  this._initConnector = function(connector)\n  {\n    connector.on('open', function()\n    {\n      self._connectors.push(connector);\n\n      if(self._connectors.length == 1)\n         self.emit('connected');\n    });\n    connector.on('close', function()\n    {\n      self._connectors.splice(self._connectors.indexOf(connector), 1);\n\n      if(self._connectors.length == 0)\n         self.emit('disconnected');\n    });\n    connector.on('error', function(error)\n    {\n      connector.close();\n\n      self.emit('error', error);\n    });\n\n    connector._messageUnpacked = function(message)\n    {\n      switch(message.type)\n      {\n        case 'offer':\n        case 'answer':\n          self.emit(message.type, message, connector);\n        break;\n\n        default:\n          console.error(\"Unknown message type '\"+type+\"'\");\n          console.error(message);\n      };\n    };\n\n    connector.on('message', function(message)\n    {\n      message = messagepacker.unpack(message);\n      if(message)\n      {\n        // Response was previously stored, send it directly\n        if(message.stored)\n          connector.send(message)\n\n        // Normal message, process it\n        else\n          connector._messageUnpacked(message);\n      };\n    });\n  };\n\n\n  /**\n   * {Object} message - Message to be send\n   * {Connector} [incomingConnector] - {Connector} to don't send the message\n   */\n  this.send = function(message, incomingConnector)\n  {\n    for(var i=0, peer; peer=this._connectors[i]; i++)\n    {\n      // Don't send the message to the same connector where we received it\n      if(peer === incomingConnector)\n        continue;\n\n      peer.send(message);\n    };\n  };\n\n\n  /**\n   * Close all the connections\n   */\n  this.close = function()\n  {\n    for(var i=0, peer; peer=this._connectors[i]; i++)\n      peer.close();\n  };\n};\nManager.prototype.__proto__   = EventEmitter.prototype;\nManager.prototype.constructor = Manager;\n\n\nmodule.exports = Manager;","var Manager = require('./Manager');\n\nvar Connector_DataChannel = require('../connectors/core/DataChannel');\n\n\n/**\n * @classdesc Manager of the communications with the other peers\n *\n * @constructor\n */\nfunction PeersManager(messagepacker, routingLabel)\n{\n  Manager.call(this, messagepacker);\n\n  var self = this;\n\n\n  function createConnector(channel)\n  {\n    var connector = new Connector_DataChannel(channel);\n\n    self._initConnector(connector);\n\n    return connector;\n  };\n\n\n  var peers = {};\n\n  this.__defineGetter__(\"peers\", function()\n  {\n    return peers;\n  });\n\n\n  this.add = function(sessionID, peerConnection)\n  {\n    peerConnection.addEventListener('signalingstatechange', function(event)\n    {\n      // Remove the peer from the list of peers when gets closed\n      if(peerConnection.signalingState == 'closed')\n        delete peers[sessionID];\n    });\n\n    // Routing DataChannel, just init routing functionality on it\n    var channels = peerConnection.getDataChannels();\n\n    for(var i=0, channel; channel=channels[i]; i++)\n      if(channel.label == routingLabel)\n      {\n        var connector = createConnector(channel);\n            connector.sessionID = sessionID;\n\n        break;\n      };\n\n    // Add PeerConnection to the list of enabled ones\n    peers[sessionID] = peerConnection;\n  };\n\n  this.get = function(sessionID)\n  {\n    return peers[sessionID];\n  };\n};\nPeersManager.prototype.__proto__   = Manager.prototype;\nPeersManager.prototype.constructor = PeersManager;\n\n\nmodule.exports = PeersManager;","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        throw TypeError('Uncaught, unspecified \"error\" event.');\n      }\n      return false;\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      console.trace();\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","var RTCIceCandidate       = window.mozRTCIceCandidate       || window.webkitRTCIceCandidate       || window.RTCIceCandidate;\nvar RTCPeerConnection     = window.mozRTCPeerConnection     || window.webkitRTCPeerConnection     || window.RTCPeerConnection;\nvar RTCSessionDescription = window.mozRTCSessionDescription || window.webkitRTCSessionDescription || window.RTCSessionDescription;\n\n\nexports.RTCIceCandidate       = RTCIceCandidate;\nexports.RTCPeerConnection     = RTCPeerConnection;\nexports.RTCSessionDescription = RTCSessionDescription;","// Version: 3.5.48\n(function(){\nvar j=!0,t=null,u=!1;function x(){return function(){}}\nwindow.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(a){return t}}function c(a){d.lastIndex=0;return d.test(a)?'\"'+a.replace(d,function(a){var b=H[a];return\"string\"===typeof b?b:\"\\\\u\"+(\"0000\"+a.charCodeAt(0).toString(16)).slice(-4)})+'\"':'\"'+a+'\"'}function b(d,h){var p,f,q,r,i,k=e,g=h[d];g&&\"object\"===typeof g&&(g=a.call(g));\"function\"===typeof m&&(g=m.call(h,d,g));switch(typeof g){case \"string\":return c(g);case \"number\":return isFinite(g)?String(g):\"null\";case \"boolean\":case \"null\":return String(g);\ncase \"object\":if(!g)return\"null\";e+=s;i=[];if(\"[object Array]\"===Object.prototype.toString.apply(g)){r=g.length;for(p=0;p<r;p+=1)i[p]=b(p,g)||\"null\";q=0===i.length?\"[]\":e?\"[\\n\"+e+i.join(\",\\n\"+e)+\"\\n\"+k+\"]\":\"[\"+i.join(\",\")+\"]\";e=k;return q}if(m&&\"object\"===typeof m){r=m.length;for(p=0;p<r;p+=1)f=m[p],\"string\"===typeof f&&(q=b(f,g))&&i.push(c(f)+(e?\": \":\":\")+q)}else for(f in g)Object.hasOwnProperty.call(g,f)&&(q=b(f,g))&&i.push(c(f)+(e?\": \":\":\")+q);q=0===i.length?\"{}\":e?\"{\\n\"+e+i.join(\",\\n\"+e)+\"\\n\"+\nk+\"}\":\"{\"+i.join(\",\")+\"}\";e=k;return q}}window.JSON||(window.JSON={});var d=/[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,e,s,H={\"\\b\":\"\\\\b\",\"\\t\":\"\\\\t\",\"\\n\":\"\\\\n\",\"\\f\":\"\\\\f\",\"\\r\":\"\\\\r\",'\"':'\\\\\"',\"\\\\\":\"\\\\\\\\\"},m;\"function\"!==typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var f;s=e=\"\";if(\"number\"===typeof d)for(f=0;f<d;f+=1)s+=\" \";else\"string\"===typeof d&&(s=d);if((m=c)&&\"function\"!==typeof c&&(\"object\"!==typeof c||\"number\"!==\ntypeof c.length))throw Error(\"JSON.stringify\");return b(\"\",{\"\":a})});\"function\"!==typeof JSON.parse&&(JSON.parse=function(a){return eval(\"(\"+a+\")\")})}();var aa=1,C=u,ba=[],G=\"-pnpres\",I=1E3,ca=\"/\",da=\"&\",fa=/{([\\w\\-]+)}/g;function ga(){return\"x\"+ ++aa+\"\"+ +new Date}function J(){return+new Date}var P,ha=Math.floor(20*Math.random());P=function(a,c){return 0<a.indexOf(\"pubsub.\")&&a.replace(\"pubsub\",\"ps\"+(c?ja().split(\"-\")[0]:20>++ha?ha:ha=1))||a};\nfunction ka(a,c){var b=a.join(ca),d=[];if(!c)return b;Q(c,function(a,b){\"undefined\"!=typeof b&&(b!=t&&0<encodeURIComponent(b).length)&&d.push(a+\"=\"+encodeURIComponent(b))});return b+=\"?\"+d.join(da)}function la(a,c){function b(){e+c>J()?(clearTimeout(d),d=setTimeout(b,c)):(e=J(),a())}var d,e=0;return b}function na(a,c){var b=[];Q(a||[],function(a){c(a)&&b.push(a)});return b}function oa(a,c){return a.replace(fa,function(a,d){return c[d]||a})}\nfunction ja(a){var c=\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return(\"x\"==a?c:c&3|8).toString(16)});a&&a(c);return c}function Q(a,c){if(a&&c)if(\"undefined\"!=typeof a[0])for(var b=0,d=a.length;b<d;)c.call(a[b],a[b],b++);else for(b in a)a.hasOwnProperty&&a.hasOwnProperty(b)&&c.call(a[b],b,a[b])}function pa(a,c){var b=[];Q(a||[],function(a,e){b.push(c(a,e))});return b}function qa(a){var c=[];Q(a,function(a,d){d.j&&c.push(a)});return c.sort()}\nfunction ra(){setTimeout(function(){C||(C=1,Q(ba,function(a){a()}))},I)}\nif(!window.PUBNUB){var sa=function(a,c){return CryptoJS.HmacSHA256(a,c).toString(CryptoJS.enc.Base64)},ta=function(a){return document.getElementById(a)},ua=function(a){console.error(a)},va=function(a,c){var b=[];Q(a.split(/\\s+/),function(a){Q((c||document).getElementsByTagName(a),function(a){b.push(a)})});return b},U=function(a,c,b){Q(a.split(\",\"),function(a){function e(a){a||(a=window.event);b(a)||(a.cancelBubble=j,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}c.addEventListener?\nc.addEventListener(a,e,u):c.attachEvent?c.attachEvent(\"on\"+a,e):c[\"on\"+a]=e})},xa=function(){return va(\"head\")[0]},V=function(a,c,b){if(b)a.setAttribute(c,b);else return a&&a.getAttribute&&a.getAttribute(c)},ya=function(a,c){for(var b in c)if(c.hasOwnProperty(b))try{a.style[b]=c[b]+(0<\"|width|height|top|left|\".indexOf(b)&&\"number\"==typeof c[b]?\"px\":\"\")}catch(d){}},Ba=function(a){return document.createElement(a)},Da=function(){return Ca||W()?0:ga()},Fa=function(a){function c(a,b){M||(M=1,g.onerror=\nt,clearTimeout(ea),a||!b||N(b),setTimeout(function(){a&&O();var b=ta(D),c=b&&b.parentNode;c&&c.removeChild(b)},I))}if(Ca||W()){a:{var b,d,e=function(){if(!H){H=1;clearTimeout(L);try{d=JSON.parse(b.responseText)}catch(a){return r(1)}s=1;f(d)}},s=0,H=0,m=a.timeout||1E4,L=setTimeout(function(){r(1)},m),h=a.b||x(),p=a.data||{},f=a.c||x(),q=\"undefined\"===typeof a.g,r=function(a,c){s||(s=1,clearTimeout(L),b&&(b.onerror=b.onload=t,b.abort&&b.abort(),b=t),a&&h(c))};try{b=W()||window.XDomainRequest&&new XDomainRequest||\nnew XMLHttpRequest;b.onerror=b.onabort=function(){r(1,b.responseText||{error:\"Network Connection Error\"})};b.onload=b.onloadend=e;b.onreadystatechange=function(){if(b&&4==b.readyState)switch(b.status){case 401:case 402:case 403:try{d=JSON.parse(b.responseText),r(1,d)}catch(a){return r(1,b.responseText)}}};q&&(b.timeout=m);p.pnsdk=Ea;var i=ka(a.url,p);b.open(\"GET\",i,q);b.send()}catch(k){r(0);Ca=0;a=Fa(a);break a}a=r}return a}var g=Ba(\"script\"),e=a.a,D=ga(),M=0,ea=setTimeout(function(){c(1)},a.timeout||\n1E4),O=a.b||x(),m=a.data||{},N=a.c||x();window[e]=function(a){c(0,a)};a.g||(g[Ga]=Ga);g.onerror=function(){c(1)};m.pnsdk=Ea;g.src=ka(a.url,m);V(g,\"id\",D);xa().appendChild(g);return c},Ha=function(){return!(\"onLine\"in navigator)?1:navigator.onLine},W=function(){if(!Ia||!Ia.get)return 0;var a={id:W.id++,send:x(),abort:function(){a.id={}},open:function(c,b){W[a.id]=a;Ia.get(a.id,b)}};return a},Ga=\"async\",Ea=\"PubNub-JS-Web/3.5.48\",Ca=-1==navigator.userAgent.indexOf(\"MSIE 6\");window.console||(window.console=\nwindow.console||{});console.log||(console.log=console.error=(window.opera||{}).postError||x());var Ja,Ka=window.localStorage;Ja={get:function(a){try{return Ka?Ka.getItem(a):-1==document.cookie.indexOf(a)?t:((document.cookie||\"\").match(RegExp(a+\"=([^;]+)\"))||[])[1]||t}catch(c){}},set:function(a,c){try{if(Ka)return Ka.setItem(a,c)&&0;document.cookie=a+\"=\"+c+\"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/\"}catch(b){}}};var Y={list:{},unbind:function(a){Y.list[a]=[]},bind:function(a,c){(Y.list[a]=Y.list[a]||\n[]).push(c)},fire:function(a,c){Q(Y.list[a]||[],function(a){a(c)})}},Z=ta(\"pubnub\")||0,La=function(a){function c(){}function b(a,b){function c(b){b&&(ia=J()-(b/1E4+(J()-d)/2),a&&a(ia))}var d=J();b&&c(b)||z.time(c)}function d(a,b){R&&R(a,b);R=t}function e(){z.time(function(a){b(x(),a);a||d(1,{error:\"Heartbeat failed to connect to Pubnub Servers.Please check your network settings.\"});setTimeout(e,q)})}function s(){Na()||d(1,{error:\"Offline. Please check your network settings. \"});setTimeout(s,I)}function H(a){var b=\n0;Q(qa(E),function(c){if(c=E[c])b++,(a||x())(c)});return b}function m(a){if(Oa){if(!y.length)return}else{a&&(y.h=0);if(y.h||!y.length)return;y.h=1}A(y.shift())}a.jsonp&&(Ca=0);var L=a.subscribe_key||\"\";a.uuid||Ja.get(L+\"uuid\");a.xdr=Fa;a.db=Ja;a.error=ua;a._is_online=Ha;a.jsonp_cb=Da;a.PNSDK=Ea;a.hmac_SHA256=sa;var h,p=+a.windowing||10,f=(+a.timeout||310)*I,q=(+a.keepalive||60)*I,r=a.noleave||0,i=a.publish_key||\"demo\",k=a.subscribe_key||\"demo\",g=a.auth_key||\"\",D=a.secret_key||\"\",M=a.PNSDK||\"\",ea=\na.hmac_SHA256,O=a.ssl?\"s\":\"\",N=\"http\"+O+\"://\"+(a.origin||\"pubsub.pubnub.com\"),K=P(N),wa=P(N),y=[],ia=0,za=0,Aa=0,R=0,ma=0,S=0,E={},Oa=a.no_wait_for_pending,A=a.xdr,l=a.error||x(),Na=a._is_online||function(){return 1},F=a.jsonp_cb||function(){return 0},T=a.db||{get:x(),set:x()},B=a.uuid||T&&T.get(k+\"uuid\")||\"\",z={LEAVE:function(a,b,c,d){var X={uuid:B,auth:g},e=P(N),c=c||x(),v=d||x(),d=F();if(0<a.indexOf(G))return j;if(r||!O||\"0\"==d)return u;\"0\"!=d&&(X.callback=d);A({g:b||O,timeout:2E3,a:d,data:X,c:function(a){\"object\"==\ntypeof a&&a.error?v(a):c(a)},b:v,url:[e,\"v2\",\"presence\",\"sub_key\",k,\"channel\",encodeURIComponent(a),\"leave\"]});return j},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||\"false\",X=a.error||x(),e=a.auth_key||g,v=a.channel,w=a.start,h=a.end,n={},i=F();if(!v)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");n.stringtoken=\"true\";n.count=c;n.reverse=d;n.auth=e;i&&(n.callback=i);w&&(n.start=w);h&&(n.end=h);A({a:i,data:n,\nc:function(a){\"object\"==typeof a&&a.error?X(a):b(a)},b:X,url:[K,\"v2\",\"history\",\"sub-key\",k,\"channel\",encodeURIComponent(v)]})},replay:function(a){var b=b||a.callback||x(),c=a.auth_key||g,d=a.source,e=a.destination,h=a.stop,v=a.start,w=a.end,Pa=a.reverse,a=a.limit,n=F(),f={};if(!d)return l(\"Missing Source Channel\");if(!e)return l(\"Missing Destination Channel\");if(!i)return l(\"Missing Publish Key\");if(!k)return l(\"Missing Subscribe Key\");\"0\"!=n&&(f.callback=n);h&&(f.stop=\"all\");Pa&&(f.reverse=\"true\");\nv&&(f.start=v);w&&(f.end=w);a&&(f.count=a);f.auth=c;A({a:n,c:function(a){\"object\"==typeof a&&a.error?err(a):b(a)},b:function(){b([0,\"Disconnected\"])},url:[K,\"v1\",\"replay\",i,k,d,e],data:f})},auth:function(a){g=a;c()},time:function(a){var b=F();A({a:b,data:{uuid:B,auth:g},timeout:5*I,url:[K,\"time\",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var b=b||a.callback||x(),c=a.message,d=a.channel,e=a.auth_key||g,h=a.error||x(),v=F(),w=\"push\";a.prepend&&(w=\"unshift\");if(!c)return l(\"Missing Message\");\nif(!d)return l(\"Missing Channel\");if(!i)return l(\"Missing Publish Key\");if(!k)return l(\"Missing Subscribe Key\");c=JSON.stringify(c);y[w]({a:v,timeout:5*I,url:[K,\"publish\",i,k,0,encodeURIComponent(d),v,encodeURIComponent(c)],data:{uuid:B,auth:e},b:function(a){h(a);m(1)},c:function(a){\"object\"==typeof a&&a.error?h(a):b(a);m(1)}});m()},unsubscribe:function(a,b){var d=a.channel,b=b||a.callback||x(),e=a.error||x();S=0;ma=1;d=pa((d.join?d.join(\",\"):\"\"+d).split(\",\"),function(a){if(E[a])return a+\",\"+a+G}).join(\",\");\nQ(d.split(\",\"),function(a){var c=j;a&&(C&&(c=z.LEAVE(a,0,b,e)),c||b({action:\"leave\"}),E[a]=0)});c()},subscribe:function(a,b){function e(a){a?setTimeout(c,I):(K=P(N,1),wa=P(N,1),setTimeout(function(){z.time(e)},I));H(function(b){if(a&&b.d)return b.d=0,b.m(b.name);!a&&!b.d&&(b.d=1,b.l(b.name))})}function h(){var a=F(),b=qa(E).join(\",\");b&&(d(),R=A({timeout:O,a:a,b:function(a){n(a);R=t;z.time(e)},data:{uuid:B,auth:m},url:[wa,\"subscribe\",k,encodeURIComponent(b),a,S],c:function(a){R=t;if(!a||\"object\"==\ntypeof a&&\"error\"in a&&a.error)return n(a),setTimeout(c,I);r(a[1]);S=!S&&ma&&T.get(k)||a[1];H(function(a){a.f||(a.f=1,a.k(a.name))});y&&(S=1E4,y=0);T.set(k,a[1]);var b,d=(2<a.length?a[2]:pa(E,function(b){return pa(Array(a[0].length).join(\",\").split(\",\"),function(){return b})}).join(\",\")).split(\",\");b=function(){var a=d.shift()||Aa;return[(E[a]||{}).a||za,a.split(G)[0]]};var e=J()-ia-+a[1]/1E4;Q(a[0],function(c){var d=b();d[0](c,a,d[1],e)});setTimeout(h,L)}}))}var i=a.channel,b=(b=b||a.callback)||\na.message,m=a.auth_key||g,v=a.connect||x(),w=a.reconnect||x(),q=a.disconnect||x(),n=a.error||x(),r=a.idle||x(),s=a.presence||0,D=a.noheresync||0,y=a.backfill||0,M=a.timetoken||0,O=a.timeout||f,L=a.windowing||p;ma=a.restore;S=M;if(!i)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");Q((i.join?i.join(\",\"):\"\"+i).split(\",\"),function(a){var c=E[a]||{};E[Aa=a]={name:a,f:c.f,d:c.d,j:1,a:za=b,k:v,l:q,m:w};s&&(z.subscribe({channel:a+G,callback:s}),!c.j&&\n!D&&z.here_now({channel:a,callback:function(b){Q(\"uuids\"in b?b.uuids:[],function(c){s({action:\"join\",uuid:c,timestamp:J(),occupancy:b.occupancy||1},b,a)})}}))});c=function(){d();setTimeout(h,L)};if(!C)return ba.push(c);c()},here_now:function(a,b){var b=a.callback||b,c=a.error||x(),d=a.auth_key||g,e=a.channel,h=F(),d={uuid:B,auth:d};if(!e)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");\"0\"!=h&&(d.callback=h);A({a:h,data:d,c:function(a){\"object\"==\ntypeof a&&a.error?c(a):b(a)},b:c,url:[K,\"v2\",\"presence\",\"sub_key\",k,\"channel\",encodeURIComponent(e)]})},grant:function(a,b){var b=a.callback||b,c=a.error||x(),d=a.channel,e=F(),h=a.ttl||-1,g=a.read?\"1\":\"0\",w=a.write?\"1\":\"0\",f=a.auth_key;if(!d)return l(\"Missing Channel\");if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");if(!i)return l(\"Missing Publish Key\");if(!D)return l(\"Missing Secret Key\");\"0\"!=e&&(n.callback=e);var n=Math.floor((new Date).getTime()/1E3),m=ea(k+\"\\n\"+i+\n\"\\ngrant\\n\"+(f&&0<encodeURIComponent(f).length?\"auth=\"+encodeURIComponent(f)+\"&\":\"\")+\"channel=\"+encodeURIComponent(d)+\"&pnsdk=\"+encodeURIComponent(M)+\"&r=\"+g+\"&timestamp=\"+encodeURIComponent(n)+(-1<h?\"&ttl=\"+h:\"\")+\"&w=\"+w,D),m=m.replace(/\\+/g,\"-\"),m=m.replace(/\\//g,\"_\"),n={w:w,r:g,signature:m,channel:encodeURIComponent(d),timestamp:n};-1<h&&(n.ttl=h);f&&(n.auth=encodeURIComponent(f));A({a:e,data:n,c:function(a){b(a)},b:c,url:[K,\"v1\",\"auth\",\"grant\",\"sub-key\",k]})},audit:function(a,b){var b=a.callback||\nb,c=a.error||x(),d=a.channel,e=a.auth_key,h=F();if(!b)return l(\"Missing Callback\");if(!k)return l(\"Missing Subscribe Key\");if(!i)return l(\"Missing Publish Key\");if(!D)return l(\"Missing Secret Key\");\"0\"!=h&&(g.callback=h);var g=Math.floor((new Date).getTime()/1E3),f=k+\"\\n\"+i+\"\\naudit\\n\";e&&(f+=\"auth=\"+encodeURIComponent(e)+\"&\");d&&(f+=\"channel=\"+encodeURIComponent(d)+\"&\");var f=f+(\"pnsdk=\"+encodeURIComponent(M)+\"&timestamp=\"+g),f=ea(f,D),f=f.replace(/\\+/g,\"-\"),f=f.replace(/\\//g,\"_\"),g={signature:f,\ntimestamp:g};d&&(g.channel=encodeURIComponent(d));e&&(g.auth=encodeURIComponent(e));A({a:h,data:g,c:function(a){b(a)},b:c,url:[K,\"v1\",\"auth\",\"audit\",\"sub-key\",k]})},revoke:function(a,b){a.read=u;a.write=u;z.grant(a,b)},set_uuid:function(a){B=a;c()},get_uuid:function(){return B},xdr:A,ready:ra,db:T,uuid:ja,map:pa,each:Q,\"each-channel\":H,grep:na,offline:function(){d(1)},supplant:oa,now:J,unique:ga,updater:la};B||(B=z.uuid());T.set(k+\"uuid\",B);setTimeout(s,I);setTimeout(e,q);b();h=z;h.css=ya;h.$=ta;\nh.create=Ba;h.bind=U;h.head=xa;h.search=va;h.attr=V;h.events=Y;h.init=La;U(\"beforeunload\",window,function(){h[\"each-channel\"](function(a){h.LEAVE(a.name,0)});return j});if(a.notest)return h;U(\"offline\",window,h.offline);U(\"offline\",document,h.offline);return h};\"complete\"===document.readyState?setTimeout(ra,0):U(\"load\",window,function(){setTimeout(ra,0)});var $=Z||{};PUBNUB=La({notest:1,publish_key:V($,\"pub-key\"),subscribe_key:V($,\"sub-key\"),ssl:!document.location.href.indexOf(\"https\")||\"on\"==V($,\n\"ssl\"),origin:V($,\"origin\"),uuid:V($,\"uuid\")});window.jQuery&&(window.jQuery.PUBNUB=PUBNUB);\"undefined\"!==typeof module&&(module.exports=PUBNUB)&&ra();var Ia=ta(\"pubnubs\")||0;if(Z){ya(Z,{position:\"absolute\",top:-I});if(\"opera\"in window||V(Z,\"flash\"))Z.innerHTML=\"<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>\";PUBNUB.rdx=function(a,c){if(!c)return W[a].onerror();\nW[a].responseText=unescape(c);W[a].onload()};W.id=I}}\nvar Ma=PUBNUB.ws=function(a,c){if(!(this instanceof Ma))return new Ma(a,c);var b=this,a=b.url=a||\"\";b.protocol=c||\"Sec-WebSocket-Protocol\";var d=a.split(\"/\"),d={ssl:\"wss:\"===d[0],origin:d[2],publish_key:d[3],subscribe_key:d[4],channel:d[5]};b.CONNECTING=0;b.OPEN=1;b.CLOSING=2;b.CLOSED=3;b.CLOSE_NORMAL=1E3;b.CLOSE_GOING_AWAY=1001;b.CLOSE_PROTOCOL_ERROR=1002;b.CLOSE_UNSUPPORTED=1003;b.CLOSE_TOO_LARGE=1004;b.CLOSE_NO_STATUS=1005;b.CLOSE_ABNORMAL=1006;b.onclose=b.onerror=b.onmessage=b.onopen=b.onsend=\nx();b.binaryType=\"\";b.extensions=\"\";b.bufferedAmount=0;b.trasnmitting=u;b.buffer=[];b.readyState=b.CONNECTING;if(!a)return b.readyState=b.CLOSED,b.onclose({code:b.CLOSE_ABNORMAL,reason:\"Missing URL\",wasClean:j}),b;b.e=PUBNUB.init(d);b.e.i=d;b.i=d;b.e.subscribe({restore:u,channel:d.channel,disconnect:b.onerror,reconnect:b.onopen,error:function(){b.onclose({code:b.CLOSE_ABNORMAL,reason:\"Missing URL\",wasClean:u})},callback:function(a){b.onmessage({data:a})},connect:function(){b.readyState=b.OPEN;b.onopen()}})};\nMa.prototype.send=function(a){var c=this;c.e.publish({channel:c.e.i.channel,message:a,callback:function(a){c.onsend({data:a})}})};\n})();\n"]}