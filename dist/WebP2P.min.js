!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.WebP2P=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
function MessagePacker(e){var r={max_retries:3,peerID:e},n=new RpcBuilder(packer,r);this.unpack=function(e){return n.decode(e)},this.cancel=function(e){n.cancel(e)},this.presence=function(){return n.encode("presence")},this.offer=function(e,r,c,t){if(c instanceof Function){if(t)throw new SyntaxError("Nothing can be defined after the callback");t=c,c=void 0}var i={dest:e,sdp:r,ttl:Math.min(c||MAX_TTL_DEFAULT,MAX_TTL_DEFAULT)};return n.encode("offer",i,e,t)}}var RpcBuilder=_dereq_("rpc-builder"),packer=_dereq_("./packer");const MAX_TTL_DEFAULT=5;module.exports=MessagePacker;
},{"./packer":12,"rpc-builder":23}],2:[function(_dereq_,module,exports){
(function (process){
function noop(e){e&&console.error(e)}function WebP2P(e){function n(e){d.emit("error",new Error(e))}function t(e,n,t){var r=new RTCPeerConnection({iceServers:v},{optional:[{DtlsSrtpKeyAgreement:!0}]});return r.addEventListener("icecandidate",function(e){if(!e.candidate){var r=this.localDescription.type,o=this.localDescription.sdp;r==n?t(o):console.error(r+" SDP type is not equal to "+n+" callback type")}}),r.addEventListener("signalingstatechange",function(){if("stable"==r.signalingState){var n=r._channels||[];h.add(e,r,n);var t=D[e];t&&(delete D[e],t.callback(null,r,n)),d.emit("peerconnection",r,n)}}),Object.defineProperty(r,"sessionID",{value:e}),r}function r(e,n){var t=(e.from,e.dest);if(t==d.sessionID)return console.error("Ignored message send to us",e);if(--e.ttl<=0)return console.warn("TTL achieved:",e);var t=e.dest;e=e.pack();for(var r,o=0;r=h._connectors[o];o++)if(r.sessionID==t)return r.send(e);h.send(e,n),p.send(e,n)}function o(e){var n=h.get(e);if(n){var t="["+d.sessionID+"] Already connected to "+e;console.log(t);var r={code:-1,message:t,ttl:MAX_TTL_DEFAULT};return r}var o=D[e];if(o){var t="["+d.sessionID+"] Already requested connection to "+e;if(console.log(t),d.sessionID<e){console.log("["+d.sessionID+"] Higher precedence than "+e+", sending error");var r={code:-2,message:t,ttl:MAX_TTL_DEFAULT};return r}return delete D[e],g.cancel(o.message),o.peerConnection.close(),console.debug("["+d.sessionID+"] Lower precedence than "+e+", request canceled"),o.callback}}function s(e,n){var t=h.get(e);if(!t){var r=D[e];if(!r){var o=a(e,n);o.addEventListener("signalingstatechange",function(){"stable"==o.signalingState&&n.increaseConnections()})}}}function i(e,s){var i=e.from,a=e.dest;if(a==d.sessionID){console.log("["+a+"] Received connection request from "+i);var c=o(i);if(c&&c.code)return e.reply(c);var l=t(i,"answer",function(n){var t={sdp:n,ttl:MAX_TTL_DEFAULT};e.reply(null,t)});l.setRemoteDescription(new RTCSessionDescription({sdp:e.sdp,type:"offer"}),function(){l.createAnswer(function(e){l.setLocalDescription(e,null,n)},n)},n),c&&l.addEventListener("signalingstatechange",function(){if("stable"==l.signalingState){var e=l._channels||[];c(null,l,e)}}),l.addEventListener("datachannel",function(e){var n=e.channel;console.info("datachannel",i,n);var t=l._channels||[];t.push(n),l._channels=t})}else r(e,s)}function a(e,r,o,s){var i=t(e,"offer",function(n){var t=s?5:1;s=s||noop;var o=g.offer(e,n,t,function(e,n){return e?s(e):void c(n)});D[e]={callback:s,message:o,peerConnection:i},r instanceof Array?r.forEach(function(e){e.send(o)}):r.send(o)});o=[d.routingLabel].concat(u,o);for(var a,l=i._channels=[],f=0;a=o[f];f++){var v=i.createDataChannel(a);l.push(v),v.addEventListener("close",function(){l.splice(l.indexOf(v),1)})}var p={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};return i.createOffer(function(e){i.setLocalDescription(e,null,n)},n,p),i}function c(e){var t=e.from;console.debug("["+d.sessionID+"] Received answer from "+t);var r=D[t];r?r.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:e.sdp,type:"answer"}),null,n):console.warn("["+d.sessionID+"] Connection with peer '"+t+"' was not previously requested")}function l(e){e.on("connected",function(){p.status!=h.status&&d.emit("connected")}),e.on("disconnected",function(){p.status==h.status&&d.emit("disconnected")}),e.on("offer",i),e.on("answer",r),e.on("error",r)}var d=this;e=e||{};var u=e.commonLabels||[],f=e.handshake_servers,v=freeice(e.iceServers);Object.defineProperty(this,"routingLabel",{value:e.routingLabel||"webp2p"}),Object.defineProperty(this,"sessionID",{value:e.sessionID||uuid.v4()});var g=new MessagePacker(this.sessionID),p=new HandshakeManager(g,f),h=new PeersManager(g,d.routingLabel);this.__defineGetter__("status",function(){return"connected"==h.status?"connected":p.status}),this.__defineGetter__("peers",function(){return h.peers});var D={};this.connectTo=function(e,n,t){if(n instanceof Function){if(t)throw new SyntaxError("Nothing can be defined after the callback");t=n,n=void 0}if(e==d.sessionID)return t(new Error("Connecting to ourself"));var r=h.get(e);if(r){var o="["+d.sessionID+"] Already connected to "+e;console.log(o);var s=r._channels||[];return void t(null,r,s)}var i=D[e];if(i){var o="["+d.sessionID+"] Already requested connection to "+e;console.log(o);var r=i.peerConnection;return void r.addEventListener("signalingstatechange",function(){if("stable"==r.signalingState){var e=r._channels||[];t(null,r,e)}})}a(e,[p,h],n,t)},p.on("connected",function(){d.emit("handshakeManager.connected",p)}),p.on("disconnected",function(){d.emit("handshakeManager.disconnected",p)}),h.on("connected",function(){d.emit("peersManager.connected",h)}),h.on("disconnected",function(){d.emit("peersManager.disconnected",h)}),l(p),l(h),p.on("presence",s),this.close=function(){p.close(),h.close(),g.cancel()},process.on("exit",function(){d.close()})}var EventEmitter=_dereq_("events").EventEmitter,inherits=_dereq_("inherits"),freeice=_dereq_("freeice"),uuid=_dereq_("uuid"),wrtc=_dereq_("wrtc"),RTCPeerConnection=wrtc.RTCPeerConnection,RTCSessionDescription=wrtc.RTCSessionDescription;_dereq_("process-events-shim");var HandshakeManager=_dereq_("./managers/HandshakeManager"),PeersManager=_dereq_("./managers/PeersManager"),MessagePacker=_dereq_("./MessagePacker");const MAX_TTL_DEFAULT=5;inherits(WebP2P,EventEmitter),module.exports=WebP2P;
}).call(this,_dereq_("FWaASH"))
},{"./MessagePacker":1,"./managers/HandshakeManager":9,"./managers/PeersManager":11,"FWaASH":17,"events":16,"freeice":18,"inherits":20,"process-events-shim":21,"uuid":29,"wrtc":30}],3:[function(_dereq_,module,exports){
function Connector_PubNub(e,n,r){HandshakeConnector.call(this,r);var o=this,c=n.channel,t=PUBNUB.init(e);t.subscribe({channel:c,restore:!1,backfill:!1,connect:o._open,message:o._message,disconnect:o._close,error:function(e){o._error(new Error(e?e.error:"Undefined error"))}}),this.close=function(){t.unsubscribe({channel:c}),o._close()},this.send=function(e){t.publish({channel:c,message:e})}}var inherits=_dereq_("inherits"),HandshakeConnector=_dereq_("./core/HandshakeConnector"),PUBNUB=_dereq_("pubnub");inherits(Connector_PubNub,HandshakeConnector),Connector_PubNub.prototype.max_connections=50,Object.defineProperty(Connector_PubNub.prototype,"max_chars",{value:1800}),module.exports=Connector_PubNub;
},{"./core/HandshakeConnector":6,"inherits":20,"pubnub":31}],4:[function(_dereq_,module,exports){
function Connector(){EventEmitter.call(this);var e=this;this._open=function(){e.emit("open")},this._message=function(t){e.emit("message",t)},this._close=function(){e.emit("close")},this._error=function(t){e.emit("error",t)}}var inherits=_dereq_("inherits"),EventEmitter=_dereq_("events").EventEmitter;inherits(Connector,EventEmitter),Connector.prototype.close=function(){throw new TypeError("Connector.close should be defined in a child class")},Connector.prototype.send=function(){throw new TypeError("Connector.send should be defined in a child class")},module.exports=Connector;
},{"events":16,"inherits":20}],5:[function(_dereq_,module,exports){
function Connector_DataChannel(e){Connector.call(this);var n=this;e.addEventListener("open",n._open),e.addEventListener("message",function(e){n._message(e.data)}),e.addEventListener("close",n._close),e.addEventListener("error",n._error),this.close=function(){e.close()},this.send=function(n){e.send(n)}}var inherits=_dereq_("inherits"),Connector=_dereq_("./Connector");inherits(Connector_DataChannel,Connector),module.exports=Connector_DataChannel;
},{"./Connector":4,"inherits":20}],6:[function(_dereq_,module,exports){
function HandshakeConnector(n){Connector.call(this);var o=this;void 0!=n&&(this.max_connections=Math.min(n,this.max_connections)),this.shouldConnect=function(){return!0};var e=0;this.increaseConnections=function(){e++,e>=o.max_connections&&o.close()}}var inherits=_dereq_("inherits"),Connector=_dereq_("./Connector");inherits(HandshakeConnector,Connector),HandshakeConnector.prototype.max_connections=Number.POSITIVE_INFINITY,module.exports=HandshakeConnector;
},{"./Connector":4,"inherits":20}],7:[function(_dereq_,module,exports){
const ERROR_NETWORK_UNKNOWN={id:0,msg:"Unable to fetch handshake servers configuration"},ERROR_NETWORK_OFFLINE={id:1,msg:"There's no available network"},ERROR_REQUEST_FAILURE={id:2,msg:"Unable to fetch handshake servers configuration"},ERROR_REQUEST_EMPTY={id:3,msg:"Handshake servers configuration is empty"},ERROR_NO_PEERS={id:4,msg:"Not connected to any peer"};exports.ERROR_NETWORK_UNKNOWN=ERROR_NETWORK_UNKNOWN,exports.ERROR_NETWORK_OFFLINE=ERROR_NETWORK_OFFLINE,exports.ERROR_REQUEST_FAILURE=ERROR_REQUEST_FAILURE,exports.ERROR_REQUEST_EMPTY=ERROR_REQUEST_EMPTY,exports.ERROR_NO_PEERS=ERROR_NO_PEERS;
},{}],8:[function(_dereq_,module,exports){
var HandshakeConnector=_dereq_("./connectors/core/HandshakeConnector"),WebP2P=_dereq_("./WebP2P");module.exports=WebP2P,module.exports.HandshakeConnector=HandshakeConnector;
},{"./WebP2P":2,"./connectors/core/HandshakeConnector":6}],9:[function(_dereq_,module,exports){
function HandshakeManager(n,r){function e(r){var e=r.type,o=r.config_init,s=r.config_mess,i=r.max_connections,c=a[e];if(!c)throw Error("Invalid handshake server type '"+e+"'");var d=new c(o,s,i);t._initConnector(d),d.on("open",function(){d.send(n.presence())});var u=d._messageUnpacked;return d._messageUnpacked=function(n){"presence"==n.method?d.shouldConnect()&&t.emit("presence",n.params.from,d):u.call(d,n)},d}function o(){if(!s.length)throw Error("No handshake servers defined");for(;i<s.length;i++){var n=e(s[i]);return void n.on("close",function(){i++,o()})}i=0}Manager.call(this,n);var t=this,a={};this.registerConnectorConstructor=function(n,r){a[n]=r},this.registerConnectorConstructor("PubNub",Connector_PubNub);var s=[],i=0,c=[];this.addConfigs_byObject=function(n){var r=a[n.type];return r?void(r.prototype.max_connections!=Number.POSITIVE_INFINITY||n.max_connections?(s.push(n),"disconnected"==t.status&&o()):(c.push(n),e(n))):console.error("Invalid handshake server config: ",n)},r&&this.addConfigs(r)}var inherits=_dereq_("inherits"),Manager=_dereq_("./Manager"),errors=_dereq_("../errors"),Connector_PubNub=_dereq_("../connectors/PubNub");inherits(HandshakeManager,Manager),HandshakeManager.prototype.addConfigs=function(n){return"string"==typeof n?this.addConfigs_byUri(n):n instanceof Array?this.addConfigs_byArray(n):void this.addConfigs_byObject(n)},HandshakeManager.prototype.addConfigs_byArray=function(n){for(var r,e=0;r=n[e];e++)this.addConfigs_byObject(r)},HandshakeManager.prototype.addConfigs_byUri=function(n){function r(n){e.emit("error",n)}var e=this,o=new XMLHttpRequest;o.open("GET",n),o.onload=function(){if(200==this.status){var n=JSON.parse(o.response);n.length?e.addConfigs_byArray(n):r(errors.ERROR_REQUEST_EMPTY)}else r(errors.ERROR_REQUEST_FAILURE)},o.onerror=function(){r(navigator.onLine?errors.ERROR_NETWORK_UNKNOWN:errors.ERROR_NETWORK_OFFLINE)},o.send()},module.exports=HandshakeManager;
},{"../connectors/PubNub":3,"../errors":7,"./Manager":10,"inherits":20}],10:[function(_dereq_,module,exports){
function Manager(e){EventEmitter.call(this);var n=this;this._connectors=[],this.__defineGetter__("status",function(){return this._connectors.length?"connected":"disconnected"}),this._initConnector=function(t){t.on("open",function(){n._connectors.push(t),1==n._connectors.length&&n.emit("connected")}),t.on("close",function(){n._connectors.splice(n._connectors.indexOf(t),1),0==n._connectors.length&&n.emit("disconnected")}),t.on("error",function(e){t.close(),n.emit("error",e)}),t._messageUnpacked=function(e){var o=e.method,r=e.params;switch(o){case"offer":r.reply=function(n,o){return e.reply(n,o,t)};case"answer":case"error":r.pack=function(){return e.pack()},n.emit(o,r,t);break;default:console.error("Unknown message method '"+o+"'",e)}},t.on("message",function(n){n=e.unpack(n),n&&(n.stored?t.send(n):t._messageUnpacked(n))})}}var EventEmitter=_dereq_("events").EventEmitter,inherits=_dereq_("inherits");inherits(Manager,EventEmitter),Manager.prototype.close=function(){for(var e,n=0;e=this._connectors[n];n++)e.close()},Manager.prototype.send=function(e,n){for(var t,o=0;t=this._connectors[o];o++)t!==n&&t.send(e)},module.exports=Manager;
},{"events":16,"inherits":20}],11:[function(_dereq_,module,exports){
function PeersManager(e,n){function t(e){var n=new Connector_DataChannel(e);return r._initConnector(n),n}function a(e,a){if(e.label==n){var r=t(e);return r.sessionID=a,r}}Manager.call(this,e);var r=this,i={};this.__defineGetter__("peers",function(){return i}),this.add=function(e,n,t){function r(n){var t=n.channel,i=a(t,e);i&&n.target.removeEventListener("datachannel",r)}if(n.addEventListener("signalingstatechange",function(){"closed"==n.signalingState&&delete i[e]}),t.length)for(var s,o=0;(s=t[o])&&!a(s,e);o++);else n.addEventListener("datachannel",r);i[e]=n},this.get=function(e){return i[e]};var s=this.close;this.close=function(){for(var e in i)i[e].close();s.call(this)}}var inherits=_dereq_("inherits"),Manager=_dereq_("./Manager"),Connector_DataChannel=_dereq_("../connectors/core/DataChannel");inherits(PeersManager,Manager),module.exports=PeersManager;
},{"../connectors/core/DataChannel":5,"./Manager":10,"inherits":20}],12:[function(_dereq_,module,exports){
function pack(e,r){var s=new Array(6),a=e.params||{},o=e.method;switch(o){case"error":s[0]=ERROR;break;case"presence":s[0]=PRESENCE;break;case"offer":s[0]=OFFER;break;case"answer":s[0]=ANSWER;break;default:var t=new Error("Unknown message method '"+o+"'");throw t.message=e,t}return s[1]=a.from,"presence"!=o&&(s[2]=a.dest,s[3]=r,s[4]=a.ttl,s[5]=a.sdp||a.message),JSON.stringify(s)}function unpack(e){var r={},s={};e=JSON.parse(e);var a=e[0];switch(a){case ERROR:r.method="error";break;case PRESENCE:r.method="presence";break;case OFFER:r.method="offer";break;case ANSWER:r.method="answer";break;default:var o=Error("Unknown message method '"+a+"'");throw o.message=e,o}return s.from=e[1],a!=PRESENCE&&(s.dest=e[2],a==ERROR||a==ANSWER?r.ack=e[3]:r.id=e[3],s.ttl=e[4],a==ERROR?s.message=e[5]:s.sdp=e[5]),r.params=s,r}const ERROR=0,PRESENCE=1,OFFER=2,ANSWER=3;var responseMethods={presence:"offer",offer:{error:"error",response:"answer"}};exports.pack=pack,exports.unpack=unpack,exports.responseMethods=responseMethods;
},{}],13:[function(_dereq_,module,exports){
function Buffer(e,t,r){if(!(this instanceof Buffer))return new Buffer(e,t,r);var n=typeof e;if("base64"===t&&"string"===n)for(e=stringtrim(e);e.length%4!==0;)e+="=";var i;if("number"===n)i=coerce(e);else if("string"===n)i=Buffer.byteLength(e,t);else{if("object"!==n)throw new Error("First argument needs to be a number, array or string.");i=coerce(e.length)}var s;Buffer._useTypedArrays?s=Buffer._augment(new Uint8Array(i)):(s=this,s.length=i,s._isBuffer=!0);var a;if(Buffer._useTypedArrays&&"number"==typeof e.byteLength)s._set(e);else if(isArrayish(e))for(a=0;i>a;a++)s[a]=Buffer.isBuffer(e)?e.readUInt8(a):e[a];else if("string"===n)s.write(e,0,t);else if("number"===n&&!Buffer._useTypedArrays&&!r)for(a=0;i>a;a++)s[a]=0;return s}function hexWrite(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n),n>i&&(n=i)):n=i;var s=t.length;assert(s%2===0,"Invalid hex string"),n>s/2&&(n=s/2);for(var a=0;n>a;a++){var o=parseInt(t.substr(2*a,2),16);assert(!isNaN(o),"Invalid hex string"),e[r+a]=o}return a}function utf8Write(e,t,r,n){var i=blitBuffer(utf8ToBytes(t),e,r,n);return i}function asciiWrite(e,t,r,n){var i=blitBuffer(asciiToBytes(t),e,r,n);return i}function binaryWrite(e,t,r,n){return asciiWrite(e,t,r,n)}function base64Write(e,t,r,n){var i=blitBuffer(base64ToBytes(t),e,r,n);return i}function utf16leWrite(e,t,r,n){var i=blitBuffer(utf16leToBytes(t),e,r,n);return i}function base64Slice(e,t,r){return base64.fromByteArray(0===t&&r===e.length?e:e.slice(t,r))}function utf8Slice(e,t,r){var n="",i="";r=Math.min(e.length,r);for(var s=t;r>s;s++)e[s]<=127?(n+=decodeUtf8Char(i)+String.fromCharCode(e[s]),i=""):i+="%"+e[s].toString(16);return n+decodeUtf8Char(i)}function asciiSlice(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;r>i;i++)n+=String.fromCharCode(e[i]);return n}function binarySlice(e,t,r){return asciiSlice(e,t,r)}function hexSlice(e,t,r){var n=e.length;(!t||0>t)&&(t=0),(!r||0>r||r>n)&&(r=n);for(var i="",s=t;r>s;s++)i+=toHex(e[s]);return i}function utf16leSlice(e,t,r){for(var n=e.slice(t,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function readUInt16(e,t,r,n){n||(assert("boolean"==typeof r,"missing or invalid endian"),assert(void 0!==t&&null!==t,"missing offset"),assert(t+1<e.length,"Trying to read beyond buffer length"));var i=e.length;if(!(t>=i)){var s;return r?(s=e[t],i>t+1&&(s|=e[t+1]<<8)):(s=e[t]<<8,i>t+1&&(s|=e[t+1])),s}}function readUInt32(e,t,r,n){n||(assert("boolean"==typeof r,"missing or invalid endian"),assert(void 0!==t&&null!==t,"missing offset"),assert(t+3<e.length,"Trying to read beyond buffer length"));var i=e.length;if(!(t>=i)){var s;return r?(i>t+2&&(s=e[t+2]<<16),i>t+1&&(s|=e[t+1]<<8),s|=e[t],i>t+3&&(s+=e[t+3]<<24>>>0)):(i>t+1&&(s=e[t+1]<<16),i>t+2&&(s|=e[t+2]<<8),i>t+3&&(s|=e[t+3]),s+=e[t]<<24>>>0),s}}function readInt16(e,t,r,n){n||(assert("boolean"==typeof r,"missing or invalid endian"),assert(void 0!==t&&null!==t,"missing offset"),assert(t+1<e.length,"Trying to read beyond buffer length"));var i=e.length;if(!(t>=i)){var s=readUInt16(e,t,r,!0),a=32768&s;return a?-1*(65535-s+1):s}}function readInt32(e,t,r,n){n||(assert("boolean"==typeof r,"missing or invalid endian"),assert(void 0!==t&&null!==t,"missing offset"),assert(t+3<e.length,"Trying to read beyond buffer length"));var i=e.length;if(!(t>=i)){var s=readUInt32(e,t,r,!0),a=2147483648&s;return a?-1*(4294967295-s+1):s}}function readFloat(e,t,r,n){return n||(assert("boolean"==typeof r,"missing or invalid endian"),assert(t+3<e.length,"Trying to read beyond buffer length")),ieee754.read(e,t,r,23,4)}function readDouble(e,t,r,n){return n||(assert("boolean"==typeof r,"missing or invalid endian"),assert(t+7<e.length,"Trying to read beyond buffer length")),ieee754.read(e,t,r,52,8)}function writeUInt16(e,t,r,n,i){i||(assert(void 0!==t&&null!==t,"missing value"),assert("boolean"==typeof n,"missing or invalid endian"),assert(void 0!==r&&null!==r,"missing offset"),assert(r+1<e.length,"trying to write beyond buffer length"),verifuint(t,65535));var s=e.length;if(!(r>=s)){for(var a=0,o=Math.min(s-r,2);o>a;a++)e[r+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a);return r+2}}function writeUInt32(e,t,r,n,i){i||(assert(void 0!==t&&null!==t,"missing value"),assert("boolean"==typeof n,"missing or invalid endian"),assert(void 0!==r&&null!==r,"missing offset"),assert(r+3<e.length,"trying to write beyond buffer length"),verifuint(t,4294967295));var s=e.length;if(!(r>=s)){for(var a=0,o=Math.min(s-r,4);o>a;a++)e[r+a]=t>>>8*(n?a:3-a)&255;return r+4}}function writeInt16(e,t,r,n,i){i||(assert(void 0!==t&&null!==t,"missing value"),assert("boolean"==typeof n,"missing or invalid endian"),assert(void 0!==r&&null!==r,"missing offset"),assert(r+1<e.length,"Trying to write beyond buffer length"),verifsint(t,32767,-32768));var s=e.length;if(!(r>=s))return t>=0?writeUInt16(e,t,r,n,i):writeUInt16(e,65535+t+1,r,n,i),r+2}function writeInt32(e,t,r,n,i){i||(assert(void 0!==t&&null!==t,"missing value"),assert("boolean"==typeof n,"missing or invalid endian"),assert(void 0!==r&&null!==r,"missing offset"),assert(r+3<e.length,"Trying to write beyond buffer length"),verifsint(t,2147483647,-2147483648));var s=e.length;if(!(r>=s))return t>=0?writeUInt32(e,t,r,n,i):writeUInt32(e,4294967295+t+1,r,n,i),r+4}function writeFloat(e,t,r,n,i){i||(assert(void 0!==t&&null!==t,"missing value"),assert("boolean"==typeof n,"missing or invalid endian"),assert(void 0!==r&&null!==r,"missing offset"),assert(r+3<e.length,"Trying to write beyond buffer length"),verifIEEE754(t,3.4028234663852886e38,-3.4028234663852886e38));var s=e.length;if(!(r>=s))return ieee754.write(e,t,r,n,23,4),r+4}function writeDouble(e,t,r,n,i){i||(assert(void 0!==t&&null!==t,"missing value"),assert("boolean"==typeof n,"missing or invalid endian"),assert(void 0!==r&&null!==r,"missing offset"),assert(r+7<e.length,"Trying to write beyond buffer length"),verifIEEE754(t,1.7976931348623157e308,-1.7976931348623157e308));var s=e.length;if(!(r>=s))return ieee754.write(e,t,r,n,52,8),r+8}function stringtrim(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function clamp(e,t,r){return"number"!=typeof e?r:(e=~~e,e>=t?t:e>=0?e:(e+=t,e>=0?e:0))}function coerce(e){return e=~~Math.ceil(+e),0>e?0:e}function isArray(e){return(Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)})(e)}function isArrayish(e){return isArray(e)||Buffer.isBuffer(e)||e&&"object"==typeof e&&"number"==typeof e.length}function toHex(e){return 16>e?"0"+e.toString(16):e.toString(16)}function utf8ToBytes(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);if(127>=n)t.push(n);else{var i=r;n>=55296&&57343>=n&&r++;for(var s=encodeURIComponent(e.slice(i,r+1)).substr(1).split("%"),a=0;a<s.length;a++)t.push(parseInt(s[a],16))}}return t}function asciiToBytes(e){for(var t=[],r=0;r<e.length;r++)t.push(255&e.charCodeAt(r));return t}function utf16leToBytes(e){for(var t,r,n,i=[],s=0;s<e.length;s++)t=e.charCodeAt(s),r=t>>8,n=t%256,i.push(n),i.push(r);return i}function base64ToBytes(e){return base64.toByteArray(e)}function blitBuffer(e,t,r,n){for(var i=0;n>i&&!(i+r>=t.length||i>=e.length);i++)t[i+r]=e[i];return i}function decodeUtf8Char(e){try{return decodeURIComponent(e)}catch(t){return String.fromCharCode(65533)}}function verifuint(e,t){assert("number"==typeof e,"cannot write a non-number as a number"),assert(e>=0,"specified a negative value for writing an unsigned value"),assert(t>=e,"value is larger than maximum value for type"),assert(Math.floor(e)===e,"value has a fractional component")}function verifsint(e,t,r){assert("number"==typeof e,"cannot write a non-number as a number"),assert(t>=e,"value larger than maximum allowed value"),assert(e>=r,"value smaller than minimum allowed value"),assert(Math.floor(e)===e,"value has a fractional component")}function verifIEEE754(e,t,r){assert("number"==typeof e,"cannot write a non-number as a number"),assert(t>=e,"value larger than maximum allowed value"),assert(e>=r,"value smaller than minimum allowed value")}function assert(e,t){if(!e)throw new Error(t||"Failed assertion")}var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754");exports.Buffer=Buffer,exports.SlowBuffer=Buffer,exports.INSPECT_MAX_BYTES=50,Buffer.poolSize=8192,Buffer._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&"function"==typeof t.subarray}catch(r){return!1}}(),Buffer.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.isBuffer=function(e){return!(null===e||void 0===e||!e._isBuffer)},Buffer.byteLength=function(e,t){var r;switch(e=e.toString(),t||"utf8"){case"hex":r=e.length/2;break;case"utf8":case"utf-8":r=utf8ToBytes(e).length;break;case"ascii":case"binary":case"raw":r=e.length;break;case"base64":r=base64ToBytes(e).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":r=2*e.length;break;default:throw new Error("Unknown encoding")}return r},Buffer.concat=function(e,t){if(assert(isArray(e),"Usage: Buffer.concat(list[, length])"),0===e.length)return new Buffer(0);if(1===e.length)return e[0];var r;if(void 0===t)for(t=0,r=0;r<e.length;r++)t+=e[r].length;var n=new Buffer(t),i=0;for(r=0;r<e.length;r++){var s=e[r];s.copy(n,i),i+=s.length}return n},Buffer.compare=function(e,t){assert(Buffer.isBuffer(e)&&Buffer.isBuffer(t),"Arguments must be Buffers");for(var r=e.length,n=t.length,i=0,s=Math.min(r,n);s>i&&e[i]===t[i];i++);return i!==s&&(r=e[i],n=t[i]),n>r?-1:r>n?1:0},Buffer.prototype.write=function(e,t,r,n){if(isFinite(t))isFinite(r)||(n=r,r=void 0);else{var i=n;n=t,t=r,r=i}t=Number(t)||0;var s=this.length-t;r?(r=Number(r),r>s&&(r=s)):r=s,n=String(n||"utf8").toLowerCase();var a;switch(n){case"hex":a=hexWrite(this,e,t,r);break;case"utf8":case"utf-8":a=utf8Write(this,e,t,r);break;case"ascii":a=asciiWrite(this,e,t,r);break;case"binary":a=binaryWrite(this,e,t,r);break;case"base64":a=base64Write(this,e,t,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":a=utf16leWrite(this,e,t,r);break;default:throw new Error("Unknown encoding")}return a},Buffer.prototype.toString=function(e,t,r){var n=this;if(e=String(e||"utf8").toLowerCase(),t=Number(t)||0,r=void 0===r?n.length:Number(r),r===t)return"";var i;switch(e){case"hex":i=hexSlice(n,t,r);break;case"utf8":case"utf-8":i=utf8Slice(n,t,r);break;case"ascii":i=asciiSlice(n,t,r);break;case"binary":i=binarySlice(n,t,r);break;case"base64":i=base64Slice(n,t,r);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":i=utf16leSlice(n,t,r);break;default:throw new Error("Unknown encoding")}return i},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.equals=function(e){return assert(Buffer.isBuffer(e),"Argument must be a Buffer"),0===Buffer.compare(this,e)},Buffer.prototype.compare=function(e){return assert(Buffer.isBuffer(e),"Argument must be a Buffer"),Buffer.compare(this,e)},Buffer.prototype.copy=function(e,t,r,n){var i=this;if(r||(r=0),n||0===n||(n=this.length),t||(t=0),n!==r&&0!==e.length&&0!==i.length){assert(n>=r,"sourceEnd < sourceStart"),assert(t>=0&&t<e.length,"targetStart out of bounds"),assert(r>=0&&r<i.length,"sourceStart out of bounds"),assert(n>=0&&n<=i.length,"sourceEnd out of bounds"),n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var s=n-r;if(100>s||!Buffer._useTypedArrays)for(var a=0;s>a;a++)e[a+t]=this[a+r];else e._set(this.subarray(r,r+s),t)}},Buffer.prototype.slice=function(e,t){var r=this.length;if(e=clamp(e,r,0),t=clamp(t,r,r),Buffer._useTypedArrays)return Buffer._augment(this.subarray(e,t));for(var n=t-e,i=new Buffer(n,void 0,!0),s=0;n>s;s++)i[s]=this[s+e];return i},Buffer.prototype.get=function(e){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(e)},Buffer.prototype.set=function(e,t){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(e,t)},Buffer.prototype.readUInt8=function(e,t){return t||(assert(void 0!==e&&null!==e,"missing offset"),assert(e<this.length,"Trying to read beyond buffer length")),e>=this.length?void 0:this[e]},Buffer.prototype.readUInt16LE=function(e,t){return readUInt16(this,e,!0,t)},Buffer.prototype.readUInt16BE=function(e,t){return readUInt16(this,e,!1,t)},Buffer.prototype.readUInt32LE=function(e,t){return readUInt32(this,e,!0,t)},Buffer.prototype.readUInt32BE=function(e,t){return readUInt32(this,e,!1,t)},Buffer.prototype.readInt8=function(e,t){if(t||(assert(void 0!==e&&null!==e,"missing offset"),assert(e<this.length,"Trying to read beyond buffer length")),!(e>=this.length)){var r=128&this[e];return r?-1*(255-this[e]+1):this[e]}},Buffer.prototype.readInt16LE=function(e,t){return readInt16(this,e,!0,t)},Buffer.prototype.readInt16BE=function(e,t){return readInt16(this,e,!1,t)},Buffer.prototype.readInt32LE=function(e,t){return readInt32(this,e,!0,t)},Buffer.prototype.readInt32BE=function(e,t){return readInt32(this,e,!1,t)},Buffer.prototype.readFloatLE=function(e,t){return readFloat(this,e,!0,t)},Buffer.prototype.readFloatBE=function(e,t){return readFloat(this,e,!1,t)},Buffer.prototype.readDoubleLE=function(e,t){return readDouble(this,e,!0,t)},Buffer.prototype.readDoubleBE=function(e,t){return readDouble(this,e,!1,t)},Buffer.prototype.writeUInt8=function(e,t,r){return r||(assert(void 0!==e&&null!==e,"missing value"),assert(void 0!==t&&null!==t,"missing offset"),assert(t<this.length,"trying to write beyond buffer length"),verifuint(e,255)),t>=this.length?void 0:(this[t]=e,t+1)},Buffer.prototype.writeUInt16LE=function(e,t,r){return writeUInt16(this,e,t,!0,r)},Buffer.prototype.writeUInt16BE=function(e,t,r){return writeUInt16(this,e,t,!1,r)},Buffer.prototype.writeUInt32LE=function(e,t,r){return writeUInt32(this,e,t,!0,r)},Buffer.prototype.writeUInt32BE=function(e,t,r){return writeUInt32(this,e,t,!1,r)},Buffer.prototype.writeInt8=function(e,t,r){return r||(assert(void 0!==e&&null!==e,"missing value"),assert(void 0!==t&&null!==t,"missing offset"),assert(t<this.length,"Trying to write beyond buffer length"),verifsint(e,127,-128)),t>=this.length?void 0:(e>=0?this.writeUInt8(e,t,r):this.writeUInt8(255+e+1,t,r),t+1)},Buffer.prototype.writeInt16LE=function(e,t,r){return writeInt16(this,e,t,!0,r)},Buffer.prototype.writeInt16BE=function(e,t,r){return writeInt16(this,e,t,!1,r)},Buffer.prototype.writeInt32LE=function(e,t,r){return writeInt32(this,e,t,!0,r)},Buffer.prototype.writeInt32BE=function(e,t,r){return writeInt32(this,e,t,!1,r)},Buffer.prototype.writeFloatLE=function(e,t,r){return writeFloat(this,e,t,!0,r)},Buffer.prototype.writeFloatBE=function(e,t,r){return writeFloat(this,e,t,!1,r)},Buffer.prototype.writeDoubleLE=function(e,t,r){return writeDouble(this,e,t,!0,r)},Buffer.prototype.writeDoubleBE=function(e,t,r){return writeDouble(this,e,t,!1,r)},Buffer.prototype.fill=function(e,t,r){if(e||(e=0),t||(t=0),r||(r=this.length),assert(r>=t,"end < start"),r!==t&&0!==this.length){assert(t>=0&&t<this.length,"start out of bounds"),assert(r>=0&&r<=this.length,"end out of bounds");var n;if("number"==typeof e)for(n=t;r>n;n++)this[n]=e;else{var i=utf8ToBytes(e.toString()),s=i.length;for(n=t;r>n;n++)this[n]=i[n%s]}return this}},Buffer.prototype.inspect=function(){for(var e=[],t=this.length,r=0;t>r;r++)if(e[r]=toHex(this[r]),r===exports.INSPECT_MAX_BYTES){e[r+1]="...";break}return"<Buffer "+e.join(" ")+">"},Buffer.prototype.toArrayBuffer=function(){if("undefined"!=typeof Uint8Array){if(Buffer._useTypedArrays)return new Buffer(this).buffer;for(var e=new Uint8Array(this.length),t=0,r=e.length;r>t;t+=1)e[t]=this[t];return e.buffer}throw new Error("Buffer.toArrayBuffer not supported in this browser")};var BP=Buffer.prototype;Buffer._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=BP.get,e.set=BP.set,e.write=BP.write,e.toString=BP.toString,e.toLocaleString=BP.toString,e.toJSON=BP.toJSON,e.equals=BP.equals,e.compare=BP.compare,e.copy=BP.copy,e.slice=BP.slice,e.readUInt8=BP.readUInt8,e.readUInt16LE=BP.readUInt16LE,e.readUInt16BE=BP.readUInt16BE,e.readUInt32LE=BP.readUInt32LE,e.readUInt32BE=BP.readUInt32BE,e.readInt8=BP.readInt8,e.readInt16LE=BP.readInt16LE,e.readInt16BE=BP.readInt16BE,e.readInt32LE=BP.readInt32LE,e.readInt32BE=BP.readInt32BE,e.readFloatLE=BP.readFloatLE,e.readFloatBE=BP.readFloatBE,e.readDoubleLE=BP.readDoubleLE,e.readDoubleBE=BP.readDoubleBE,e.writeUInt8=BP.writeUInt8,e.writeUInt16LE=BP.writeUInt16LE,e.writeUInt16BE=BP.writeUInt16BE,e.writeUInt32LE=BP.writeUInt32LE,e.writeUInt32BE=BP.writeUInt32BE,e.writeInt8=BP.writeInt8,e.writeInt16LE=BP.writeInt16LE,e.writeInt16BE=BP.writeInt16BE,e.writeInt32LE=BP.writeInt32LE,e.writeInt32BE=BP.writeInt32BE,e.writeFloatLE=BP.writeFloatLE,e.writeFloatBE=BP.writeFloatBE,e.writeDoubleLE=BP.writeDoubleLE,e.writeDoubleBE=BP.writeDoubleBE,e.fill=BP.fill,e.inspect=BP.inspect,e.toArrayBuffer=BP.toArrayBuffer,e};
},{"base64-js":14,"ieee754":15}],14:[function(_dereq_,module,exports){
var lookup="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";!function(){"use strict";function r(r){var t=r.charCodeAt(0);return t===a?62:t===h?63:o>t?-1:o+10>t?t-o+26+26:A+26>t?t-A:c+26>t?t-c+26:void 0}function t(t){function e(r){u[l++]=r}var a,h,o,c,A,u;if(t.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var i=t.length;A="="===t.charAt(i-2)?2:"="===t.charAt(i-1)?1:0,u=new n(3*t.length/4-A),o=A>0?t.length-4:t.length;var l=0;for(a=0,h=0;o>a;a+=4,h+=3)c=r(t.charAt(a))<<18|r(t.charAt(a+1))<<12|r(t.charAt(a+2))<<6|r(t.charAt(a+3)),e((16711680&c)>>16),e((65280&c)>>8),e(255&c);return 2===A?(c=r(t.charAt(a))<<2|r(t.charAt(a+1))>>4,e(255&c)):1===A&&(c=r(t.charAt(a))<<10|r(t.charAt(a+1))<<4|r(t.charAt(a+2))>>2,e(c>>8&255),e(255&c)),u}function e(r){function t(r){return lookup.charAt(r)}function e(r){return t(r>>18&63)+t(r>>12&63)+t(r>>6&63)+t(63&r)}var n,a,h,o=r.length%3,c="";for(n=0,h=r.length-o;h>n;n+=3)a=(r[n]<<16)+(r[n+1]<<8)+r[n+2],c+=e(a);switch(o){case 1:a=r[r.length-1],c+=t(a>>2),c+=t(a<<4&63),c+="==";break;case 2:a=(r[r.length-2]<<8)+r[r.length-1],c+=t(a>>10),c+=t(a>>4&63),c+=t(a<<2&63),c+="="}return c}var n="undefined"!=typeof Uint8Array?Uint8Array:Array,a=("0".charCodeAt(0),"+".charCodeAt(0)),h="/".charCodeAt(0),o="0".charCodeAt(0),c="a".charCodeAt(0),A="A".charCodeAt(0);module.exports.toByteArray=t,module.exports.fromByteArray=e}();
},{}],15:[function(_dereq_,module,exports){
exports.read=function(o,t,a,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,n=a?h-1:0,s=a?-1:1,N=o[t+n];for(n+=s,M=N&(1<<-i)-1,N>>=-i,i+=w;i>0;M=256*M+o[t+n],n+=s,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+o[t+n],n+=s,i-=8);if(0===M)M=1-e;else{if(M===f)return p?0/0:1/0*(N?-1:1);p+=Math.pow(2,r),M-=e}return(N?-1:1)*p*Math.pow(2,M-r)},exports.write=function(o,t,a,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,n=i>>1,s=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,N=r?0:M-1,u=r?1:-1,l=0>t||0===t&&0>1/t?1:0;for(t=Math.abs(t),isNaN(t)||1/0===t?(w=isNaN(t)?1:0,p=i):(p=Math.floor(Math.log(t)/Math.LN2),t*(f=Math.pow(2,-p))<1&&(p--,f*=2),t+=p+n>=1?s/f:s*Math.pow(2,1-n),t*f>=2&&(p++,f/=2),p+n>=i?(w=0,p=i):p+n>=1?(w=(t*f-1)*Math.pow(2,h),p+=n):(w=t*Math.pow(2,n-1)*Math.pow(2,h),p=0));h>=8;o[a+N]=255&w,N+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;o[a+N]=255&p,N+=u,p/=256,e-=8);o[a+N-u]|=128*l};
},{}],16:[function(_dereq_,module,exports){
function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,n,s,i,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length))throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');if(n=this._events[e],isUndefined(n))return!1;if(isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];n.apply(this,i)}else if(isObject(n)){for(s=arguments.length,i=new Array(s-1),r=1;s>r;r++)i[r-1]=arguments[r];for(o=n.slice(),s=o.length,r=0;s>r;r++)o[r].apply(this,i)}return!0},EventEmitter.prototype.addListener=function(e,t){var n;if(!isFunction(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned){var n;n=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function n(){this.removeListener(e,n),s||(s=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var s=!1;return n.listener=t,this.on(e,n),this},EventEmitter.prototype.removeListener=function(e,t){var n,s,i,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,s=-1,n===t||isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(n)){for(r=i;r-->0;)if(n[r]===t||n[r].listener&&n[r].listener===t){s=r;break}if(0>s)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],isFunction(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?isFunction(e._events[t])?1:e._events[t].length:0};
},{}],17:[function(_dereq_,module,exports){
function noop(){}var process=module.exports={};process.nextTick=function(){var o="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(o)return function(o){return window.setImmediate(o)};if(e){var s=[];return window.addEventListener("message",function(o){var e=o.source;if((e===window||null===e)&&"process-tick"===o.data&&(o.stopPropagation(),s.length>0)){var n=s.shift();n()}},!0),function(o){s.push(o),window.postMessage("process-tick","*")}}return function(o){setTimeout(o,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")};
},{}],18:[function(_dereq_,module,exports){
"use strict";var freeice=module.exports=function(r){function n(r,n){for(var t,c=[],u=[].concat(e[r]);u.length&&c.length<n;)t=Math.random()*u.length|0,c=c.concat(u.splice(t,1));return c.map(function(n){return{url:r+":"+n}})}var t,e=(r||{}).servers||_dereq_("./servers"),c=(r||{}).stun||2,u=(r||{}).turn||0;return t=[].concat(n("stun",c)),u&&(t=t.concat(n("turn",u))),t};
},{"./servers":19}],19:[function(_dereq_,module,exports){
exports.stun=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.iptel.org","stun.rixtelecom.se","stun.schlund.de","stunserver.org","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com"],exports.turn=[];
},{}],20:[function(_dereq_,module,exports){
module.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],21:[function(_dereq_,module,exports){
(function (process,global){
(function(){var n,o,e,r,t;if(n=_dereq_("events").EventEmitter,e=function(){var o,e,r;r=n.prototype;for(o in r)if(e=r[o],null!=process[o])return!1;return!0},"undefined"!=typeof window&&null!==window&&window.document&&window.navigator&&"undefined"!=typeof process&&null!==process&&"undefined"!=typeof global&&null!==global&&window===global&&null===window.onerror&&e()){t=n.prototype;for(o in t)r=t[o],process[o]=r;window.onerror=function(n,o,e){return process.emit("uncaughtException",new Error(""+n+" ("+o+":"+e+")"))},window.addEventListener("unload",function(){return process.emit("exit")})}}).call(this);
}).call(this,_dereq_("FWaASH"),typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"FWaASH":17,"events":16}],22:[function(_dereq_,module,exports){
function Mapper(){var e={};this.get=function(t,o){var i=e[o];return void 0==i?void 0:i[t]},this.remove=function(t,o){var i=e[o];void 0!=i&&(delete i[t],Object.keys(i).length||delete e[o])},this.set=function(t,o,i){if(void 0==t)return this.remove(o,i);var r=e[i];void 0==r&&(e[i]=r={}),r[o]=t}}Mapper.prototype.pop=function(e,t){var o=this.get(e,t);return void 0==o?void 0:(this.remove(e,t),o)},module.exports=Mapper;
},{}],23:[function(_dereq_,module,exports){
function unifyResponseMethods(e){if(!e)return{};for(var r in e){var t=e[r];"string"==typeof t&&(e[r]={response:t})}return e}function checkValidTransport(e){if(e&&!(e instanceof Function||e.send instanceof Function))throw new SyntaxError("Transport is not a function nor have a send method")}function RpcNotification(e,r){Object.defineProperty(this,"method",{value:e,enumerable:!0}),Object.defineProperty(this,"params",{value:r,enumerable:!0})}function RpcBuilder(e,r,t){function n(e,r,t){var n={message:e,timeout:setTimeout(function(){l.remove(r,t)},f)};l.set(n,r,t)}function i(r,t,i,o,s){RpcNotification.call(this,r,t),this.transport=s;var c=l.get(i,o);Object.defineProperty(this,"duplicated",{value:Boolean(c)});var f=a[r];this.pack=function(){return e.pack(this,i)},this.reply=function(r,t,a){if(r instanceof Function||r&&r.send instanceof Function){if(void 0!=t)throw new SyntaxError("There can't be parameters after callback");a=r,t=null,r=void 0}else if(t instanceof Function||t&&t.send instanceof Function){if(void 0!=a)throw new SyntaxError("There can't be parameters after callback");a=t,t=null}checkValidTransport(a),c&&clearTimeout(c.timeout),void 0!=o&&(r&&(r.dest=o),t&&(t.dest=o));var s;if(r||void 0!=t){if(void 0!=u.peerID&&(r?r.from=u.peerID:t.from=u.peerID),f)if(void 0==f.error&&r)s={error:r};else{var p=r?f.error:f.response;s={method:p,params:r||t}}else s={error:r,result:t};s=e.pack(s,i)}else s=c?c.message:e.pack({result:null},i);return n(s,i,o),a=a||this.transport||u.transport,a?a instanceof Function?a(s):a.send(s):s}}function o(e){var r=v[e];if(r){delete v[e];var t=d.pop(r.id,r.dest);t&&clearTimeout(t.timeout)}}if(!e)throw new SyntaxError("Packer is not defined");if(!e.pack||!e.unpack)throw new SyntaxError("Packer is invalid");var a=unifyResponseMethods(e.responseMethods);if(r instanceof Function||r&&r.send instanceof Function){if(t)throw new SyntaxError("There can't be parameters after callback");t=r,r=void 0}r=r||{},Object.defineProperty(this,"peerID",{value:r.peerID});var s=r.max_retries||0;checkValidTransport(t),this.transport=t;const c=r.request_timeout||BASE_TIMEOUT,f=r.response_timeout||BASE_TIMEOUT;var u=this,p=0,d=new Mapper,l=new Mapper,v={};inherits(i,RpcNotification),this.cancel=function(e){if(e)return o(e);for(var e in v)o(e)},this.encode=function(r,t,n,i,o){function f(e,r){u.cancel(w),o(e,r)}function l(e){return y.timeout=setTimeout(m,c*Math.pow(2,T++)),v[w]={id:b,dest:n},d.set(y,b,n),e=e||k||u.transport,e?e instanceof Function?e(w):e.send(w):w}function h(e){return console.warn(T+" retry for request message:",w),l(e)}function m(){if(s>T)return h(i);var e=new Error("Request has timed out");e.request=w,e.retry=h,f(e)}if(t instanceof Function){if(void 0!=n)throw new SyntaxError("There can't be parameters after callback");o=t,i=void 0,n=void 0,t=void 0}else if(n instanceof Function){if(void 0!=i)throw new SyntaxError("There can't be parameters after callback");o=n,i=void 0,n=void 0}else if(i instanceof Function){if(void 0!=o)throw new SyntaxError("There can't be parameters after callback");o=i,i=void 0}var k=i;u.peerID&&(t=t||{},t.from=u.peerID);var w={method:r,params:t};if(o){var b=p++,T=0;w=e.pack(w,b);var y={message:w,callback:f,responseMethods:a[r]||{}};return l(i)}return e.pack(w)},this.decode=function(r,t){if(!r)throw new TypeError("Message is not defined");r=e.unpack(r);var n=r.id,o=r.ack,a=r.method,s=r.params||{},c=s.from,f=s.dest;if(void 0==u.peerID||c!=u.peerID){if(void 0==n&&void 0==o)return new RpcNotification(a,s);if(a){if(void 0==f||f==u.peerID){var p=d.get(o,c);if(p){var l=p.responseMethods;if(a==l.error)return p.callback(s),d.remove(o,c);if(a==l.response)return p.callback(null,s),d.remove(o,c)}}checkValidTransport(t);var v=void 0!=n?n:o;return new i(a,s,v,c,t)}var h=r.error,m=r.result;if(!(h&&h.dest&&h.dest!=u.sessionID||m&&m.dest&&m.dest!=u.sessionID)){var p=d.get(o,c);if(void 0==p)return console.warn("No callback was defined for this message",r);this.cancel(p),h&&(h=new RpcError(h,t)),p.callback(h,m)}}}}var inherits=_dereq_("inherits"),packers=_dereq_("./packers"),Mapper=_dereq_("./Mapper");const BASE_TIMEOUT=5e3;RpcBuilder.RpcNotification=RpcNotification,module.exports=RpcBuilder,RpcBuilder.packers=packers;
},{"./Mapper":22,"./packers":26,"inherits":27}],24:[function(_dereq_,module,exports){
function pack(r,e){var o={jsonrpc:"2.0"};if(r.method)o.method=r.method,r.params&&(o.params=r.params),void 0!=e&&(o.id=e);else if(void 0!=e){if(r.error){if(void 0!==r.result)throw new TypeError("Both result and error are defined");o.error=r.error}else{if(void 0===r.result)throw new TypeError("No result or error is defined");o.result=r.result}o.id=e}return JSON.stringify(o)}function unpack(r){var e=r;("string"==typeof r||r instanceof String)&&(e=JSON.parse(r));var o=e.jsonrpc;if("2.0"!=o)throw new TypeError("Invalid JsonRPC version '"+o+"': "+r);if(void 0==e.method){if(void 0==e.id)throw new TypeError("Invalid message: "+r);var i=void 0!==e.result,t=void 0!==e.error;if(i&&t)throw new TypeError("Both result and error are defined: "+r);if(!i&&!t)throw new TypeError("No result or error is defined: "+r);e.ack=e.id,delete e.id}return e}exports.pack=pack,exports.unpack=unpack;
},{}],25:[function(_dereq_,module,exports){
function pack(){throw new TypeError("Not yet implemented")}function unpack(){throw new TypeError("Not yet implemented")}exports.pack=pack,exports.unpack=unpack;
},{}],26:[function(_dereq_,module,exports){
var JsonRPC=_dereq_("./JsonRPC"),XmlRPC=_dereq_("./XmlRPC");exports.JsonRPC=JsonRPC,exports.XmlRPC=XmlRPC;
},{"./JsonRPC":24,"./XmlRPC":25}],27:[function(_dereq_,module,exports){
module.exports=_dereq_(20)
},{}],28:[function(_dereq_,module,exports){
(function (global){
var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var r,n=0;16>n;n++)0===(3&n)&&(r=4294967296*Math.random()),_rnds[n]=r>>>((3&n)<<3)&255;return _rnds}}module.exports=rng;
}).call(this,typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],29:[function(_dereq_,module,exports){
(function (Buffer){
function parse(e,s,r){var t=s&&r||0,u=0;for(s=s||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>u&&(s[t+u++]=_hexToByte[e])});16>u;)s[t+u++]=0;return s}function unparse(e,s){var r=s||0,t=_byteToHex;return t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]}function v1(e,s,r){var t=s&&r||0,u=s||[];e=e||{};var n=void 0!==e.clockseq?e.clockseq:_clockseq,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),o=void 0!==e.nsecs?e.nsecs:_lastNSecs+1,c=a-_lastMSecs+(o-_lastNSecs)/1e4;if(0>c&&void 0===e.clockseq&&(n=n+1&16383),(0>c||a>_lastMSecs)&&void 0===e.nsecs&&(o=0),o>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=a,_lastNSecs=o,_clockseq=n,a+=122192928e5;var i=(1e4*(268435455&a)+o)%4294967296;u[t++]=i>>>24&255,u[t++]=i>>>16&255,u[t++]=i>>>8&255,u[t++]=255&i;var _=a/4294967296*1e4&268435455;u[t++]=_>>>8&255,u[t++]=255&_,u[t++]=_>>>24&15|16,u[t++]=_>>>16&255,u[t++]=n>>>8|128,u[t++]=255&n;for(var d=e.node||_nodeId,f=0;6>f;f++)u[t+f]=d[f];return s?s:unparse(u)}function v4(e,s,r){var t=s&&r||0;"string"==typeof e&&(s="binary"==e?new BufferClass(16):null,e=null),e=e||{};var u=e.random||(e.rng||_rng)();if(u[6]=15&u[6]|64,u[8]=63&u[8]|128,s)for(var n=0;16>n;n++)s[t+n]=u[n];return s||unparse(u)}for(var _rng=_dereq_("./rng"),BufferClass="function"==typeof Buffer?Buffer:Array,_byteToHex=[],_hexToByte={},i=0;256>i;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,uuid.BufferClass=BufferClass,module.exports=uuid;
}).call(this,_dereq_("buffer").Buffer)
},{"./rng":28,"buffer":13}],30:[function(_dereq_,module,exports){
var RTCIceCandidate=window.mozRTCIceCandidate||window.webkitRTCIceCandidate||window.RTCIceCandidate,RTCPeerConnection=window.mozRTCPeerConnection||window.webkitRTCPeerConnection||window.RTCPeerConnection,RTCSessionDescription=window.mozRTCSessionDescription||window.webkitRTCSessionDescription||window.RTCSessionDescription;exports.RTCIceCandidate=RTCIceCandidate,exports.RTCPeerConnection=RTCPeerConnection,exports.RTCSessionDescription=RTCSessionDescription;
},{}],31:[function(_dereq_,module,exports){
function unique(){return"x"+ ++NOW+ +new Date}function rnow(){return+new Date}function build_url(e,n){var t=e.join(URLBIT),r=[];return n?(each(n,function(e,n){var t="object"==typeof n?JSON.stringify(n):n;"undefined"!=typeof n&&null!=n&&encode(t).length>0&&r.push(e+"="+encode(t))}),t+="?"+r.join(PARAMSBIT)):t}function updater(e,n){var t,r=0,c=function(){r+n>rnow()?(clearTimeout(t),t=setTimeout(c,n)):(r=rnow(),e())};return c}function grep(e,n){var t=[];return each(e||[],function(e){n(e)&&t.push(e)}),t}function supplant(e,n){return e.replace(REPL,function(e,t){return n[t]||e})}function timeout(e,n){return setTimeout(e,n)}function uuid(e){var n="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"==e?n:3&n|8;return t.toString(16)});return e&&e(n),n}function isArray(e){var n=Object.prototype.toString.call(e);return"[object Array]"===n||"[object NodeList]"===n||"[object ScriptBridgingArrayProxyObject]"===n}function each(e,n,t){if(e&&n)if(isArray(e)||t&&"undefined"!=typeof e[0])for(var r=0,c=e.length;c>r;)n.call(e[r],e[r],r++);else for(var r in e)e.hasOwnProperty&&e.hasOwnProperty(r)&&n.call(e[r],r,e[r])}function map(e,n){var t=[];return each(e||[],function(e,r){t.push(n(e,r))}),t}function encode(e){return encodeURIComponent(e)}function generate_channel_list(e,n){var t=[];return each(e,function(e,r){n?e.search("-pnpres")<0&&r.subscribed&&t.push(e):r.subscribed&&t.push(e)}),t.sort()}function ready(){timeout(function(){READY||(READY=1,each(READY_BUFFER,function(e){e()}))},SECOND)}function PN_API(e){function n(e,n,t){var r=!1;if("number"==typeof e)r=e>PRESENCE_HB_THRESHOLD||0==e?!1:!0;else{if("boolean"==typeof e)return e?PRESENCE_HB_DEFAULT:0;r=!0}return r?(t&&t("Presence Heartbeat value invalid. Valid range ( x > "+PRESENCE_HB_THRESHOLD+" or x = 0). Current Value : "+(n||PRESENCE_HB_THRESHOLD)),n||PRESENCE_HB_THRESHOLD):e}function t(e,n){return $.encrypt(e,n||Q)||e}function r(e,n){return $.decrypt(e,n||Q)||$.decrypt(e,Q)||e}function c(){return clearTimeout(H),!K||K>=500||1>K||!generate_channel_list(U,!0).length?void(J=!1):(J=!0,void en.presence_heartbeat({callback:function(){H=timeout(c,K*SECOND)},error:function(e){W&&W("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(e)),H=timeout(c,K*SECOND)}}))}function i(){!J&&c()}function a(e){if(G){if(!A.length)return}else{if(e&&(A.sending=0),A.sending||!A.length)return;A.sending=1}V(A.shift())}function o(e){var n=0;return each(generate_channel_list(U),function(t){var r=U[t];r&&(n++,(e||function(){})(r))}),n}function u(e,n,t){if("object"==typeof e){if(e.error&&e.message&&e.payload)return void t({message:e.message,payload:e.payload});if(e.payload)return void n(e.payload)}n(e)}function f(e,n){n("object"==typeof e&&e.error&&e.message&&e.payload?{message:e.message,payload:e.payload}:e)}function s(){X()||d(1,{error:"Offline. Please check your network settings. "}),timeout(s,SECOND)}function l(){en.time(function(e){h(function(){},e),e||d(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),timeout(l,y)})}function d(e,n){P&&P(e,n),P=null}function b(e){var n=rnow()-M;return n-e/1e4}function h(e,n){function t(n){if(n){var t=n/1e4,c=(rnow()-r)/2;M=rnow()-(t+c),e&&e(M)}}var r=rnow();n&&t(n)||en.time(t)}var p=+e.windowing||DEF_WINDOWING,g=(+e.timeout||DEF_SUB_TIMEOUT)*SECOND,y=(+e.keepalive||DEF_KEEPALIVE)*SECOND,v=e.noleave||0,E=e.publish_key||"demo",S=e.subscribe_key||"demo",_=e.auth_key||"",m=e.secret_key||"",k=e.PNSDK||"",C=e.hmac_SHA256,O=e.ssl?"s":"",N="http"+O+"://"+(e.origin||"pubsub.pubnub.com"),w=nextorigin(N),x=nextorigin(N),D=function(){},A=[],M=0,L=0,R=0,P=0,F=0,T=0,B=!1,U={},I={},H=null,j=n(e.heartbeat||e.pnexpires||0,e.error),K=e.heartbeat_interval||j-3,J=!1,G=e.no_wait_for_pending,Y=e["compatible_3.5"]||!1,V=e.xdr,W=e.error||function(){},X=e._is_online||function(){return 1},q=e.jsonp_cb||function(){return 0},z=e.db||{get:function(){},set:function(){}},Q=e.cipher_key,Z=e.uuid||z&&z.get(S+"uuid")||"",$=e.crypto_obj||{encrypt:function(e){return e},decrypt:function(e){return e}},en={LEAVE:function(e,n,t,r){var c={uuid:Z,auth:_},i=nextorigin(N),t=t||function(){},a=r||function(){},o=q();if(e.indexOf(PRESENCE_SUFFIX)>0)return!0;if(Y){if(!O)return!1;if("0"==o)return!1}return v?!1:("0"!=o&&(c.callback=o),V({blocking:n||O,timeout:2e3,callback:o,data:c,success:function(e){u(e,t,a)},fail:function(e){f(e,a)},url:[i,"v2","presence","sub_key",S,"channel",encode(e),"leave"]}),!0)},set_resumed:function(e){B=e},get_cipher_key:function(){return Q},set_cipher_key:function(e){Q=e},raw_encrypt:function(e,n){return t(e,n)},raw_decrypt:function(e,n){return r(e,n)},get_heartbeat:function(){return j},set_heartbeat:function(e){j=n(e,K,W),K=j-3>=1?j-3:1,D(),c()},get_heartbeat_interval:function(){return K},set_heartbeat_interval:function(e){K=e,c()},get_version:function(){return SDK_VER},history:function(e,n){var n=e.callback||n,t=e.count||e.limit||100,c=e.reverse||"false",i=e.error||function(){},a=e.auth_key||_,o=e.cipher_key,u=e.channel,s=e.start,l=e.end,d=e.include_token,b={},h=q();return u?n?S?(b.stringtoken="true",b.count=t,b.reverse=c,b.auth=a,h&&(b.callback=h),s&&(b.start=s),l&&(b.end=l),d&&(b.include_token="true"),void V({callback:h,data:b,success:function(e){if("object"==typeof e&&e.error)return void i({message:e.message,payload:e.payload});for(var t=e[0],c=[],a=0;a<t.length;a++){var u=r(t[a],o);try{c.push(JSON.parse(u))}catch(f){c.push(u)}}n([c,e[1],e[2]])},fail:function(e){f(e,i)},url:[w,"v2","history","sub-key",S,"channel",encode(u)]})):W("Missing Subscribe Key"):W("Missing Callback"):W("Missing Channel")},replay:function(e,n){var t,n=n||e.callback||function(){},r=e.auth_key||_,c=e.source,i=e.destination,a=e.stop,o=e.start,f=e.end,s=e.reverse,l=e.limit,d=q(),b={};return c?i?E?S?("0"!=d&&(b.callback=d),a&&(b.stop="all"),s&&(b.reverse="true"),o&&(b.start=o),f&&(b.end=f),l&&(b.count=l),b.auth=r,t=[w,"v1","replay",E,S,c,i],void V({callback:d,success:function(e){u(e,n,err)},fail:function(){n([0,"Disconnected"])},url:t,data:b})):W("Missing Subscribe Key"):W("Missing Publish Key"):W("Missing Destination Channel"):W("Missing Source Channel")},auth:function(e){_=e,D()},time:function(e){var n=q();V({callback:n,data:{uuid:Z,auth:_},timeout:5*SECOND,url:[w,"time",n],success:function(n){e(n[0])},fail:function(){e(0)}})},publish:function(e,n){var r,n=n||e.callback||function(){},c=e.message,i=e.channel,o=e.auth_key||_,s=e.cipher_key,l=e.error||function(){},d=q(),b="push";return e.prepend&&(b="unshift"),c?i?E?S?(c=JSON.stringify(t(c,s)),r=[w,"publish",E,S,0,encode(i),d,encode(c)],A[b]({callback:d,timeout:5*SECOND,url:r,data:{uuid:Z,auth:o},fail:function(e){f(e,l),a(1)},success:function(e){u(e,n,l),a(1)}}),void a()):W("Missing Subscribe Key"):W("Missing Publish Key"):W("Missing Channel"):W("Missing Message")},unsubscribe:function(e,n){var t=e.channel,n=n||e.callback||function(){},r=e.error||function(){};T=0,F=1,t=map((t.join?t.join(","):""+t).split(","),function(e){return U[e]?e+","+e+PRESENCE_SUFFIX:void 0}).join(","),each(t.split(","),function(e){var t=!0;e&&(READY&&(t=en.LEAVE(e,0,n,r)),t||n({action:"leave"}),U[e]=0,e in I&&delete I[e])}),D()},subscribe:function(e,n){function t(e){e?timeout(D,SECOND):(w=nextorigin(N,1),x=nextorigin(N,1),timeout(function(){en.time(t)},SECOND)),o(function(n){return e&&n.disconnected?(n.disconnected=0,n.reconnect(n.name)):void(e||n.disconnected||(n.disconnected=1,n.disconnect(n.name)))})}function c(){var e=q(),n=generate_channel_list(U).join(",");if(n){d();var a={uuid:Z,auth:u},s=JSON.stringify(I);s.length>2&&(a.state=JSON.stringify(I)),j&&(a.heartbeat=j),i(),P=V({timeout:O,callback:e,fail:function(e){f(e,y),en.time(t)},data:a,url:[x,"subscribe",S,encode(n),e,T],success:function(e){if(!e||"object"==typeof e&&"error"in e&&e.error)return y(e.error),timeout(D,SECOND);if(v(e[1]),T=!T&&F&&z.get(S)||e[1],o(function(e){e.connected||(e.connected=1,e.connect(e.name))}),B&&!F)return T=0,B=!1,z.set(S,0),void timeout(c,A);k&&(T=1e4,k=0),z.set(S,e[1]);var n=function(){var n=e.length>2?e[2]:map(generate_channel_list(U),function(n){return map(Array(e[0].length).join(",").split(","),function(){return n})}).join(","),t=n.split(",");return function(){var e=t.shift()||R;return[(U[e]||{}).callback||L,e.split(PRESENCE_SUFFIX)[0]]}}(),t=b(+e[1]);each(e[0],function(c){var i=n(),a=r(c,U[i[1]].cipher_key);i[0](a,e,i[1],t)}),timeout(c,A)}})}}var a=e.channel,n=n||e.callback,n=n||e.message,u=e.auth_key||_,s=e.connect||function(){},l=e.reconnect||function(){},h=e.disconnect||function(){},y=e.error||function(){},v=e.idle||function(){},E=e.presence||0,m=e.noheresync||0,k=e.backfill||0,C=e.timetoken||0,O=e.timeout||g,A=e.windowing||p,M=e.state,H=e.heartbeat||e.pnexpires,K=e.restore;return F=K,T=C,a?n?S?((H||0===H)&&en.set_heartbeat(H),each((a.join?a.join(","):""+a).split(","),function(t){var r=U[t]||{};U[R=t]={name:t,connected:r.connected,disconnected:r.disconnected,subscribed:1,callback:L=n,cipher_key:e.cipher_key,connect:s,disconnect:h,reconnect:l},M&&(I[t]=t in M?M[t]:M),E&&(en.subscribe({channel:t+PRESENCE_SUFFIX,callback:E,restore:K}),r.subscribed||m||en.here_now({channel:t,callback:function(e){each("uuids"in e?e.uuids:[],function(n){E({action:"join",uuid:n,timestamp:rnow(),occupancy:e.occupancy||1},e,t)})}}))}),D=function(){d(),timeout(c,A)},READY?void D():READY_BUFFER.push(D)):W("Missing Subscribe Key"):W("Missing Callback"):W("Missing Channel")},here_now:function(e,n){var n=e.callback||n,t=e.error||function(){},r=e.auth_key||_,c=e.channel,i=q(),a="uuids"in e?e.uuids:!0,o=e.state,s={uuid:Z,auth:r};if(a||(s.disable_uuids=1),o&&(s.state=1),!n)return W("Missing Callback");if(!S)return W("Missing Subscribe Key");var l=[w,"v2","presence","sub_key",S];c&&l.push("channel")&&l.push(encode(c)),"0"!=i&&(s.callback=i),V({callback:i,data:s,success:function(e){u(e,n,t)},fail:function(e){f(e,t)},url:l})},where_now:function(e,n){var n=e.callback||n,t=e.error||function(){},r=e.auth_key||_,c=q(),i=e.uuid||Z,a={auth:r};return n?S?("0"!=c&&(a.callback=c),void V({callback:c,data:a,success:function(e){u(e,n,t)},fail:function(e){f(e,t)},url:[w,"v2","presence","sub_key",S,"uuid",encode(i)]})):W("Missing Subscribe Key"):W("Missing Callback")},state:function(e,n){var t,n=e.callback||n||function(){},r=e.error||function(){},c=e.auth_key||_,i=q(),a=e.state,o=e.uuid||Z,s=e.channel,l={auth:c};return S?o?s?("0"!=i&&(l.callback=i),U[s]&&U[s].subscribed&&(I[s]=a),l.state=JSON.stringify(a),t=a?[w,"v2","presence","sub-key",S,"channel",encode(s),"uuid",o,"data"]:[w,"v2","presence","sub-key",S,"channel",encode(s),"uuid",encode(o)],void V({callback:i,data:l,success:function(e){u(e,n,r)},fail:function(e){f(e,r)},url:t})):W("Missing Channel"):W("Missing UUID"):W("Missing Subscribe Key")},grant:function(e,n){var n=e.callback||n,t=e.error||function(){},r=e.channel,c=q(),i=e.ttl,a=e.read?"1":"0",o=e.write?"1":"0",s=e.auth_key;if(!r)return W("Missing Channel");if(!n)return W("Missing Callback");if(!S)return W("Missing Subscribe Key");if(!E)return W("Missing Publish Key");if(!m)return W("Missing Secret Key");var l=Math.floor((new Date).getTime()/1e3),d=S+"\n"+E+"\ngrant\n";s&&(d+="auth="+encode(s)+"&"),"0"!=c&&(d+="callback="+encode(c)+"&"),r&&(d+="channel="+encode(r)+"&"),d+="pnsdk="+encode(k)+"&r="+a+"&timestamp="+encode(l),(i||0===i)&&(d+="&ttl="+i),d+="&w="+o;var b=C(d,m);b=b.replace(/\+/g,"-"),b=b.replace(/\//g,"_");var h={w:o,r:a,signature:b,channel:r,timestamp:l};"0"!=c&&(h.callback=c),(i||0===i)&&(h.ttl=i),s&&(h.auth=s),V({callback:c,data:h,success:function(e){u(e,n,t)},fail:function(e){f(e,t)},url:[w,"v1","auth","grant","sub-key",S]})},audit:function(e,n){var n=e.callback||n,t=e.error||function(){},r=e.channel,c=e.auth_key,i=q();if(!n)return W("Missing Callback");if(!S)return W("Missing Subscribe Key");if(!E)return W("Missing Publish Key");if(!m)return W("Missing Secret Key");var a=Math.floor((new Date).getTime()/1e3),o=S+"\n"+E+"\naudit\n";c&&(o+="auth="+encode(c)+"&"),"0"!=i&&(o+="callback="+encode(i)+"&"),r&&(o+="channel="+encode(r)+"&"),o+="pnsdk="+encode(k)+"&timestamp="+a;var s=C(o,m);s=s.replace(/\+/g,"-"),s=s.replace(/\//g,"_");var l={signature:s,timestamp:a};"0"!=i&&(l.callback=i),r&&(l.channel=r),c&&(l.auth=c),V({callback:i,data:l,success:function(e){u(e,n,t)},fail:function(e){f(e,t)},url:[w,"v1","auth","audit","sub-key",S]})},revoke:function(e,n){e.read=!1,e.write=!1,en.grant(e,n)},set_uuid:function(e){Z=e,D()},get_uuid:function(){return Z},presence_heartbeat:function(e){var n=e.callback||function(){},t=e.error||function(){},r=q(),c={uuid:Z,auth:_},i=JSON.stringify(I);i.length>2&&(c.state=JSON.stringify(I)),j>0&&320>j&&(c.heartbeat=j),V({callback:r,data:c,timeout:5*SECOND,url:[w,"v2","presence","sub-key",S,"channel",encode(generate_channel_list(U,!0).join(",")),"heartbeat"],success:function(e){u(e,n,t)},fail:function(e){f(e,t)}})},xdr:V,ready:ready,db:z,uuid:uuid,map:map,each:each,"each-channel":o,grep:grep,offline:function(){d(1,{message:"Offline. Please check your network settings."})},supplant:supplant,now:rnow,unique:unique,updater:updater};return Z||(Z=en.uuid()),z.set(S+"uuid",Z),timeout(s,SECOND),timeout(l,y),H=timeout(i,(K-3)*SECOND),h(),en}function crypto_obj(){function e(e){function n(e,n){var t=(65535&e)+(65535&n),r=(e>>16)+(n>>16)+(t>>16);return r<<16|65535&t}function t(e,n){return e>>>n|e<<32-n}function r(e,n){return e>>>n}function c(e,n,t){return e&n^~e&t}function i(e,n,t){return e&n^e&t^n&t}function a(e){return t(e,2)^t(e,13)^t(e,22)}function o(e){return t(e,6)^t(e,11)^t(e,25)}function u(e){return t(e,7)^t(e,18)^r(e,3)}function f(e){return t(e,17)^t(e,19)^r(e,10)}function s(e,t){var r,s,l,d,b,h,p,g,y,v,E,S,_=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),m=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),k=new Array(64);e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var y=0;y<e.length;y+=16){r=m[0],s=m[1],l=m[2],d=m[3],b=m[4],h=m[5],p=m[6],g=m[7];for(var v=0;64>v;v++)k[v]=16>v?e[v+y]:n(n(n(f(k[v-2]),k[v-7]),u(k[v-15])),k[v-16]),E=n(n(n(n(g,o(b)),c(b,h,p)),_[v]),k[v]),S=n(a(r),i(r,s,l)),g=p,p=h,h=b,b=n(d,E),d=l,l=s,s=r,r=n(E,S);m[0]=n(r,m[0]),m[1]=n(s,m[1]),m[2]=n(l,m[2]),m[3]=n(d,m[3]),m[4]=n(b,m[4]),m[5]=n(h,m[5]),m[6]=n(p,m[6]),m[7]=n(g,m[7])}return m}function l(e){for(var n=Array(),t=(1<<h)-1,r=0;r<e.length*h;r+=h)n[r>>5]|=(e.charCodeAt(r/h)&t)<<24-r%32;return n}function d(e){e=e.replace(/\r\n/g,"\n");for(var n="",t=0;t<e.length;t++){var r=e.charCodeAt(t);128>r?n+=String.fromCharCode(r):r>127&&2048>r?(n+=String.fromCharCode(r>>6|192),n+=String.fromCharCode(63&r|128)):(n+=String.fromCharCode(r>>12|224),n+=String.fromCharCode(r>>6&63|128),n+=String.fromCharCode(63&r|128))}return n}function b(e){for(var n=p?"0123456789ABCDEF":"0123456789abcdef",t="",r=0;r<4*e.length;r++)t+=n.charAt(e[r>>2]>>8*(3-r%4)+4&15)+n.charAt(e[r>>2]>>8*(3-r%4)&15);return t}var h=8,p=0;return e=d(e),b(s(l(e),e.length*h))}var n=CRYPTO;n.size(256);var t=n.s2a("0123456789012345");return{encrypt:function(r,c){if(!c)return r;var i=n.s2a(e(c).slice(0,32)),a=n.s2a(JSON.stringify(r)),o=n.rawEncrypt(a,i,t),u=n.Base64.encode(o);return u||r},decrypt:function(r,c){if(!c)return r;var i=n.s2a(e(c).slice(0,32));try{var a=n.Base64.decode(r),o=n.rawDecrypt(a,i,t,!1),u=JSON.parse(o);return u}catch(f){return void 0}}}}var NOW=1,READY=!1,READY_BUFFER=[],PRESENCE_SUFFIX="-pnpres",DEF_WINDOWING=10,DEF_TIMEOUT=1e4,DEF_SUB_TIMEOUT=310,DEF_KEEPALIVE=60,SECOND=1e3,URLBIT="/",PARAMSBIT="&",PRESENCE_HB_THRESHOLD=5,PRESENCE_HB_DEFAULT=30,SDK_VER="3.6.2",REPL=/{([\w\-]+)}/g,nextorigin=function(){var e=20,n=Math.floor(Math.random()*e);return function(t,r){return t.indexOf("pubsub.")>0&&t.replace("pubsub","ps"+(r?uuid().split("-")[0]:++n<e?n:n=1))||t}}(),CRYPTO=function(){var e=14,n=8,t=!1,r=function(e){try{return unescape(encodeURIComponent(e))}catch(n){throw"Error on UTF-8 encode"}},c=function(e){try{return decodeURIComponent(escape(e))}catch(n){throw"Bad Key"}},a=function(e){var n,t,r=[];for(e.length<16&&(n=16-e.length,r=[n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n]),t=0;t<e.length;t++)r[t]=e[t];return r},o=function(e,n){var t,r,c="";if(n){if(t=e[15],t>16)throw"Decryption error: Maybe bad key";if(16==t)return"";for(r=0;16-t>r;r++)c+=String.fromCharCode(e[r])}else for(r=0;16>r;r++)c+=String.fromCharCode(e[r]);return c},u=function(e){var n,t="";for(n=0;n<e.length;n++)t+=(e[n]<16?"0":"")+e[n].toString(16);return t},f=function(e){var n=[];return e.replace(/(..)/g,function(e){n.push(parseInt(e,16))}),n},s=function(e,n){var t,c=[];for(n||(e=r(e)),t=0;t<e.length;t++)c[t]=e.charCodeAt(t);return c},l=function(t){switch(t){case 128:e=10,n=4;break;case 192:e=12,n=6;break;case 256:e=14,n=8;break;default:throw"Invalid Key Size Specified:"+t}},d=function(e){var n,t=[];for(n=0;e>n;n++)t=t.concat(Math.floor(256*Math.random()));return t},b=function(t,r){var c,i=e>=12?3:2,a=[],o=[],u=[],f=[],s=t.concat(r);for(u[0]=GibberishAES.Hash.MD5(s),f=u[0],c=1;i>c;c++)u[c]=GibberishAES.Hash.MD5(u[c-1].concat(s)),f=f.concat(u[c]);return a=f.slice(0,4*n),o=f.slice(4*n,4*n+16),{key:a,iv:o}},h=function(e,n,t){n=k(n);var r,c=Math.ceil(e.length/16),i=[],o=[];for(r=0;c>r;r++)i[r]=a(e.slice(16*r,16*r+16));for(e.length%16===0&&(i.push([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),c++),r=0;r<i.length;r++)i[r]=0===r?m(i[r],t):m(i[r],o[r-1]),o[r]=g(i[r],n);return o},p=function(e,n,t,r){n=k(n);var i,a=e.length/16,u=[],f=[],s="";for(i=0;a>i;i++)u.push(e.slice(16*i,16*(i+1)));for(i=u.length-1;i>=0;i--)f[i]=y(u[i],n),f[i]=0===i?m(f[i],t):m(f[i],u[i-1]);for(i=0;a-1>i;i++)s+=o(f[i]);return s+=o(f[i],!0),r?s:c(s)},g=function(n,r){t=!1;var c,i=_(n,r,0);for(c=1;e+1>c;c++)i=v(i),i=E(i),e>c&&(i=S(i)),i=_(i,r,c);return i},y=function(n,r){t=!0;var c,i=_(n,r,e);for(c=e-1;c>-1;c--)i=E(i),i=v(i),i=_(i,r,c),c>0&&(i=S(i));return i},v=function(e){var n,r=t?M:A,c=[];for(n=0;16>n;n++)c[n]=r[e[n]];return c},E=function(e){var n,r=[],c=t?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11];for(n=0;16>n;n++)r[n]=e[c[n]];return r},S=function(e){var n,r=[];if(t)for(n=0;4>n;n++)r[4*n]=U[e[4*n]]^T[e[1+4*n]]^B[e[2+4*n]]^F[e[3+4*n]],r[1+4*n]=F[e[4*n]]^U[e[1+4*n]]^T[e[2+4*n]]^B[e[3+4*n]],r[2+4*n]=B[e[4*n]]^F[e[1+4*n]]^U[e[2+4*n]]^T[e[3+4*n]],r[3+4*n]=T[e[4*n]]^B[e[1+4*n]]^F[e[2+4*n]]^U[e[3+4*n]];else for(n=0;4>n;n++)r[4*n]=R[e[4*n]]^P[e[1+4*n]]^e[2+4*n]^e[3+4*n],r[1+4*n]=e[4*n]^R[e[1+4*n]]^P[e[2+4*n]]^e[3+4*n],r[2+4*n]=e[4*n]^e[1+4*n]^R[e[2+4*n]]^P[e[3+4*n]],r[3+4*n]=P[e[4*n]]^e[1+4*n]^e[2+4*n]^R[e[3+4*n]];return r},_=function(e,n,t){var r,c=[];for(r=0;16>r;r++)c[r]=e[r]^n[t][r];return c},m=function(e,n){var t,r=[];for(t=0;16>t;t++)r[t]=e[t]^n[t];return r},k=function(t){var r,c,i,a,o=[],u=[],f=[];for(r=0;n>r;r++)c=[t[4*r],t[4*r+1],t[4*r+2],t[4*r+3]],o[r]=c;for(r=n;4*(e+1)>r;r++){for(o[r]=[],i=0;4>i;i++)u[i]=o[r-1][i];for(r%n===0?(u=C(O(u)),u[0]^=L[r/n-1]):n>6&&r%n==4&&(u=C(u)),i=0;4>i;i++)o[r][i]=o[r-n][i]^u[i]}for(r=0;e+1>r;r++)for(f[r]=[],a=0;4>a;a++)f[r].push(o[4*r+a][0],o[4*r+a][1],o[4*r+a][2],o[4*r+a][3]);return f},C=function(e){for(var n=0;4>n;n++)e[n]=A[e[n]];return e},O=function(e){var n,t=e[0];for(n=0;4>n;n++)e[n]=e[n+1];return e[3]=t,e},N=function(e,n){var t=[];for(i=0;i<e.length;i+=n)t[i/n]=parseInt(e.substr(i,n),16);return t},w=function(e){var n=[];for(i=0;i<e.length;i++)n[e[i]]=i;return n},x=function(e,n){var t,r;for(r=0,t=0;8>t;t++)r=1==(1&n)?r^e:r,e=e>127?283^e<<1:e<<1,n>>>=1;return r},D=function(e){for(var n=[],t=0;256>t;t++)n[t]=x(e,t);return n},A=N("637c777bf26b6fc53001672bfed7ab76ca82c97dfa5947f0add4a2af9ca472c0b7fd9326363ff7cc34a5e5f171d8311504c723c31896059a071280e2eb27b27509832c1a1b6e5aa0523bd6b329e32f8453d100ed20fcb15b6acbbe394a4c58cfd0efaafb434d338545f9027f503c9fa851a3408f929d38f5bcb6da2110fff3d2cd0c13ec5f974417c4a77e3d645d197360814fdc222a908846eeb814de5e0bdbe0323a0a4906245cc2d3ac629195e479e7c8376d8dd54ea96c56f4ea657aae08ba78252e1ca6b4c6e8dd741f4bbd8b8a703eb5664803f60e613557b986c11d9ee1f8981169d98e949b1e87e9ce5528df8ca1890dbfe6426841992d0fb054bb16",2),M=w(A),L=N("01020408102040801b366cd8ab4d9a2f5ebc63c697356ad4b37dfaefc591",2),R=D(2),P=D(3),F=D(9),T=D(11),B=D(13),U=D(14),I=function(e,n,t){var r,c=d(8),i=b(s(n,t),c),a=i.key,o=i.iv,u=[[83,97,108,116,101,100,95,95].concat(c)];return e=s(e,t),r=h(e,a,o),r=u.concat(r),K.encode(r)},H=function(e,n,t){var r=K.decode(e),c=r.slice(8,16),i=b(s(n,t),c),a=i.key,o=i.iv;return r=r.slice(16,r.length),e=p(r,a,o,t)},j=function(e){function n(e,n){return e<<n|e>>>32-n}function t(e,n){var t,r,c,i,a;return c=2147483648&e,i=2147483648&n,t=1073741824&e,r=1073741824&n,a=(1073741823&e)+(1073741823&n),t&r?2147483648^a^c^i:t|r?1073741824&a?3221225472^a^c^i:1073741824^a^c^i:a^c^i}function r(e,n,t){return e&n|~e&t}function c(e,n,t){return e&t|n&~t}function i(e,n,t){return e^n^t}function a(e,n,t){return n^(e|~t)}function o(e,c,i,a,o,u,f){return e=t(e,t(t(r(c,i,a),o),f)),t(n(e,u),c)}function u(e,r,i,a,o,u,f){return e=t(e,t(t(c(r,i,a),o),f)),t(n(e,u),r)}function f(e,r,c,a,o,u,f){return e=t(e,t(t(i(r,c,a),o),f)),t(n(e,u),r)}function s(e,r,c,i,o,u,f){return e=t(e,t(t(a(r,c,i),o),f)),t(n(e,u),r)}function l(e){for(var n,t=e.length,r=t+8,c=(r-r%64)/64,i=16*(c+1),a=[],o=0,u=0;t>u;)n=(u-u%4)/4,o=u%4*8,a[n]=a[n]|e[u]<<o,u++;return n=(u-u%4)/4,o=u%4*8,a[n]=a[n]|128<<o,a[i-2]=t<<3,a[i-1]=t>>>29,a}function d(e){var n,t,r=[];for(t=0;3>=t;t++)n=e>>>8*t&255,r=r.concat(n);return r}var b,h,p,g,y,v,E,S,_,m=[],k=N("67452301efcdab8998badcfe10325476d76aa478e8c7b756242070dbc1bdceeef57c0faf4787c62aa8304613fd469501698098d88b44f7afffff5bb1895cd7be6b901122fd987193a679438e49b40821f61e2562c040b340265e5a51e9b6c7aad62f105d02441453d8a1e681e7d3fbc821e1cde6c33707d6f4d50d87455a14eda9e3e905fcefa3f8676f02d98d2a4c8afffa39428771f6816d9d6122fde5380ca4beea444bdecfa9f6bb4b60bebfbc70289b7ec6eaa127fad4ef308504881d05d9d4d039e6db99e51fa27cf8c4ac5665f4292244432aff97ab9423a7fc93a039655b59c38f0ccc92ffeff47d85845dd16fa87e4ffe2ce6e0a30143144e0811a1f7537e82bd3af2352ad7d2bbeb86d391",8);for(m=l(e),v=k[0],E=k[1],S=k[2],_=k[3],b=0;b<m.length;b+=16)h=v,p=E,g=S,y=_,v=o(v,E,S,_,m[b+0],7,k[4]),_=o(_,v,E,S,m[b+1],12,k[5]),S=o(S,_,v,E,m[b+2],17,k[6]),E=o(E,S,_,v,m[b+3],22,k[7]),v=o(v,E,S,_,m[b+4],7,k[8]),_=o(_,v,E,S,m[b+5],12,k[9]),S=o(S,_,v,E,m[b+6],17,k[10]),E=o(E,S,_,v,m[b+7],22,k[11]),v=o(v,E,S,_,m[b+8],7,k[12]),_=o(_,v,E,S,m[b+9],12,k[13]),S=o(S,_,v,E,m[b+10],17,k[14]),E=o(E,S,_,v,m[b+11],22,k[15]),v=o(v,E,S,_,m[b+12],7,k[16]),_=o(_,v,E,S,m[b+13],12,k[17]),S=o(S,_,v,E,m[b+14],17,k[18]),E=o(E,S,_,v,m[b+15],22,k[19]),v=u(v,E,S,_,m[b+1],5,k[20]),_=u(_,v,E,S,m[b+6],9,k[21]),S=u(S,_,v,E,m[b+11],14,k[22]),E=u(E,S,_,v,m[b+0],20,k[23]),v=u(v,E,S,_,m[b+5],5,k[24]),_=u(_,v,E,S,m[b+10],9,k[25]),S=u(S,_,v,E,m[b+15],14,k[26]),E=u(E,S,_,v,m[b+4],20,k[27]),v=u(v,E,S,_,m[b+9],5,k[28]),_=u(_,v,E,S,m[b+14],9,k[29]),S=u(S,_,v,E,m[b+3],14,k[30]),E=u(E,S,_,v,m[b+8],20,k[31]),v=u(v,E,S,_,m[b+13],5,k[32]),_=u(_,v,E,S,m[b+2],9,k[33]),S=u(S,_,v,E,m[b+7],14,k[34]),E=u(E,S,_,v,m[b+12],20,k[35]),v=f(v,E,S,_,m[b+5],4,k[36]),_=f(_,v,E,S,m[b+8],11,k[37]),S=f(S,_,v,E,m[b+11],16,k[38]),E=f(E,S,_,v,m[b+14],23,k[39]),v=f(v,E,S,_,m[b+1],4,k[40]),_=f(_,v,E,S,m[b+4],11,k[41]),S=f(S,_,v,E,m[b+7],16,k[42]),E=f(E,S,_,v,m[b+10],23,k[43]),v=f(v,E,S,_,m[b+13],4,k[44]),_=f(_,v,E,S,m[b+0],11,k[45]),S=f(S,_,v,E,m[b+3],16,k[46]),E=f(E,S,_,v,m[b+6],23,k[47]),v=f(v,E,S,_,m[b+9],4,k[48]),_=f(_,v,E,S,m[b+12],11,k[49]),S=f(S,_,v,E,m[b+15],16,k[50]),E=f(E,S,_,v,m[b+2],23,k[51]),v=s(v,E,S,_,m[b+0],6,k[52]),_=s(_,v,E,S,m[b+7],10,k[53]),S=s(S,_,v,E,m[b+14],15,k[54]),E=s(E,S,_,v,m[b+5],21,k[55]),v=s(v,E,S,_,m[b+12],6,k[56]),_=s(_,v,E,S,m[b+3],10,k[57]),S=s(S,_,v,E,m[b+10],15,k[58]),E=s(E,S,_,v,m[b+1],21,k[59]),v=s(v,E,S,_,m[b+8],6,k[60]),_=s(_,v,E,S,m[b+15],10,k[61]),S=s(S,_,v,E,m[b+6],15,k[62]),E=s(E,S,_,v,m[b+13],21,k[63]),v=s(v,E,S,_,m[b+4],6,k[64]),_=s(_,v,E,S,m[b+11],10,k[65]),S=s(S,_,v,E,m[b+2],15,k[66]),E=s(E,S,_,v,m[b+9],21,k[67]),v=t(v,h),E=t(E,p),S=t(S,g),_=t(_,y);return d(v).concat(d(E),d(S),d(_))},K=function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=e.split(""),t=function(e){{var t,r,c=[],i="";Math.floor(16*e.length/3)}for(t=0;t<16*e.length;t++)c.push(e[Math.floor(t/16)][t%16]);for(t=0;t<c.length;t+=3)i+=n[c[t]>>2],i+=n[(3&c[t])<<4|c[t+1]>>4],i+=void 0!==c[t+1]?n[(15&c[t+1])<<2|c[t+2]>>6]:"=",i+=void 0!==c[t+2]?n[63&c[t+2]]:"=";for(r=i.slice(0,64),t=1;t<Math.ceil(i.length/64);t++)r+=i.slice(64*t,64*t+64)+(Math.ceil(i.length/64)==t+1?"":"\n");return r},r=function(n){n=n.replace(/\n/g,"");var t,r=[],c=[],i=[];for(t=0;t<n.length;t+=4)c[0]=e.indexOf(n.charAt(t)),c[1]=e.indexOf(n.charAt(t+1)),c[2]=e.indexOf(n.charAt(t+2)),c[3]=e.indexOf(n.charAt(t+3)),i[0]=c[0]<<2|c[1]>>4,i[1]=(15&c[1])<<4|c[2]>>2,i[2]=(3&c[2])<<6|c[3],r.push(i[0],i[1],i[2]);return r=r.slice(0,r.length-r.length%16)};return"function"==typeof Array.indexOf&&(e=n),{encode:t,decode:r}}();return{size:l,h2a:f,expandKey:k,encryptBlock:g,decryptBlock:y,Decrypt:t,s2a:s,rawEncrypt:h,rawDecrypt:p,dec:H,openSSLKey:b,a2h:u,enc:I,Hash:{MD5:j},Base64:K}}();!function(){function e(n){var t,r=function(){if(!i){i=1,clearTimeout(a);try{response=JSON.parse(t.responseText)}catch(e){return b(1)}f(response)}},c=0,i=0,a=timeout(function(){b(1)},l),o=n.data||{},u=n.fail||function(){},f=n.success||function(){},d="undefined"==typeof n.blocking,b=function(e,n){c||(c=1,clearTimeout(a),t&&(t.onerror=t.onload=null,t.abort&&t.abort(),t=null),e&&u(n))};try{t="undefined"!=typeof XDomainRequest&&new XDomainRequest||new XMLHttpRequest,t.onerror=t.onabort=function(){b(1,t.responseText||{error:"Network Connection Error"})},t.onload=t.onloadend=r,t.onreadystatechange=function(){if(4==t.readyState)switch(t.status){case 401:case 402:case 403:try{response=JSON.parse(t.responseText),b(1,response)}catch(e){return b(1,t.responseText)}}},d&&(t.timeout=l),o.pnsdk=s,url=build_url(n.url,o),t.open("GET",url,d),t.send()}catch(h){return b(0),e(n)}return b}function n(e,n,t){each(e.split(","),function(e){var r=function(e){e||(e=window.event),t(e)||(e.cancelBubble=!0,e.returnValue=!1,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation())};n.addEventListener?n.addEventListener(e,r,!1):n.attachEvent?n.attachEvent("on"+e,r):n["on"+e]=r})}function t(e){console.error(e)}function r(e,n,t){return t?void e.setAttribute(n,t):e&&e.getAttribute&&e.getAttribute(n)}function c(e){return document.getElementById(e)}function i(e,n){var t=[];return each(e.split(/\s+/),function(e){each((n||document).getElementsByTagName(e),function(e){t.push(e)})}),t}function a(e,n){for(var t in n)if(n.hasOwnProperty(t))try{e.style[t]=n[t]+("|width|height|top|left|".indexOf(t)>0&&"number"==typeof n[t]?"px":"")}catch(r){}}function o(e){return document.createElement(e)}function u(e,n){var t=CryptoJS.HmacSHA256(e,n);return t.toString(CryptoJS.enc.Base64)}function f(l){l.db=d,l.xdr=e,l.error=l.error||t,l.PNSDK=s,l.hmac_SHA256=u,l.crypto_obj=crypto_obj(),SELF=function(e){return f(e)};var b=PN_API(l);for(var h in b)b.hasOwnProperty(h)&&(SELF[h]=b[h]);return SELF.init=SELF,SELF.$=c,SELF.attr=r,SELF.search=i,SELF.bind=n,SELF.css=a,SELF.create=o,"undefined"!=typeof window&&n("beforeunload",window,function(){return SELF["each-channel"](function(e){SELF.LEAVE(e.name,1)}),!0}),l.notest?SELF:("undefined"!=typeof window&&n("offline",window,SELF._reset_offline),"undefined"!=typeof document&&n("offline",document,SELF._reset_offline),SELF.ready(),SELF)}var s="PubNub-JS-Modern/3.6.2",l=31e4,d=function(){var e="undefined"!=typeof localStorage&&localStorage;return{get:function(n){try{return e?e.getItem(n):-1==document.cookie.indexOf(n)?null:((document.cookie||"").match(RegExp(n+"=([^;]+)"))||[])[1]||null}catch(t){return}},set:function(n,t){try{if(e)return e.setItem(n,t)&&0;document.cookie=n+"="+t+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(r){return}}}}();f.init=f,f.secure=f,PUBNUB=f({}),"undefined"!=typeof module&&(module.exports=f)||"undefined"!=typeof exports&&(exports.PUBNUB=f)||(PUBNUB=f)}(),function(){var e=PUBNUB.ws=function(n,t){if(!(this instanceof e))return new e(n,t);var r=this,n=r.url=n||"",c=(r.protocol=t||"Sec-WebSocket-Protocol",n.split("/")),i={ssl:"wss:"===c[0],origin:c[2],publish_key:c[3],subscribe_key:c[4],channel:c[5]};return r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.CLOSE_NORMAL=1e3,r.CLOSE_GOING_AWAY=1001,r.CLOSE_PROTOCOL_ERROR=1002,r.CLOSE_UNSUPPORTED=1003,r.CLOSE_TOO_LARGE=1004,r.CLOSE_NO_STATUS=1005,r.CLOSE_ABNORMAL=1006,r.onclose=r.onerror=r.onmessage=r.onopen=r.onsend=function(){},r.binaryType="",r.extensions="",r.bufferedAmount=0,r.trasnmitting=!1,r.buffer=[],r.readyState=r.CONNECTING,n?(r.pubnub=PUBNUB.init(i),r.pubnub.setup=i,r.setup=i,void r.pubnub.subscribe({restore:!1,channel:i.channel,disconnect:r.onerror,reconnect:r.onopen,error:function(){r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!1})},callback:function(e){r.onmessage({data:e})},connect:function(){r.readyState=r.OPEN,r.onopen()}})):(r.readyState=r.CLOSED,r.onclose({code:r.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:!0}),r)};e.prototype.send=function(e){var n=this;n.pubnub.publish({channel:n.pubnub.setup.channel,message:e,callback:function(e){n.onsend({data:e})}})},e.prototype.close=function(){var e=this;e.pubnub.unsubscribe({channel:e.pubnub.setup.channel}),e.readyState=e.CLOSED,e.onclose({})}}();
},{}]},{},[8])

(8)
});

//# sourceMappingURL=dist/WebP2P.map